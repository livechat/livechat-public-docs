---
weight: 21
category: "messaging"
subcategory: "agent-chat-api"
title: "RTM API Reference"
tagline: "Interact with the chat as an Agent."
desc: "Build powerful LiveChat integrations with an open messaging protocol. Use the Agent Chat RTM API to send messages, manage access and properties."
apiVersion: "3.1"
---

# Introduction

## Versioning

This documentation describes the **Agent Chat Real-Time Messaging API v3.1**.

## What is RTM API

Real-Time Messaging API (RTM API) is based on a websocket-like connection. Client can send a **request message** that results in getting a **response message**. It's also possible to get **push messages**.

## When to use RTM API

If you're wondering which API to use - Agent Chat **RTM API** or **Web API**, keep on reading.

**Real-Time Messaging API** allows for building stateful integrations that require **logging in** and **maintaining the connection**. Since connection maintenance is required, the implementation might be more challenging than with Web API.

Agent Chat RTM API enables communication in real time. It supports pushes like `sneak peek`, `typing indicator`, and other. Web API doesn’t have equivalent webhooks, which means you won't be informed about certain events using Web API.

Also, the RTM API will be a better choice if you want to avoid time delays or presume significant traffic.
**Not what you're looking for?** Perhaps, you need to use [**Agent Chat Web API**](..) instead.

## Authentication

**Agent authentication** is handled by access tokens. Find out how to get an **access token** from [Agent authorization flows](/getting-started/authorization/#agent-authorization-flows). Client must authorize himself by [logging in](#login) within 30 seconds, otherwise the connection will be closed.

After successful authorization, client should **ping the server** each 15 seconds, otherwise the connection will be closed after about 30 seconds of inactivity. If the [control frame ping](https://tools.ietf.org/html/rfc6455#section-5.5.2) is unavailable (in web browsers), client should use a protocol message with the ping action. Until authorization is completed, ping is a no-op.

All authorization scopes are listed in the [Scopes](#scopes) section. If a method requires particular scopes, you'll find them included in the method description.

Given that the connection is continuosly maintained, you only need to authorize once.

## Data centers

LiveChat system operates in two data centers: `dal` (USA) and `fra` (Europe). The default data center is `dal`.

For backend applications, you can specify the region in the request header. The mechanism is the same as in [Agent Chat Web API reference](../#data-centers). It doesn't work for frontend applications, though.
Instead, frontend apps connect to a region different than the default one by specifying the region suffix in the URL. 

**`fra`:** `wss://api-fra.livechatinc.com/v3.1/agent/rtm/ws`

**`dal`:** `wss://api.livechatinc.com/v3.1/agent/rtm/ws`

# Scopes

Scopes define the access to certain resources.

- `ro` means read only
- `rw` means read/write
- all `rw` scopes contain `ro` privileges
- all `access` scopes contain `my` privileges
- all `all` scopes contain `access` privileges and `my` privileges

## Accessing chat

This chart shows every possible chats scenarios:

- chats without my access and without my presence (`chats -A -P`)
- chats with my access but without my presence (`chats +A -P`)
- chats with my presence but without my access (`chats -A +P`)
- chats with my access and with my presence (`chats +A +P`)

![Scopes diagram](./livechat-scopes-diagram.png)

The table shows scopes dependency of accessing chat:

|          | `chats -A -P` | `chats +A -P` | `chats -A +P` | `chats +A +P` |
| -------- | ------------- | ------------- | ------------- | ------------- |
| `all`    | ✓             | ✓             | ✓             | ✓             |
| `access` | -             | ✓             | ✓             | ✓             |
| `my`     | -             | -             | ✓             | ✓             |

## Accessing parts of chat

The table shows scopes dependency of accessing chat parts:

|                           | meta data | conversation data |
| ------------------------- | --------- | ----------------- |
| `chats-*:rw`              | rw        | rw                |
| `chats.conversation-*:rw` | ro        | rw                |
| `chats-*:ro`              | ro        | ro                |

## Scope types

### Agents scopes

| Scope             | role          | Description                                              |
| ----------------- | ------------- | -------------------------------------------------------- |
| `agents--my:rw`   | normal        | Write permission for my profile configuration            |
| `agents--all:rw`  | administrator | Write permission for all agents profiles configuration   |
| `access_rules:ro` | administrator | Read permission for auto chat scopes configuration       |
| `access_rules:rw` | administrator | Read/write permission for auto chat scopes configuration |

### Bot Agents scopes

| Scope                | role          | Description                                                                      |
| -------------------- | ------------- | -------------------------------------------------------------------------------- |
| `agents-bot--my:ro`  | administrator | Read permission for bot agents configuration (only my bot agents)                |
| `agents-bot--my:rw`  | administrator | Read/write permission for bot agents configuration (only my bot agents)          |
| `agents-bot--all:ro` | administrator | Read permission for bot agents configuration (all in license)                    |
| `agents-bot--all:rw` | administrator | Read/write permission for bot agents configuration (all in license, delete only) |

### Chats scopes

| Scope                           | role          | Description                                                                                                                                                                           |
| ------------------------------- | ------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chats--all:ro`                 | normal        | Read permission for conversation and meta data of all license chats                                                                                                                   |
| `chats--access:ro`              | normal        | Read permission for conversation and meta data of chats with requester access                                                                                                         |
| `chats--my:ro`                  | normal        | Read permission for conversation and meta data of the chats with requester presence                                                                                                   |
| `chats.conversation--all:rw`    | normal        | Write permission for conversation data of all license chats and Read permission for conversation and meta data of all license chats (`chats--all:ro`)                                 |
| `chats.conversation--access:rw` | normal        | Write permission for conversation data of chats with requester access and Read permission for conversation and meta data of chats with requester access (`chats--access:ro`)          |
| `chats.conversation--my:rw`     | normal        | Read/write permission for conversation data of chats with requester presence and Read permission for conversation and meta data of the chats with requester presence (`chats--my:ro`) |
| `chats--all:rw`                 | administrator | Read/write permission for conversation and meta data of all license chats                                                                                                             |
| `chats--access:rw`              | administrator | Read/write permission for conversation and meta data of chats with requester access                                                                                                   |
| `chats--my:rw`                  | normal        | Read/write permission for conversation and meta data of chats with requester presence                                                                                                 |

- chats conversation data applies to:
  - chat events
  - chat properties
  - thread properties
- chats meta data applies to:
  - chat users

_NOTICE: currently `chats.conversation--all:rw` allows joining chats too because you have to join the chat to be able to write to it_

### Customers scopes

| Scope              | role          | Description                                  |
| ------------------ | ------------- | -------------------------------------------- |
| `customers.ban:rw` | normal        | Permission for banning customers             |
| `customers:own`    | administrator | Permission for managing customers identities |
| `customers:ro`     | normal        | Read permission for customers                |
| `customers:rw`     | normal        | Read/write permission for customers          |

### Multicast scopes

| Scope          | role   | Description                                          |
| -------------- | ------ | ---------------------------------------------------- |
| `multicast:rw` | normal | Permission for multicast data to agents or customers |

### Properties scopes

| Scope                | role          | Description                                                                                  |
| -------------------- | ------------- | -------------------------------------------------------------------------------------------- |
| `properties--my:ro`  | administrator | Read permission for chat/thread/events properties configuration (only in my namespace)       |
| `properties--my:rw`  | administrator | Read/write permission for chat/thread/events properties configuration (only in my namespace) |
| `properties--all:ro` | administrator | Read permission for chat/thread/events properties configuration (all in license)             |

# Events

One of the data structures are **events**. They are sent to a chat via the `send_event` method.
Apart from events, there are also [Properties](#properties), [Users](#users), and [Other data structures](#other-common-structures).

These are the available **event types**:

- [File](#file)
- [Filled form](#filled-form)
- [Message](#message)
- [Rich message](#rich-message)
- [Custom](#custom)
- [System message](#system-message)

## File

<Section>
<Text>

File event informs about a file being uploaded.

| Field                                                 | Req./Opt. |                                                                Note |
| ----------------------------------------------------- | :-------: | ------------------------------------------------------------------: |
| `content_type`                                        | required  |       Supported image types: `image/png`, `image/jpeg`, `image/gif` |
| `created_at`                                          | required  | Date & time format with a resolution of microseconds, `UTC string`. |
| `type`                                                | required  | `file`                                                              |
| `custom_id`                                           | optional  |                                                                   - |
| `properties`                                          | optional  |                                                                   - |
| `recipients`                                          | required  |                          Possible values: `all` (default), `agents` |
| `url`                                                 | required  | Has to point to the LiveChat CDN. It's recommended to use the URL returned by [`upload_file`](/messaging/agent-chat-api/#upload-file).|
| `width`, `height`, `thumbnail_url`, `thumbnail2x_url` | optional  |                                                     Only for images |

</Text>
<Code>
<CodeResponse title={'Sample File event'}>

```json
{
  "id": "0affb00a-82d6-4e07-ae61-56ba5c36f743", // generated server-side
  "custom_id": "31-0C-1C-07-DB-16",
  "type": "file",
  "author_id": "b7eff798-f8df-4364-8059-649c35c9ed0c", // generated server-side
  "created_at": "2017-10-12T15:19:21.010200Z", // generated server-side
  "recipients": "all",
  "properties": {
    // "Properties" object
  },
  "name": "image25.png", // generated server-side
  "url": "https://domain.com/image25.png",
  "thumbnail_url": "https://domain.com/thumbnail.png", // generated server-side
  "thumbnail2x_url": "https://domain.com/thumbnail2x.png", // generated server-side
  "content_type": "image/png", // generated server-side
  "size": 123444, // generated server-side
  "width": 640, // generated server-side
  "height": 480 // generated server-side
}
```

</CodeResponse>
</Code>
</Section>

## Filled form

<Section>
<Text>

Filled form event contains data from a form (prechat or postchat survey).

| Field                                   | Req./Opt |                                                               Notes |
| --------------------------------------- | :------: | ------------------------------------------------------------------: |
| `created_at`                            | required | Date & time format with a resolution of microseconds, `UTC string`. |
| `recipients`                            | required | Possible values: `all` (default), `agents`                          |
| `type`                                  | required | `filled_form`                                                       |
| `checkbox`                              | optional | For multiple-choice questions                                       |
| `custom_id`                             | optional |                                                                     |
| `email`, `name`, `question`, `textarea` | optional | For open questions (text answer)                                    |
| `group_chooser`                         | optional | For group-choice questions                                          |    
| `properties`                            | optional | The [Properties](#properties) object                                |
| `radio`, `select`                       | optional | For single-choice questions                                         |  

</Text>

<Code>
<CodeResponse title={'Sample Filled form event'}>

```json
{
	"id": "0affb00a-82d6-4e07-ae61-56ba5c36f743", // generated server-side
	"custom_id": "31-0C-1C-07-DB-16",
	"type": "filled_form",
	"author_id": "b7eff798-f8df-4364-8059-649c35c9ed0c", // generated server-side
	"created_at": "2017-10-12T15:19:21.010200Z",  // generated server-side
	"recipients": "all",
	"properties": {
		// "Properties" object
	},
	"form_id": "1473433500211",
	"fields": [{
		"type": "name",
		"id": "154417206262603539",
		"label": "Your name",
		"answer": "John Doe"
	}, {
		"type": "email",
		"id": "154417206262601584",
		"label": "Your email",
		"answer": "customer1@example.com"
	}, {
		"type": "radio",
		"id": "154417206262602571",
		"label": "Chat purpose",
		"answer": {
				"id": "0",
				"label": "Support"
		}
	}, {
		"type": "checkbox",
		"id": "154417206262604640",
		"label": "Company industry",
		"answers": [{
			"id": "0"
			"label": "automotive"
		}, {
			"id": "1"
			"label": "it"
		}]
	}, {
		"type": "group_chooser",
		"id": "154417206262605324",
		"label": "Choose department",
		"answer": {
			"group_id": 1,
			"label": "Marketing"
		}
	}]
}
```

</CodeResponse>
</Code>
</Section>

## Message

<Section>
<Text>

Message event contains a text message to other chat users.

| Field            | Req./Opt. |  Notes                                                              |
| ---------------- | :-------: | ------------------------------------------------------------------: |
| `created_at`     | required  | Date & time format with a resolution of microseconds, `UTC string`. |
| `recipients`     | required  | Possible values: `all` (default), `agents`                          |
| `text`           | required  | Max. raw text size is 16 KB (one UTF-8 char like emoji 😁 can use up to 4 B); to send more, split text into several messages. |
| `type`           | required  | `message`                                                           |
| `custom_id`      | optional  |                                                                     |
| `postback`       | optional  | Appears in the message event only when triggered by a rich message. |
| `postback.type`  | optional  | Required only if `postback.value` is present.                       |
| `postback.value` | optional  | Required only if `postback.type` is present.                        |
| `properties`     | optional  | The [properties](#properties) object                                |

</Text>
<Code>
<CodeResponse title={'Sample Message event'}>

```json
{
  "id": "0affb00a-82d6-4e07-ae61-56ba5c36f743", // generated server-side
  "custom_id": "31-0C-1C-07-DB-16",
  "type": "message",
  "author_id": "b7eff798-f8df-4364-8059-649c35c9ed0c", // generated server-side
  "created_at": "2017-10-12T15:19:21.010200Z", // generated server-side
  "text": "hello there",
  "postback": {
    "id": "action_call",
    "thread_id": "K600PKZON8",
    "event_id": "75a90b82-e6a4-4ded-b3eb-cb531741ee0d",
    "type": "phone",
    "value": "790034890"
  },
  "recipients": "all",
  "properties": {
    // "Properties" object
  }
}
```

</CodeResponse>
</Code>
</Section>

## Rich message

<Section>
<Text>

Rich message event contains a rich message data structure. [Read more](/extending-ui/extending-chat-widget/rich-messages/) in a document dedicated to Rich messages.

| Field                            | Req./Opt. | Notes                                                               |
| -------------------------------- | :-------: | ------------------------------------------------------------------: |
| `created_at`                     | required  | Date & time format with a resolution of microseconds, `UTC string`. |
| `recipients`                     | required  | Possible values: `all` (default), `agents` |
| `template_id`                    | required  | Describes how the event should be presented in an app.              |
| `type`                           | required  | `rich_message`                                                      | 
| `custom_id`                      | optional  |                                                                     |
| `elements`                       | optional  | May contain 1 - 10 `element` objects.                               |
| `elements.buttons`               | optional  | `buttons` may contain 1 - 11 `button` objects.                      |
| `elements.buttons.postback_id`   | optional  | Required only if `elements.buttons` is present. Describes the action sent via `send_rich_message_postback`. Multiple buttons (even from different elements) can contain the same `postback_id`. Calling `send_rich_message_postback` with this id will add a user to all those buttons at once. |
| `elements.buttons.text`          | optional  | Required only if `elements.buttons` is present.                     |
| `elements.buttons.type`          | optional  | Required only if both `elements.buttons` and `elements.buttons.value` are present.  |
| `elements.buttons.user_ids`      | optional  | Required only if `elements.buttons` is present. Describes users that sent the postback with `"toggled": true`. |
| `elements.buttons.value`         | optional  | Required only if both `elements.buttons` and `elements.buttons.type` are present.  |
| `elements.buttons.webview_height`| optional  | Possible values: `compact`, `full`, `tall`                                                                    |
| `elements.image`                 | optional  | `image` properties are optional: `name`, `url`, `content_type`, `size`, `width`, `height`. |
| `elements.subtitle`              | optional  |                                                                     |
| `elements.title`                 | optional  |                                                                     |
| `properties`                     | optional  | The [properties](#properties) object                                |

</Text>
<Code>
<CodeResponse title={'Sample Rich message event'}>

```json
{
  "id": "0affb00a-82d6-4e07-ae61-56ba5c36f743", // generated server-side
  "custom_id": "31-0C-1C-07-DB-16",
  "type": "rich_message",
  "author_id": "b7eff798-f8df-4364-8059-649c35c9ed0c", // generated server-side
  "created_at": "2017-10-12T15:19:21.010200Z", // generated server-side
  "recipients": "all",
  "properties": {
    // "Properties" object
  },
  "template_id": "cards",
  "elements": [
    {
      "title": "Lorem ipsum dolor.",
      "subtitle": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
      "image": {
        "name": "image25.png",
        "url": "https://domain.com/asdsfdsf.png",
        "content_type": "image/png",
        "size": 123444,
        "width": 640,
        "height": 480
      },
      "buttons": [
        {
          "text": "yes",
          "postback_id": "action_yes",
          "user_ids": ["b7eff798-f8df-4364-8059-649c35c9ed0c"]
        },
        {
          "text": "no",
          "postback_id": "action_no",
          "user_ids": []
        },
        {
          "type": "phone",
          "text": "value",
          "value": "790034890",
          "webview_height": "tall",
          "postback_id": "action_call",
          "user_ids": []
        }
      ]
    },
    {
      "title": "Lorem ipsum dolor 2."
    }
  ]
}
```

</CodeResponse>
</Code>
</Section>

## Custom

<Section>
<Text>

Custom event is an event with customizable payload.

| Field        | Req./Opt. |                                                                Note |
| ------------ | :-------: | ------------------------------------------------------------------: |
| `recipients` | required  |                          Possible values: `all` (default), `agents` |
| `type`       | required  | `custom`                                                            |
| `custom_id`  | optional  |                                                                     |
| `created_at` | required  | Date & time format with a resolution of microseconds, `UTC string`. |
| `properties` | optional  |                                                                     |


</Text>
<Code>
<CodeResponse title={'Sample Custom event'}>

```json
{
  "id": "0affb00a-82d6-4e07-ae61-56ba5c36f743", // generated server-side
  "custom_id": "31-0C-1C-07-DB-16",
  "type": "custom",
  "author_id": "b7eff798-f8df-4364-8059-649c35c9ed0c", // generated server-side
  "created_at": "2017-10-12T15:19:21.010200Z", // generated server-side
  "content": {
    "custom": {
      "nested": "json"
    }
  },
  "recipients": "all",
  "properties": {
    // "Properties" object
  }
}
```

</CodeResponse>
</Code>
</Section>

## System message

<Section>
<Text>

System message event is native system event sent in specific situations.

| Field                 | Req./Opt. |                                                                                          Notes |
| --------------------- | :-------: | ---------------------------------------------------------------------------------------------: |
| `created_at`          | required  |                           Date & time format with a resolution of microseconds, `UTC string`.  |
| `recipients`          | required  | Possible values: `all` (default for system events), `agents` (for events sent via `send_event`)|
| `type`                | required  | `system_message`                                                                               |
| `system_message_type` | required  |                                                                                                |
| `custom_id`           | optional  |                                                                                                |

Here's the list of all system messages you might come across:

### `agent_added`

|                 Content                 |                                                                                      Generated when |
| :-------------------------------------: | --------------------------------------------------------------------------------------------------: |
| _%initiator% added %agent% to the chat_ | Agent was added to chat via the `add_user_to_chat` request and is not the first Agent in that chat. |

### `agent_joined`

|          Content          |                                                                                             Generated when |
| :-----------------------: | ---------------------------------------------------------------------------------------------------------: |
| _%agent% joined the chat_ | Agent added themselves to chat via the `add_user_to_chat` request, and is not the first Agent in the chat. |

### `agent_removed`

|                   Content                   |                                                       Generated when |
| :-----------------------------------------: | -------------------------------------------------------------------: |
| _%initiator% removed %agent% from the chat_ | Agent was removed from chat via the `remove_user_from_chat` request. |

### `archived_customer_disconnected`

|          Content           |                              Generated when |
| :------------------------: | ------------------------------------------: |
| _%customer% left the chat_ | Chat ended after Customer left the website. |

### `chat_transferred`

|                     Content                     |                                        Generated when |
| :---------------------------------------------: | ----------------------------------------------------: |
| _%initiator% transferred the chat to %targets%_ | Chat was transferred via the `transfer_chat` request. |

### `customer_added`

|                  Content                   |                                                 Generated when |
| :----------------------------------------: | -------------------------------------------------------------: |
| _%initiator% added %customer% to the chat_ | Customer was added to chat via the `add_user_to_chat` request. |

### `customer_banned`

|                                   Content                                    |                                                        Generated when |
| :--------------------------------------------------------------------------: | --------------------------------------------------------------------: |
| _Chat archived because customer was banned by %agent% for %duration% day(s)_ | Chat ended becaus Customer was banned via the `ban_customer` request. |

### `customer_removed`

|                    Content                     |                                                          Generated when |
| :--------------------------------------------: | ----------------------------------------------------------------------: |
| _%initiator% removed %customer% from the chat_ | Customer was removed from chat via the `remove_user_from_chat` request. |

### `manual_archived_agent`

|           Content           |                                    Generated when |
| :-------------------------: | ------------------------------------------------: |
| _%agent% archived the chat_ | Agent closed chat via the `close_thread` request. |

### `manual_archived_customer`

|            Content             |                                       Generated when |
| :----------------------------: | ---------------------------------------------------: |
| _%customer% archived the chat_ | Customer closed chat via the `close_thread` request. |

### `rating.chat_commented`

|                      Content                       |                  Generated when |
| :------------------------------------------------: | ------------------------------: |
| _%customer% left the following comment: %comment%_ | Chat was commented by Customer. |

### `rating.chat_rated`

|                Content                 |              Generated when |
| :------------------------------------: | --------------------------: |
| _%customer% rated the chat as %score%_ | Chat was rated by Customer. |

### `rating.chat_rating_canceled`

|                Content                |                         Generated when |
| :-----------------------------------: | -------------------------------------: |
| _%customer% canceled the chat rating_ | Chat rating was cancelled by Customer. |

### `routing.archived_deleted`

|                            Content                             |                                                                                                          Generated when |
| :------------------------------------------------------------: | ----------------------------------------------------------------------------------------------------------------------: |
| _The chat was closed because %agent% account had been deleted_ | Chat was archived after Agent was removed from the license. No other Agent could be selected, and queues were disabled. |

### `routing.archived_disconnected`

|                              Content                               |                                                                                                          Generated when |
| :----------------------------------------------------------------: | ----------------------------------------------------------------------------------------------------------------------: |
| _The chat was closed because %agent% had lost internet connection_ | Chat was archived after Agent unexpectedly lost connection. No other Agent could be selected, and queues were disabled. |

### `routing.archived_inactive`

|                         Content                         |                                              Generated when |
| :-----------------------------------------------------: | ----------------------------------------------------------: |
| _Chat archived due to %duration% minutes of inactivity_ | No new messages were posted for an extended amount of time. |

### `routing.archived_offline`

|                  Content                   |                                                 Generated when |
| :----------------------------------------: | -------------------------------------------------------------: |
| _Chat archived due to no available agents_ | No Agent could be selected after chat was placed in the queue. |

### `routing.archived_other`

|        Content        |                                                                                                                     Generated when |
| :-------------------: | ---------------------------------------------------------------------------------------------------------------------------------: |
| _The chat was closed_ | Chat was archived after Agent was removed from chat for other reasons. No other Agent could be selected, and queues were disabled. |

### `routing.archived_remotely_signed_out`

|                              Content                               |                                                                                              Generated when |
| :----------------------------------------------------------------: | ----------------------------------------------------------------------------------------------------------: |
| _The chat was closed because %agent% had been remotely signed out_ | Chat was archived after an Agent was logged out. No other Agent could be selected and queues were disabled. |

### `routing.archived_signed_out`

|                       Content                        |                                                                                        Generated when |
| :--------------------------------------------------: | ----------------------------------------------------------------------------------------------------: |
| _The chat was closed because %agent% had signed out_ | Chat was archived after Agent logged out. No other Agent could be selected, and queues were disabled. |

### `routing.assigned_deleted`

|                                     Content                                     |                                                                        Generated when |
| :-----------------------------------------------------------------------------: | ------------------------------------------------------------------------------------: |
| _Chat assigned to %addedAgent% because %removedAgent% account had been deleted_ | Chat was assigned to a new Agent after the previous one was removed from the license. |

### `routing.assigned_disconnected`

|                                       Content                                       |                                                                        Generated when |
| :---------------------------------------------------------------------------------: | ------------------------------------------------------------------------------------: |
| _Chat assigned to %addedAgent% because %removedAgent% had lost internet connection_ | Chat was assigned to a new Agent after the previous one unexpectedly lost connection. |

### `routing.assigned_inactive`

|                                            Content                                            |                                                                                 Generated when |
| :-------------------------------------------------------------------------------------------: | ---------------------------------------------------------------------------------------------: |
| _Chat assigned to %agent_added% because %agent_removed% hasn't replied in %duration% minutes_ | Chat was assigned to a new Agent after the previous one failed to response in a timely manner. |

### `routing.assigned_other`

|        Content        |                                                                                                                     Generated when |
| :-------------------: | ---------------------------------------------------------------------------------------------------------------------------------: |
| _The chat was closed_ | Chat was archived after Agent was removed from chat for other reasons. No other Agent could be selected, and queues were disabled. |

### `routing.assigned_remotely_signed_out`

|                                       Content                                       |                                                          Generated when |
| :---------------------------------------------------------------------------------: | ----------------------------------------------------------------------: |
| _Chat assigned to %addedAgent% because %removedAgent% had been remotely signed out_ | Chat was assigned to a new Agent after the previous one was logged out. |

### `routing.assigned_signed_out`

|                                Content                                |                                                      Generated when |
| :-------------------------------------------------------------------: | ------------------------------------------------------------------: |
| _Chat assigned to %addedAgent% because %removedAgent% had signed out_ | Chat was assigned to a new Agent after the previous one logged out. |

### `routing.idle`

|                        Content                         |                                              Generated when |
| :----------------------------------------------------: | ----------------------------------------------------------: |
| _Chat is idle due to %duration% minutes of inactivity_ | No new messages were posted for an extended amount of time. |

### `routing.unassigned_deleted`

|                            Content                             |                                            Generated when |
| :------------------------------------------------------------: | --------------------------------------------------------: |
| _Customer was queued because %agent% account has been deleted_ | Chat was queued after Agent was removed from the license. |

### `routing.unassigned_disconnected`

|                              Content                               |                                            Generated when |
| :----------------------------------------------------------------: | --------------------------------------------------------: |
| _Customer was queued because %agent% had lost internet connection_ | Chat was queued after Agent unexpectedly lost connection. |

### `routing.unassigned_other`

|       Content        |                                                       Generated when |
| :------------------: | -------------------------------------------------------------------: |
| _Chat is unassigned_ | Chat was queued after Agent was removed from chat for other reasons. |

### `routing.unassigned_remotely_signed_out`

|                              Content                               |                              Generated when |
| :----------------------------------------------------------------: | ------------------------------------------: |
| _Customer was queued because %agent% had been remotely signed out_ | Chat was queued after Agent was logged out. |

### `routing.unassigned_signed_out`

|                       Content                        |                          Generated when |
| :--------------------------------------------------: | --------------------------------------: |
| _Customer was queued because %agent% had signed out_ | Chat was queued after Agent logged out. |

### `system_archived`

|     Content     |                                                                     Generated when |
| :-------------: | ---------------------------------------------------------------------------------: |
| _Chat archived_ | License was moved to another lc_serv instance while there were still active chats. |

### `transcript_requested`

|                             Content                              |               Generated when |
| :--------------------------------------------------------------: | ---------------------------: |
| _%customer% requested the chat transcript to be sent to %email%_ | Customer enables transcript. |

### `transcript_sent`

|                     Content                      |                                           Generated when |
| :----------------------------------------------: | -------------------------------------------------------: |
| _%customer% sent the chat transcript to %email%_ | Chat ended with the chat transcript enabled by Customer. |

</Text>
<Code>
<CodeResponse title={'Sample System message event'}>

```json
{
  "id": "0affb00a-82d6-4e07-ae61-56ba5c36f743", // generated server-side
  "custom_id": "31-0C-1C-07-DB-16",
  "type": "system_message",
  "created_at": "2017-10-12T15:19:21.010200Z", // generated server-side
  "text": "hello there",
  "system_message_type": "routing.assigned",
  "text_vars": {
    "agent": "John Doe"
  }
}
```

</CodeResponse>
</Code>
</Section>

# Users

**Users** are another important data structure. Within this data structure type, we can distinguish:

- [Agent](#agent)
  - [My profile](#my-profile)
- [Customer](#customer)

## Agent

<CodeResponse title={'Sample Agent data structure'}>

```json
{
  "id": "agent1@example.com",
  "type": "agent",
  "name": "Support Team",
  "email": "agent1@example.com",
  "present": true,
  "events_seen_up_to": "2017-10-12T15:19:21.010200Z",
  "avatar": "cdn.livechatinc.com/avatars/1.png",
  "routing_status": "accepting_chats"
}
```

</CodeResponse>

| Field            | Req./Opt. |                                              Note |
| ---------------- | :-------: | ------------------------------------------------: |
| `routing_status` | optional  | Returned only if the Agent's currently logged in. |

### My profile

<CodeResponse title={'Sample My profile data structure'}>

```json
{
  "id": "agent1@example.com",
  "type": "agent",
  "name": "Support Team",
  "email": "agent1@example.com",
  "present": true,
  "events_seen_up_to": "2017-10-12T15:19:21.010200Z",
  "avatar": "cdn.livechatinc.com/avatars/1.png",
  "routing_status": "accepting_chats",
  "permission": "administrator"
}
```

</CodeResponse>

## Customer

<CodeResponse title={'Sample Customer data structure'}>

```json
{
  "id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
  "type": "customer",
  "name": "John Smith",
  "email": "customer1@example.com",
  "avatar": "domain.com/avatars/1.png",
  "last_visit": {
    "started_at": "2017-10-12T15:19:21.010200Z",
    "referrer": "http://www.google.com/",
    "ip": "194.181.146.130",
    "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36",
    "geolocation": {
      "country": "Poland",
      "country_code": "PL",
      "region": "Dolnoslaskie",
      "city": "Wroclaw",
      "timezone": "Europe/Warsaw"
    },
    "last_pages": [
      {
        "opened_at": "2017-10-12T15:19:21.010200Z",
        "url": "https://www.livechatinc.com/",
        "title": "LiveChat - Homepage"
      },
      {
        "opened_at": "2017-10-12T15:19:21.010200Z",
        "url": "https://www.livechatinc.com/tour",
        "title": "LiveChat - Tour"
      }
    ]
  },
  "fields": {
    "custom field name": "custom field value"
  },
  "statistics": {
    "chats_count": 3,
    "threads_count": 9,
    "visits_count": 5
  },
  "__priv_lc2_customer_id": "S1525771305.dafea66e5c", //old, lc2 customer_id
  "agent_last_event_created_at": "2017-10-12T15:19:21.010200Z",
  "customer_last_event_created_at": "2017-10-12T15:19:21.010200Z",
  "created_at": "2017-10-11T15:19:21.010200Z",
  "present": true, // optional, applies only to customer located in chat object
  "events_seen_up_to": "2017-10-12T15:19:21.010200Z" 
}
```

</CodeResponse>

| Field                            | Req./Opt. |                                     Note |
| -------------------------------- | :-------: | ---------------------------------------: |
| `agent_last_event_created_at`    | optional  |                                          |
| `avatar`                         | optional  |                                          |
| `customer_last_event_created_at` | optional  |                                          |
| `created_at`                     | optional  |                                          |
| `email`                          | optional  |                                          |
| `fields`                         | optional  | Isn't present when the chat is archived. |
| `name`                           | optional  |                                          |
| `events_seen_up_to`              | optional  | RFC 3339 datetime string                 |
| `last_visit`                     | optional  |                                          |
| `present`                        | optional  |                                          |
| `statistics`                     | optional  |                                          |

# Other common structures

Apart from [Events](#events) and [Users](#users), there are also other common data structures you might work with. Those are:

- [Access](#access)
- [Chats](#chats)
- [Chat summaries](#chat-summaries)
- [Properties](#properties)
- [Threads](#threads)

## Access

<CodeResponse title={'Sample Access data structure'}>

```json
{
  "access": {
    "group_ids": [1, 2]
  }
}
```

</CodeResponse>

| Field       | Req./Opt. |                                        Note |
| ----------- | :-------: | ------------------------------------------: |
| `group_ids` | required  | `group 0` means that all agents can see it. |

## Chats

<CodeResponse title={'Sample Chat data structure'}>

```json
{
  "id": "PJ0MRSHTDG",
  "users": [
    // array of "User" objects
  ],
  "threads": [
    // optional
    // "Thread" object
  ],
  "threads_summary": [
    {
      "thread_id": "K600PKZON8",
      "order": 129846129847
    },
    {
      "thread_id": "K600PKZON8",
      "order": 129846129848
    }
  ],
  "properites": {
    // "Properites" object
  },
  "access": {
    // "Access" object
  },
  "is_followed": true
}
```

</CodeResponse>

| Field        | Req./Opt. | Note |
| ------------ | :-------: | ---: |
| `properties` | optional  |      |
| `access`     | optional  |      |

## Chat summaries

**Chat summary** is similar to the **Chat** data structure. The difference is that **Chat** contains a `thread` object, while **Chat summary** includes `last_thread_summary` and `last_event_per_type`.

<CodeResponse title={'Sample Chat summary data structure'}>

```json
{
  "id": "PJ0MRSHTDG",
  "users": [
    // array of "User" objects
  ],
  "last_event_per_type": {
    // last event of each type in chat
    "message": {
      "thread_id": "K600PKZON8",
      "thread_order": 3,
      "event": {
        // "restricted_access": true
        // or
        // "Event > Message" object
      }
    },
    "system_message": {
      "thread_id": "K600PKZON6",
      "thread_order": 1,
      "event": {
        // "restricted_access": true
        // or
        // "Event > System message" object
      }
    }
    // ...
  },
  "last_thread_summary": {
    "id": "K600PKZON8",
    "order": 3,
    "timestamp": 1473433500,
    "user_ids": ["agent1@example.com"],
    "properites": {
      // "Properites" object
    },
    "tags": ["bug_report"]
  },
  "properites": {
    // "Properites" object
  },
  "access": {
    // "Access" object
  },
  "is_followed": false
}
```

</CodeResponse>

## Properties

Properties are **key-value storages**. They can be set within a chat, a thread, or an event. You can read more about properties in the [Configuration API](https://developers.livechatinc.com/docs/management/configuration-api/#properties) document.

<CodeResponse title={'Sample Properties data structure'}>

```json
{
  "properties": {
    "rating": {
      // <property_namespace>
      "score": {
        // <property_name>
        "value": 1 // <property_value>
      },
      "comment": {
        "value": "rated good!"
      }
    },
    "routing": {
      "idle": {
        "value": false
      }
    }
  }
}
```

</CodeResponse>

## Thread

<CodeResponse title={'Sample Thread data structure'}>

```json
{
  "id": "K600PKZON8",
  "timestamp": 1473433500,
  "active": true,
  "user_ids": ["agent1@example.com"],
  "restricted_access": true,
  "events": [
    // array of "Event" objects
  ],
  "order": 112057129857,
  "properties": {
    // "Properties" object
  },
  "access": {
    // "Access" object
  }
}
```

</CodeResponse>

| Field               | Req./Opt. |                                                                                 Note |
| ------------------- | :-------: | -----------------------------------------------------------------------------------: |
| `access`            | optional  |                                                                                    - |
| `active`            | required  | Possible values: `true` (thread is still active) or `false`(thread no longer active) |
| `events`            | optional  |                                     Doesn't exists if `restricted_access` is `true`. |
| `properties`        | optional  |                                                                                    - |
| `restricted_access` | optional  |                                                                                    - |

# Methods

In the websocket transport, actions generate [pushes](#pushes). RTM API actions can also trigger [webhooks](/management/configuration-api/#webhooks), but they need to be registered first. 

<Section>
<Text>

| The API endpoint: `wss://api.livechatinc.com/v3.1/agent/rtm/ws` |     |
| --------------------------------------------------------------- | --- |

## Available methods

|                 |                                                                                                                                                                                                                                                                                                                                                         |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Chats**       | [`get_chats_summary`](#get-chats-summary) [`get_chat_threads_summary`](#get-chat-threads-summary) [`get_chat_threads`](#get-chat-threads) [`get_archives`](#get-archives) [`start_chat`](#start-chat) [`activate_chat`](#activate-chat) [`close_thread`](#close-thread) [`follow_chat`](#follow-chat) [`unfollow_chat`](#unfollow-chat)                 |
| **Chat access** | [`grant_access`](#grant-access) [`revoke_access`](#revoke-access) [`set_access`](#set-access) [`transfer_chat`](#transfer-chat)                                                                                                                                                                                                                         |
| **Chat users**  | [`add_user_to_chat`](#add-user-to-chat) [`remove_user_from_chat`](#remove-user-from-chat)                                                                                                                                                                                                                                                               |
| **Events**      | [`send_event`](#send-event) [`send_rich_message_postback`](#send-rich-message-postback)                                                                                                                                                                                                                                                                 |
| **Properties**  | [`update_chat_properties`](#update-chat-properties) [`delete_chat_properties`](#delete-chat-properties) [`update_chat_thread_properties`](#update-chat-thread-properties) [`delete_chat_thread_properties`](#delete-chat-thread-properties) [`update_event_properties`](#update-event-properties) [`delete_event_properties`](#delete-event-properties) |
| **Thread tags** | [`tag_chat_thread`](#tag-chat-thread) [`untag_chat_thread`](#untag-chat-thread)                                                                                                                                                                                                                                                                         |
| **Customers**   | [`get_customers`](#get-customers) [`create_customer`](#create-customer) [`update_customer`](#update-customer) [`ban_customer`](#ban-customer)                                                                                                                                                                                                           |
| **Status**      | [`login`](#login) [`change_push_notifications`](#change-push-notifications) [`update_agent`](#update-agent) [`set_away_status`](#set-away-status) [`logout`](#logout)                                                                                                                                                                                   |
| **Other**       | [`mark_events_as_seen`](#mark-events-as-seen) [`send_typing_indicator`](#send-typing-indicator) [`multicast`](#multicast)                                                                                                                                                                                                                               |

</Text>
<Code>
<CodeSample path={'GENERAL RTM API REQUEST FORMAT'}>

```json
{
  "request_id": "<request_id>", // optional
  "action": "<action>",
  "payload": {
    // optional
  },
  "author_id": "<author_id>" // optional, applies only to bots
}
```

</CodeSample>
<CodeResponse title={'GENERAL RTM API RESPONSE FORMAT'}>

```json
{
  "request_id": "<request_id>", // optional
  "action": "<action>",
  "type": "response",
  "success": true,
  "payload": {
    // optional
  }
}
```

</CodeResponse>
</Code>
</Section>

## Chats

<Section>
<Text>

### Get Chats Summary

It returns [summaries](#chat-summaries) of the chats an Agent has access to.

#### Specifics

|                        |                                                   |
| ---------------------- | ------------------------------------------------- |
| **Action**             | `get_chats_summary`                               |
| **Required scopes \*** | `chats--all:ro` `chats--access:ro` `chats--my:ro` |
| **Web API equivalent** | [`get_chats_summary`](../#get-chats-summary)      |
| **Push message**       | -                                                 |

#### Request

| Request object                                        | Required | Type     | Notes                                                                                       |
| ----------------------------------------------------- | -------- | -------- | ------------------------------------------------------------------------------------------- |
| `filters`                                             | No       | `object` | Mustn't change between requests for subsequent pages. Otherwise, the behavior is undefined. |
| `filters.include_active`                              | No       | `bool`   | Defines if the returned chat summary includes active chats; default: `true`.                |
| `filters.group_ids`                                   | No       | `array`  | Array of group IDs.                                                                         |
| `filters.properties.<namespace>.<name>.<filter_type>` | No       | `any`    |                                                                                             |
| `pagination`                                          | No       | `object` |                                                                                             |
| `pagination.page`                                     | No       | `number` | Default: 1, minimum: 1, maximum: 1000                                                       |
| `pagination.total`                                    | No       | `number` | The total number of threads that match filters; default: 25, min: 0, max: 100.              |

`filter_type` can take the following values:

- exists (bool)
- values (type[] - array with specific type for property: `string`, `int`, or `bool`)
- exclude_values (type[] - array with specific type for property: `string`, `int`, or `bool`)

There's only one value allowed for a single property.

#### Response

| Parameter     | Data type | Notes                                                                     |
| ------------- | --------- | ------------------------------------------------------------------------- |
| `found_chats` | `number`  | An estimated number. The real number of found chats can slightly differ . |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_chats_summary",
  "payload": {}
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "get_chats_summary",
  "type": "response",
  "success": true,
  "payload": {
    	"chats_summary": [{
		    "id": "PJ0MRSHTDG",
		    "users": [
		    	// array of "User" objects
		    ],
		    "last_event_per_type": { // last event of each type in chat
		    	"message": {
		    		"thread_id": "K600PKZON8",
		    		"thread_order": 3,
		    		"event": {
		    			// "restricted_access": true
		    			// or
		    			// "Event > Message" object
		    		}
		    	},
		    	"system_message": {
		    		"thread_id": "K600PKZON6",
		    		"thread_order": 1,
		    		"event": {
		    			// "restricted_access": true
		    			// or
		    			// "Event > System message" object
		    		}
		    	},
		    	...
		    },
		    "last_thread_summary": {
		    	"id": "K600PKZON8",
		    	"order": 3,
		    	"timestamp": 1473433500,
		    	"user_ids": ["agent1@example.com"],
		    	"properites": {
		    	// "Properites" object
		    	},
		    	"tags": ["bug_report"]
		    },
		    "properites": {
		    	// "Properites" object
		    },
		    "access": {
		    	// "Access" object
		    },
		    "is_followed": false
	    }],
	    "found_chats": 2340,
	    "next_page_id": "MTUxNzM5ODEzMTQ5Ng==", // optional
	    "previous_page_id": "MTUxNzM5ODEzMTQ5Nw==" // optional
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Get Chat Threads Summary

#### Specifics

|                        |                                                            |
| ---------------------- | ---------------------------------------------------------- |
| **Action**             | `get_chat_threads_summary`                                 |
| **Required scopes**    | `chats--all:ro` `chats--access:ro` `chats--my:ro`          |
| **Web API equivalent** | [`get_chat_threads_summary`](../#get-chat-threads-summary) |
| **Push message**       | -                                                          |

#### Request

| Parameter | Required | Data ype | Notes                                                                              |
| --------- | -------- | -------- | ---------------------------------------------------------------------------------- |
| `chat_id` | Yes      | `string` |                                                                                    |
| `order`   | No       | `string` | Possible values: `asc` - oldest chats firstm `desc` - newest chats first (default) |
| `limit`   | No       | `number` | Defaul: 10, maximum: 100                                                           |
| `page_id` | No       | `string` |                                                                                    |

#### Response

| Parameter       | Data type | Notes                           |
| --------------- | --------- | ------------------------------- |
| `found_threads` | `number`  | The number of threads in a chat |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_chat_threads_summary",
  "payload": {
    "chat_id": "PJ0MRSHTDG"
  }
}
```

</CodeSample>

<!-- > **`get_chat_threads_summary`** sample **request** with optional params

```json
{
	"request_id": "23456", // optional
	"action": "get_chat_threads_summary",
	"payload": {
			"chat_id": "PJ0MRSHTDG",
			"limit": 25,
			"page_id": "MjpkZXNj"
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "get_chat_threads_summary",
  "type": "response",
  "success": true,
  "payload": {
    "threads_summary": [
      {
        "id": "PT039ES4OG",
        "order": 2,
        "events_count": 2
      },
      {
        "id": "PT039DS6IP",
        "order": 1,
        "events_count": 17
      }
    ],
    "found_threads": 7,
    "next_page_id": "MTUxNzM5ODEzMTQ5Ng==", // optional
    "previous_page_id": "MTUxNzM5ODEzMTQ5Nw==" // optional
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Get Chat Threads

It returns threads that the current Agent has access to in a given chat.

#### Specifics

|                        |                                            |
| ---------------------- | ------------------------------------------ |
| **Action**             | `get_chat_threads`                         |
| **Required scopes**    | `chats--all:ro` `chats--access:ro`         |
| **Web API equivalent** | [`get_chat_threads`](../#get-chat-threads) |
| **Push message**       | -                                          |

#### Request

| Parameter    | Required | Data ype |     |
| ------------ | -------- | -------- | --- |
| `chat_id`    | Yes      | `string` |     |
| `thread_ids` | No       | `array`  |     |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_chat_threads",
  "payload": {
    "chat_id": "PJ0MRSHTDG"
  }
}
```

</CodeSample>

<!-- > **`get_chat_threads`** sample **request** with optional params

```json
{
	"action": "get_chat_threads",
	"payload": {
		"chat_id": "PJ0MRSHTDG",
		"thread_ids": ["K600PKZON8"]
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "get_chat_threads",
  "type": "response",
  "success": true,
  "payload": {
    "chat": {
      "id": "PJ0MRSHTDG",
      "users": [
        // array of "User" objects
      ],
      "threads": [
        // optional
        // "Thread" object
      ],
      "threads_summary": [
        {
          "thread_id": "K600PKZON8",
          "order": 129846129847
        },
        {
          "thread_id": "K600PKZON8",
          "order": 129846129848
        }
      ],
      "properites": {
        // "Properites" object
      },
      "access": {
        // "Access" object
      }
    }
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Get Archives

It returns a list of the chats an Agent has access to. Together with a **chat**, the **events** of **one thread** from this chat are returned.

The list classification is based on threads; 1 chat per 1 thread. Thus, the same **chat** object may appear on the list several times, but each time with a different **thread**. The returned **chat** is a complete object, not only a **chat summary**.

#### Specifics

|                        |                                                   |
| ---------------------- | ------------------------------------------------- |
| **Action**             | `get_archives`                                    |
| **Required scopes**    | `chats--all:ro` `chats--access:ro` `chats--my:ro` |
| **Web API equivalent** | [`get_archives`](../#get-archives)                |
| **Push message**       | -                                                 |

#### Request

| Parameter                                             | Required | Data type | Notes                                                                                     |
| ----------------------------------------------------- | -------- | --------- | ----------------------------------------------------------------------------------------- |
| `filters`                                             | No       | `object`  |                                                                                           |
| `filters.query`                                       | No       | `string`  |                                                                                           |
| `filters.date_from`                                   | No       | `string`  | `YYYY-MM-DD` format                                                                       |
| `filters.date_to`                                     | No       | `string`  | `YYYY-MM-DD` format                                                                       |
| `filters.agent_ids`                                   | No       | `array`   | Array of agent IDs                                                                        |
| `filters.thread_ids`                                  | No       | `array`   | Array of thread IDs. Cannot be used with other filters or pagination; max array size: 20. |
| `filters.group_ids`                                   | No       | `array`   | Array of group IDs                                                                        |
| `filters.properties.<namespace>.<name>.<filter_type>` | No       | `any`     | **\*** __described below__                                                                |    
| `filters.tags.<filter_type>`                          | No       | `any`     |                                                                                           |
| `filters.sales.<filter_type>`                         | No       | `any`     |                                                                                           |
| `filters.goals.<filter_type>`                         | No       | `any`     |                                                                                           |
| `filters.surveys.<survey>`                            | No       | `array`   | **\**** __described below__                                                               |
| `pagination`                                          | No       | `object`  |                                                                                           |
| `pagination.page`                                     | No       | `number`  | Default: 1, min: 1, max: 1000                                                             |
| `pagination.limit`                                    | No       | `number`  | Default: 25, min: 0, max: 100                                                             |

**\*)**
`<filter_type>` can take the following values:

- `exists` (`bool`)
- `values` (`type[]` - an array with aspecific type for property: `string`, `int` or `bool`)
- `exclude_values` (`type[]` - array with specific type for property: `string`, `int` or `bool`)

There's only one value allowed for a single property.

**\**)**
`<survey>` contains the following fields:
  * `type` (`string`) - allowed values: `pre_chat`, `post_chat`
  * `answer_id` (`string`)

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_archives",
  "payload": {}
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "get_archives",
  "type": "response",
  "success": true,
  "payload": {
    "chats": [
        {
          "id": "Q1GZ3FNAT9",
          "users": [
              {
                  "id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
                  "type": "customer",
                  "present": true,
                  "created_at": "2019-12-04T10:49:21.218116+01:00",
                  "statistics": {
                      "chats_count": 1,
                      // ...
                  },
                  "customer_last_event_created_at": "2019-12-04T10:54:32.999000+01:00"
              },
              {
                  "id": "agent1@example.com",
                  "name": "Agent Name",
                  "email": "agent1@example.com",
                  "type": "agent",
                  "present": false,
                  "avatar": "https://domain.com/avatar.jpg"
              }
          ],
          "thread": {
              "id": "Q1GZ3FNAU9",
              "timestamp": 1575452961,
              "active": false,
              "user_ids": [
                  "agent1@example.com",
                  "b7eff798-f8df-4364-8059-649c35c9ed0c"
              ],
              "events": [
                  {
                      "id": "Q1GZ3FNAU9_1",
                      "created_at": "2019-12-04T09:54:32.999000Z",
                      "recipients": "all",
                      "type": "message",
                      "text": "Hello",
                      "author_id": "b7eff798-f8df-4364-8059-649c35c9ed0c"
                  },
              // "events": ...
              ],
              "order": 1,
              "properties": {
                  "routing": {
                      "continuous": {
                          "value": false
                      },
                      "idle": {
                          "value": false
                      }
                  }
              },
              "access": {
                  "group_ids": [0]
              }
          },
          "properties": {
            // "Properties" object
          },
          "access": {
              "group_ids": [0]
          },
          "is_followed": false
        },
        // "id" : ...
    ],
    "pagination": {
        "page": 1,
        "total": 45 // total number of threads that match filters
    }
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Start Chat

Starts a chat.

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Action**             | `start_chat`                                                                             |
| **Required scopes \*** | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **Web API equivalent** | [`start_chat`](../#start-chat)                                                           |
| **Push message**       | [`incoming_chat_thread`](#incoming_chat_thread)                                          |

**\*)**
When `chat.users` is defined, one of following scopes is required:

- `chats--all:rw`
- `chats--access:rw`
- `chats--my:rw`

#### Request

| Parameters               | Required | Data type | Notes                                                                   |
| ------------------------ | -------- | --------- | ----------------------------------------------------------------------- |
| `chat`                   | No       | `object`  |                                                                         |
| `chat.properties`        | No       | `object`  |                                                                         |
| `chat.access`            | No       | `object`  |                                                                         |
| `chat.users`             | No       | `array`   | The list of existing users. Only one user is allowed (type `customer`). |
| `chat.thread`            | No       | `object`  |                                                                         |
| `chat.thread.events`     | No       | `array`   | The list of initial chat events                                         |
| `chat.thread.properties` | No       | `object`  |                                                                         |
| `continuous`             | No       | `bool`    | Starts chat as continuous (online group is not required); default: `false`. |

#### Response

| Parameter   | Data type  | Notes |
| ----------- | ---------- | ----- |
| `chat_id`   | `string`   |       |
| `thread_id` | `string`   |       |
| `event_ids` | `[]string` | Returned only when the chat was started with initial events. Returns only the IDs of user-generated events; server-side generated events are not included in the array. | 

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "start_chat",
  "payload": {}
}
```

</CodeSample>

<!-- > **`start_chat`** sample **request** with optional params

```json
{
	"action": "start_chat",
	"payload": {
	"chat": {
		"properties": {
			"source": {
				"type": "facebook"
			},
			// ...
		},
		"users": [{
			"id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
			"type": "customer"
		}],
		"thread": {
			"events": [{
				"type": "message",
				"custom_id": "31-0C-1C-07-DB-16",
				"text": "hello there",
				"recipients": "all"
			}, {
				"type": "system_message",
				"custom_id": "31-0C-1C-07-DB-16",
				"text": "hello there",
				"recipients": "agents"
			}],
			"properties": {
				"source": {
					"type": "facebook"
				},
				// ...
			},
			"tags": ["bug_report"]
		}
		"access": {
			"group_ids": [1]
		},
		"is_followed": true
	},
	"continuous": true
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "start_chat",
  "type": "response",
  "success": true,
  "payload": {
      "chat_id": "PJ0MRSHTDG",
      "thread_id": "PGDGHT5G"
    }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Activate Chat

Restarts an archived chat.

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Action**             | `activate_chat`                                                                          |
| **Required scopes \*** | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **Web API equivalent** | [`activate_chat`](../#activate-chat)                                                     |
| **Push message**       | [`incoming_chat_thread`](#incoming_chat_thread)                                          |

**\*)**
When `chat.users` is defined, one of following scopes is required:

- `chats--all:rw`
- `chats--access:rw`
- `chats--my:rw`

#### Request

| Request object           | Required | Type     | Notes                                                               |
| ------------------------ | -------- | -------- | ------------------------------------------------------------------- |
| `chat`                   | Yes      | `object` |                                                                     |
| `chat.id`                | Yes      | `string` | The ID of the chat that will be activated.                          |
| `chat.access`            | No       | `object` | Chat access to set, default: all agents.                            |
| `chat.properties`        | No       | `object` | Initial chat properties                                             |
| `chat.users`             | No       | `array`  | List of existing users. Only one user is allowed (type `customer`). |
| `chat.thread`            | No       | `object` |                                                                     |
| `chat.thread.events`     | No       | `array`  | Initial chat events array                                           |
| `chat.thread.properties` | No       | `object` | Initial chat thread properties                                      |
| `continuous`             | No       | `bool`   | Sets a chat to the continuous mode. When unset, leaves the mode unchanged. |

#### Response

| Parameter   | Data type  | Notes |
| ----------- | ---------- | ----- |
| `thread_id` | `string`   |       |
| `event_ids` | `[]string` | Returned only when the chat was activated with initial events. Returns only the IDs of user-generated events; server-side generated events are not included in the array.|

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "activate_chat",
  "payload": {
    "chat": {
      "id": "PWJ8Y4THAV"
    }
  }
}
```

</CodeSample>

<!-- > **`activate_chat`** sample **request** with optional params

```json
{
	"request_id": "7676",
	"action": "activate_chat",
	"payload": {
	"chat": {
		"id": "PJ0MRSHTDG",
		"access": {
			"group_ids": [1]
		},
		"properties": {
			"source": {
				"type": "facebook"
			}
		},
		"thread": {
			"events": [{
				"type": "message",
				"custom_id": "31-0C-1C-07-DB-16",
				"text": "hello there"
			}, {
				"type": "system_message",
				"custom_id": "31-0C-1C-07-DB-16",
				"text": "hello there"
			}],
			"properties": {
				"source": {
					"type": "facebook"
				},
				// ...
			},
			"tags": ["bug_report"]
			}
		}
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "<action>",
  "type": "response",
  "success": true,
  "payload": {
    "thread_id": "Z8AGR5OUW"
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Close Thread

Closes a thread. Sending messages to this thread will no longer be possible.

#### Specifics

|                        |                                                   |
| ---------------------- | ------------------------------------------------- |
| **Action**             | `close_thread`                                    |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw` |
| **Web API equivalent** | [`close_thread`](../#close-thread)                |
| **Push message**       | [`thread_closed`](#thread_closed)                 |

#### Request

| Parameter | Required | Data type |  |
| --------- | -------- | --------- | ----- |
| `chat_id` | Yes      | `string`  |       |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "close_thread",
  "payload": {
    "chat_id": "PJ0MRSHTDG"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "close_thread",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Follow Chat

Marks a chat as followed. All changes to the chat will be sent to the requester until the chat is reactivated or unfollowed. Chat members don't need to follow their chats. They receive all chat pushes regardless of their follower status.

#### Specifics

|                        |                                                       |
| ---------------------- | ----------------------------------------------------- |
| **Action**             | `follow_chat`                                         |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`     |
| **Web API equivalent** | [`follow_chat`](../#follow-chat)                      |
| **Push message**       | [`incoming_chat_thread`](#incoming_chat_thread)**\*** |

**\*)**
It won't be sent when the requester already follows the chat or is the chat member.

#### Request

| Parameter | Required | Data type |  |
| --------- | -------- | --------- | ----- |
| `chat_id` | Yes      | `string`  |       |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "follow_chat",
  "payload": {
    "chat_id": "PW94SJTGW6"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "follow_chat",
  "type": "response",
  "success": true,
  "payload": {
    "chat_id": "PW94SJTGW6"
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Unfollow Chat

Removes the requester from the chat followers. After that, only key changes to the chat (like `transfer_chat` or `close_active_thread`) will be sent to the requester. Chat members cannot unfollow the chat.

#### Specifics

|                        |                                      |
| ---------------------- | ------------------------------------ |
| **Action**             | `unfollow_chat`                      |
| **Required scopes**    | -                                    |
| **Web API equivalent** | [`unfollow_chat`](../#unfollow-chat) |
| **Push message**       | -                                    |

#### Request

| Parameter | Required | Data type |     |
| --------- | -------- | --------- | --- |
| `chat_id` | Yes      | `string`  |     |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "unfollow_chat",
  "payload": {
    "chat_id": "PWF6BACIKO"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "unfollow_chat",
  "type": "response",
  "success": true,
  "payload": {
    "chat_id": "PWF6BACIKO"
  }
}
```

</CodeResponse>
</Code>
</Section>

## Chat access

<Section>
<Text>

### Grant Access

Grants access to a new resource without overwriting the existing ones.

#### Specifics

|                        |                                                   |
| ---------------------- | ------------------------------------------------- |
| **Action**             | `grant_access`                                    |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw` |
| **Web API equivalent** | [`grant_access`](../#grant-access)                |
| **Push message**       | [`access_granted`](#access_granted)               |

#### Request

| Parameter     | Required | Data ype | Notes                |
| ------------- | -------- | -------- | -------------------- |
| `resource`    | Yes      | `string` | `chat` or `customer` |
| `id`          | Yes      | `string` | Resource Id          |
| `access`      | Yes      | `object` | The entity that is granted access to the specified resource |
| `access.type` | Yes      | `string` | `group`              |
| `access.id`   | Yes      | `number` |                      |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "grant_access",
  "payload": {
    "resource": "chat",
    "id": "PW94SJTGW6",
    "access": {
      "type": "group",
      "id": 19
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "grant_access",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Revoke Access

#### Specifics

|                        |                                                   |
| ---------------------- | ------------------------------------------------- |
| **Action**             | `revoke_access`                                   |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw` |
| **Web API equivalent** | [`revoke_access`](../#revoke-access)              |
| **Push message**       | [`access_revoked`](#access_revoked)               |

#### Request

| Parameter     | Required | Data type | Notes                |
| ------------- | -------- | --------- | -------------------- |
| `resource`    | Yes      | `string`  | `chat` or `customer` |
| `id`          | Yes      | `string`  | Resource Id          |
| `access`      | Yes      | `object`  | The entity that loses access to the specified resource |
| `access.type` | Yes      | `string`  | `group`              |
| `access.id`   | Yes      | `number` |                    |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "revoke_access",
  "payload": {
    "resource": "chat",
    "id": "PW94SJTGW6",
    "access": {
      "type": "group",
      "id": 19
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "revoke_access",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Set Access

Gives access to a new resource overwriting the existing ones.

#### Specifics

|                        |                                                   |
| ---------------------- | ------------------------------------------------- |
| **Action**             | `set_access`                                      |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw` |
| **Web API equivalent** | [`set_access`](../#set-access)                    |
| **Push message**       | [`access_set`](#access_set)                       |

#### Request

| Request object | Required | Type     | Notes                |
| -------------- | -------- | -------- | -------------------- |
| `resource`     | Yes      | `string` | `chat` or `customer` |
| `id`           | Yes      | `string` | Resource Id          |
| `access`       | Yes      | `object` | The entity that is given access to the specified resource |
| `access.type`  | Yes      | `string` | `group`              |
| `access.id`    | Yes      | `number` |                   |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "set_access",
  "payload": {
    "resource": "chat",
    "id": "PW94SJTGW6",
    "access": {
      "type": "group",
      "id": 19
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "set_access",
  "type": "response",
  "success": true,
  "payload": {
    // no response optional
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Transfer Chat

Transfers a chat to an Agent or a group.

#### Specifics

|                        |                                                   |
| ---------------------- | ------------------------------------------------- |
| **Action**             | `transfer_chat`                                   |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw` |
| **Web API equivalent** | [`transfer_chat`](../#transfer-chat)              |
| **Push message**       | [`chat_transferred`](#chat_transferred)           |

#### Request

| Parameter     | Required | Data ype | Notes                                                                                                                           |
| ------------- | -------- | -------- | ------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`     | Yes      | `string` | Resource Id                                                                                                                     |
| `target`      | No       | `object` | If missing, the chat will be transferred within the current group.                                                              |
| `target.type` | Yes      | `string` | `group` or `agent`                                                                                                              |
| `target.ids`  | Yes      | `array`  | `group` or `agent` IDs array                                                                                                    |
| `force`       | No       | `bool`   | If `true`, always transfers chats. Otherwise, fails when unable to assign any Agent from the requested groups; default `false`. |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "transfer_chat",
  "payload": {
    "chat_id": "PWF6BACIKO",
    "target": {
      "type": "group",
      "ids": [19]
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "transfer_chat",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

## Chat users

### Add User to Chat

Adds a user to the chat. You can't add more than one `customer` user type to the chat.

#### Specifics

|                        |                                                   |
| ---------------------- | ------------------------------------------------- |
| **Action**             | `add_user_to_chat`                                |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw` |
| **Web API equivalent** | [`add_user_to_chat`](../#add-user-to-chat)        |
| **Push message**       | [`chat_user_added`](#chat_user_added)             |

#### Request

| Request object | Required | Type     | Notes                                  |
| -------------- | -------- | -------- | -------------------------------------- |
| `chat_id`      | Yes      | `string` |                                        |
| `user_id`      | Yes      | `string` |                                        |
| `user_type`    | Yes      | `string` | Possible values: `agent` or `customer` |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "add_user_to_chat",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "user_id": "agent1@example.com",
    "user_type": "agent"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "add_user_to_chat",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Remove User from Chat

Removes a user from chat. Removing `customer` user type is not allowed. It's always possible to remove the requester from chat.

#### Specifics

|                        |                                                      |
| ---------------------- | ---------------------------------------------------- |
| **Action**             | `remove_user_from_chat`                              |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`    |
| **Web API equivalent** | [`remove_user_from_chat`](../#remove-user-from-chat) |
| **Push message**       | [`chat_user_added`](#chat_user_added)                |

**Request payload**

| Request object | Required | Type     | Notes                                     |
| -------------- | -------- | -------- | ----------------------------------------- |
| `chat_id`      | Yes      | `string` |                                           |
| `user_id`      | Yes      | `string` |                                           |
| `user_type`    | Yes      | `string` | Possible values are `agent` or `customer` |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "remove_user_from_chat",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "user_id": "agent1@example.com",
    "user_type": "agent"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "remove_user_from_chat",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

## Events

### Send Event

Sends an [Event](#events) object.

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Action**             | `send_event`                                                                             |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **Web API equivalent** | [`send_event`](../#send-event)                                                           |
| **Push message**       | [`incoming_event`](#incoming_event)                                                                                        |

#### Request

| Parameters              | Required | Data type | Notes                                                                                                        |
| ----------------------- | -------- | --------- | ------------------------------------------------------------------------------------------------------------ |
| `chat_id`               | Yes      | `string`  | Id of the chat you want to send the message to.                                                              |
| `event`                 | Yes      | `object`  | Event object                                                                                                 |
| `attach_to_last_thread` | No       | `bool`    | If `true`, adds an event to last (inactive) thread. Otherwise, it doesn't create a new one; default `false`. |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "send_event",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "event": {
      "type": "message",
      "text": "hello world",
      "recipients": "all"
    }
  }
}
```

</CodeSample>

<!-- > **`send_event`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "send_event",
	"payload": {
		  "event_id": "K600PKZON8"
		},
	}
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "send_event",
  "type": "response",
  "success": true,
  "payload": {
      "event_id": "K600PKZON8"
    }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Send Rich Message Postback

#### Specifics

|                        |                                                                           |
| ---------------------- | ------------------------------------------------------------------------- |
| **Action**             | `send_rich_message_postback`                                              |
| **Required scopes**    | `chats.conversation--my:rw` `chats.conversation--all:rw`                  |
| **Web API equivalent** | [`send_rich_message_postback`](../#send-rich-message-postback)            |
| **Push message**       | [`incoming_rich_message_postback`](#incoming_rich_message_postback)**\*** |

**\*)** `incoming_rich_message_postback` will be sent only for active threads.

#### Request

| Parameter          | Required | Data type | Notes                               |
| ------------------ | -------- | --------- | ----------------------------------- |
| `chat_id`          | Yes      | `string`  |                                     |
| `event_id`         | Yes      | `string`  |                                     |
| `postback`         | Yes      | `object`  |                                     |
| `postback.id`      | Yes      | `string`  | Postback name of the button         |
| `postback.toggled` | Yes      | `bool`    | Postback toggled; `true` or `false` |
| `thread_id`        | Yes      | `string`  |                                     |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "send_rich_message_postback",
  "payload": {
    "chat_id": "PJ0MRSHTDG",
    "thread_id": "K600PKZON8",
    "event_id": "a0c22fdd-fb71-40b5-bfc6-a8a0bc3117f7",
    "postback": {
      "id": "Method URL_yes",
      "toggled": true
    }
  }
}
```

</CodeSample>

<!-- > **`send_rich_message_postback`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "send_rich_message_postback",
	"payload": {
		"chat_id": "PJ0MRSHTDG",
        "thread_id": "K600PKZON8",
        "event_id": "a0c22fdd-fb71-40b5-bfc6-a8a0bc3117f7",
        "postback": {
            "id": "Method URL_yes",
            "toggled": true
        }
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "send_rich_message_postback",
  "type": "response",
  "success": true,
  "payload": {
    //no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

## Properties

### Update Chat Properties

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Action**             | `update_chat_properties`                                                                 |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **Web API equivalent** | [`update_chat_properties`](../#update-chat-properties)                                   |
| **Push message**       | [`chat_properties_updated`](#chat_properties_updated)                                    |

#### Request

| Parameter    | Required | Data type | Notes                                     |
| ------------ | -------- | --------- | ----------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you to set a property for. |
| `properties` | Yes      | `object`  | Chat properties to set. You should stick to the [general properties format](/management/configuration-api/#properties) and include _namespace_, _property name_ and _value_.  |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "update_chat_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": {
        "score": 10,
        "comment": "Thank you!"
      }
    }
  }
}
```

</CodeSample>

<!-- > **`update_chat_properties`** sample **request** with optional params

```json
{
	"request_id": "93875", // optional
	"action": "update_chat_properties",
	"payload": {
		"chat_id": "PW94SJTGW6",
        "properties": {
            "bb9e5b2f1ab480e4a715977b7b1b4279": {
                "score": 10,
                "comment": "Thank you!"
            }
        }
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "update_chat_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Delete Chat Properties

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Action**             | `delete_chat_properties`                                                                 |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **Web API equivalent** | [`delete_chat_properties`](../#delete-chat-properties)                                   |
| **Push message**       | [`chat_properties_deleted`](#chat_properties_deleted)                                    |

#### Request

| Parameter    | Required | Data type | Notes                                           |
| ------------ | -------- | --------- | ----------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to delete property for. |
| `properties` | Yes      | `object`  | Chat properties to delete. |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "delete_chat_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": ["score", "comment"]
    }
  }
}
```

</CodeSample>

<!-- > **`delete_chat_properties`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "delete_chat_properties",
	"payload": {
		"chat_id": "PW94SJTGW6",
        "properties": {
            "bb9e5b2f1ab480e4a715977b7b1b4279": [
                "score",
                "comment"
            ]
        }
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "delete_chat_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Update Chat Thread Properties

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Action**             | `update_chat_thread_properties`                                                          |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **Web API equivalent** | [`update_chat_thread_properties`](../#update-chat-thread-properties)                     |
| **Push message**       | [`chat_thread_properties_updated`](#chat_thread_properties_updated)                      |

#### Request

| Parameter    | Required | Data type | Notes                                            |
| ------------ | -------- | --------- | ------------------------------------------------ |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to set properties for.   |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to set properties for. |
| `properties` | Yes      | `object`  | Chat properties to set. You should stick to the [general properties format](/management/configuration-api/#properties) and include _namespace_, _property name_ and _value_.  |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "update_chat_thread_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "thread_id": "K600PKZON8",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": {
        "score": 10,
        "comment": "Thank you!"
      }
    }
  }
}
```

</CodeSample>

<!-- > **`update_chat_thread_properties`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "update_chat_thread_properties",
	"payload": {
		"chat_id": "PW94SJTGW6",
        "thread_id": "K600PKZON8",
        "properties": {
            "bb9e5b2f1ab480e4a715977b7b1b4279": {
                "score": 10,
                "comment": "Thank you!"
            }
        }
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "update_chat_thread_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Delete Chat Thread Properties

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Action**             | `delete_chat_thread_properties`                                                          |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **Web API equivalent** | [`delete_chat_thread_properties`](../#delete-chat-thread-properties)                     |
| **Push message**       | [`chat_thread_properties_deleted`](#chat_thread_properties_deleted)                      |

#### Request

| Parameter    | Required | Data type | Notes                                             |
| ------------ | -------- | --------- | ------------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to delete property for.   |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to delete property for. |
| `properties` | Yes      | `object`  | Chat thread properties to delete. |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "delete_chat_thread_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "thread_id": "K600PKZON8",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": ["score", "comment"]
    }
  }
}
```

</CodeSample>

<!-- > **`delete_chat_thread_properties`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "delete_chat_thread_properties",
	"payload": {
		"chat_id": "PW94SJTGW6",
        "thread_id": "K600PKZON8",
        "properties": {
            "bb9e5b2f1ab480e4a715977b7b1b4279": [
                "score",
                "comment"
            ]
        }
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "delete_chat_thread_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Update Event Properties

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Action**             | `update_event_properties`                                                                |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **Web API equivalent** | [`update_event_properties`](../#update-event-properties)                                 |
| **Push message**       | [`event_properties_updated`](#event_properties_updated)                                  |

#### Request

| Parameter    | Required | Data type | Notes                                            |
| ------------ | -------- | --------- | ------------------------------------------------ |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to set properties for.   |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to set properties for. |
| `event_id`   | Yes      | `string`  | Id of the event you want to set properties for.  |
| `properties` | Yes      | `object`  | Chat properties to set. |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "update_event_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "thread_id": "K600PKZON8",
    "event_id": "2_EW2WQSA8",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": {
        "score": 10,
        "comment": "Thank you!"
      }
    }
  }
}
```

</CodeSample>

<!-- > **`update_event_properties`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "update_event_properties",
	"payload": {
		"chat_id": "PW94SJTGW6",
        "thread_id": "K600PKZON8",
        "event_id": "2_EW2WQSA8",
        "properties": {
            "bb9e5b2f1ab480e4a715977b7b1b4279": {
                "score": 10,
                "comment": "Thank you!"
            }
        }
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "update_event_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Delete Event Properties

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Action**             | `delete_event_properties`                                                                |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **Web API equivalent** | [`delete_event_properties`](../#delete-event-properties)                                 |
| **Push message**       | [`event_properties_deleted`](#event_properties_deleted)                                  |

#### Request

| Parameter    | Required | Data type | Notes                                             |
| ------------ | -------- | --------- | ------------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to delete the properties of.   |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to delete the properties of. |
| `event_id`   | Yes      | `string`  | Id of the event you want to delete the properties of.  |
| `properties` | Yes      | `object`  | Event properties to delete. You should stick to the [general properties format](/management/configuration-api/#properties) and include _namespace_, _property name_ and _value_.  |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "delete_event_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "thread_id": "K600PKZON8",
    "event_id": "2_EW2WQSA8",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": {
        "rating": ["score", "comment"]
      }
    }
  }
}
```

</CodeSample>

<!-- > **`delete_event_properties`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "delete_event_properties",
	"payload": {
		"chat_id": "PW94SJTGW6",
        "thread_id": "K600PKZON8",
        "event_id": "2_EW2WQSA8",
        "properties": {
            "bb9e5b2f1ab480e4a715977b7b1b4279": {
                "rating": [
                    "score",
                    "comment"
                ]
            }
        }
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "delete_event_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

## Thread tags

### Tag Chat Thread

#### Specifics

|                        |                                                   |
| ---------------------- | ------------------------------------------------- |
| **Action**             | `tag_chat_thread`                                 |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw` |
| **Web API equivalent** | [`tag_chat_thread`](../#tag-chat-thread)          |
| **Push message**       | [`chat_thread_tagged`](#chat_thread_tagged)       |

#### Request

| Parameter   | Required | Data type | Notes                                      |
| ----------- | -------- | --------- | ------------------------------------------ |
| `chat_id`   | Yes      | `string`  | Id of the chat you want to add a tag to.   |
| `thread_id` | Yes      | `string`  | Id of the thread you want to add a tag to. |
| `tag`       | Yes      | `string`  | Tag name                                   |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "tag_chat_thread",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "thread_id": "PWS6GIKAKH",
    "tag": "support"
  }
}
```

</CodeSample>

<!-- > **`tag_chat_thread`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "tag_chat_thread",
	"payload": {
		"chat_id": "PW94SJTGW6",
		"thread_id": "PWS6GIKAKH",
		"tag": "support"
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "tag_chat_thread",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Untag Chat Thread

#### Specifics

|                        |                                                   |
| ---------------------- | ------------------------------------------------- |
| **Action**             | `untag_chat_thread`                               |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw` |
| **Web API equivalent** | [`untag_chat_thread`](../#untag-chat-thread)      |
| **Push message**       | [`chat_thread_untagged`](#chat_thread_untagged)   |

#### Request

| Parameter   | Required | Data type | Notes                                           |
| ----------- | -------- | --------- | ----------------------------------------------- |
| `chat_id`   | Yes      | `string`  | Id of the chat you want to remove a tag from.   |
| `thread_id` | Yes      | `string`  | Id of the thread you want to remove a tag from. |
| `tag`       | Yes      | `string`  | Tag name                                        |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "untag_chat_thread",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "thread_id": "PWS6GIKAKH",
    "tag": "support"
  }
}
```

</CodeSample>

<!-- > **`untag_chat_thread`** sample **request** with optional params

```json
{
	"request_id": "1245", // optional
	"action": "untag_chat_thread",
	"payload": {
		"chat_id": "PW94SJTGW6",
		"thread_id": "PWS6GIKAKH",
		"tag": "support"
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "untag_chat_thread",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

## Customers

<Section>
<Text>

### Get Customers

It returns the list of Customers.

#### Specifics

|                        |                                      |
| ---------------------- | ------------------------------------ |
| **Action**             | `get_customers`                      |
| **Required scopes**    | `customers:ro`                       |
| **Web API equivalent** | [`get_customers`](../#get-customers) |
| **Push message**       | -                                    |

#### Request

All parameters are optional.

| Parameter                                                                      | Data type | Notes                     |
| ------------------------------------------------------------------------------ | --------- | ------------------------- |
| `page_id`                                                                      | `string`  |                           |
| `limit`                                                                        | `number`  | Default: 10, maximum: 100 |
| `order` **\***                                                                 | `string`  | Default: `desc`           |
| `filters`                                                                      | `object`  |                           |
| `filters.country.<string_filter_type>` **\*\***                                | `object`  |                           |
| `filters.email.<string_filter_type>` **\*\***                                  | `object`  |                           |
| `filters.name.<string_filter_type>` **\*\***                                   | `object`  |                           |
| `filters.customer_id.<string_filter_type>` **\*\***                            | `object`  |                           |
| `filters.chats_count.<range_filter_type>` **\*\*\***                           | `object`  |                           |
| `filters.threads_count.<range_filter_type>` **\*\*\***                         | `object`  |                           |
| `filters.visits_count.<range_filter_type>` **\*\*\***                          | `object`  |                           |
| `filters.created_at.<date_range_filter_type>`**\*\*\*\***                      | `object`  |                           |
| `filters.agent_last_event_created_at.<date_range_filter_type>` **\*\*\*\***    | `object`  |                           |
| `filters.customer_last_event_created_at.<date_range_filter_type>` **\*\*\*\*** | `object`  |                           |

**\*)**

`order` can take the following values:

- `asc` - oldest customers first
- `desc` - newest customers first

**\*\*)**

`<string_filter_type>` can take the following values :

- `values` (`string[]` - an array of strings)
- `exclude_values` (`string[]` - an array of strings)

There's only one value allowed for a single filter.

**\*\*\*)**

`<range_filter_type>` can take the following values:

- `lte` (`int` - less than or equal to given value)
- `lt` (`int` - less than given value)
- `gte` (`int` - greater than or equal to given value)
- `gt` (`int` - greater than given value)
- `eq` (`int` - equal to given value)

**\*\*\*\*)**

`<date_range_filter_type>` can take the following values:

- `lte` ( `string` - less than or equal to given value)
- `lt` (`string` - less than given value)
- `gte` (`string` - greater than or equal to given value)
- `gt` (`string` - greater than given value)
- `eq` (`string` - equal to given value)

Dates are represented in ISO 8601 format with microseconds resolution, e.g. `2017-10-12T15:19:21.010200+01:00` in specific timezone or `2017-10-12T14:19:21.010200Z` in UTC.

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_customers",
  "payload": {}
}
```

</CodeSample>

<!-- > **`get_customers`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "get_customers",
	"payload": {
		"filters": {
		"country": {
			"values": ["United States", "Poland"]
		},
		"visits_count": {
			"gte": 20
		},
		"created_at": {
			"gte": "2017-10-12T15:19:21.010200+01:00"
		}
	},
	"page_id": "MTUxNzM5ODEzMTQ5Ng=="
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "get_customers",
  "type": "response",
  "success": true,
  "payload": {
    "customers": [
      // an array of "User > Customer" objects
    ],
    "total_customers": 2340,
    "next_page_id": "MTUxNzM5ODEzMTQ5Ng==", // optional
    "previous_page_id": "MTUxNzM5ODEzMTQ5Ng==" // optional
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Create Customer

Creates a new [Customer](#customer) user type.

#### Specifics

|                        |                                         |
| ---------------------- | --------------------------------------- |
| **Action**             | `create_customer`                       |
| **Required scopes**    | `customers:rw`                          |
| **Web API equivalent** | [`create_customer`](../#create-customer)  |
| **Push message**       | [`customer_created`](#customer_created) |

#### Request

| Parameter | Required | Data type | Notes                            |
| --------- | -------- | --------- | -------------------------------- |
| `name`    | No       | `string`  |                                  |
| `email`   | No       | `string`  |                                  |
| `avatar`  | No       | `string`  | URL of the Customer's avatar     |
| `fields`  | No       | `object`  | A map in `"key": "value"` format |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "create_customer",
  "payload": {}
}
```

</CodeSample>

<!-- > **`create_customer`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "create_customer",
	"payload": {
		"email": "customer1@example.com",
		"avatar": "https://domain.com/avatars/1.jpg",
		"fields": {
			"some_key": "some_value"
	},
	"author_id": "<author_id>" // optional, applies only to bots
	}
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "create_customer",
  "type": "response",
  "success": true,
  "payload": {
     "customer_id": "b7eff798-f8df-4364-8059-649c35c9ed0c"
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Update Customer

Updates Customer's properties.

#### Specifics

|                        |                                          |
| ---------------------- | ---------------------------------------- |
| **Action**             | `update_customer`                        |
| **Required scopes**    | `customers:rw`                           |
| **Web API equivalent** | [`update_customer`](../#update-customer) |
| **Push message**       | [`customer_updated`](#customer_updated)  |

#### Request

| Parameter     | Required | Data type | Notes                            |
| ------------- | -------- | --------- | -------------------------------- |
| `customer_id` | Yes      | `string`  | UUID v4 format is required.      |
| `name`        | No       | `string`  |                                  |
| `email`       | No       | `string`  |                                  |
| `avatar`      | No       | `string`  | URL of the Customer's avatar     |
| `fields`      | No       | `object`  | A map in `"key": "value"` format |

Apart from `customer_id`, which is a required parameter, you also need to include **one of the optional** parameters.

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "update_customer",
  "payload": {
    "customer_id": "646d53b8-ba76-48bf-7ef1-f6d61ec4ec44",
    "name": "John Doe"
  }
}
```

</CodeSample>

<!-- > **`update_customer`** sample **request** with optional params

```json
{
	"request_id": "13425", // optional
	"action": "update_customer",
	"payload": {
		"customer_id": "d4efab70-984f-40ee-aa09-c9cc3c4b0882",
		"name": "John Doe",
		"avatar": "https://domain.com/avatars/1.jpg",
		"fields": {
			"score": "low"
		}
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "update_customer",
  "type": "response",
  "success": true,
  "payload": {
    // "User > Customer" object
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Ban Customer

Bans the customer for a specific period of time. It immediately disconnects all active sessions of this customer and does not accept new ones during the ban lifespan.

#### Specifics

|                        |                                       |
| ---------------------- | ------------------------------------- |
| **Action**             | `ban_customer`                        |
| **Required scopes**    | `customers.ban:rw`                    |
| **Web API equivalent** | [`ban_customer`](../#ban-customer)    |
| **Push message**       | [`customer_banned`](#customer_banned) |

#### Request

| Parameter     | Required | Data type |     |
| ------------- | -------- | --------- | --- |
| `customer_id` | Yes      | `string`  |     |
| `ban`         | Yes      | `object`  |     |
| `ban.days`    | Yes      | `number`  |     |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "ban_customer",
  "payload": {
    "customer_id": "3cd19fff-f852-4402-59ce-ebd03af3f15a",
    "ban": {
      "days": 3
    }
  }
}
```

</CodeSample>

<!-- > **`ban_customer`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "ban_customer",
	"payload": {
		"customer_id": "3cd19fff-f852-4402-59ce-ebd03af3f15a",
        "ban": {
            "days": 3
        }
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "ban_customer",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

## Status

### Login

It returns the initial state of the current Agent.

#### Specifics

|                        |         |
| ---------------------- | ------- |
| **Action**             | `login` |
| **Required scopes**    | -       |
| **Web API equivalent** | -       |
| **Push message**       | -       |

#### Request

| Parameter                           | Required | Data type | Notes                                                                                                                            |
| ----------------------------------- | -------- | --------- | -------------------------------------------------------------------------------------------------------------------------------- |
| `token`                             | Yes      | `string`  | OAuth token from the Agent's account                                                                                             |
| `timezone`                          | No       | `string`  |                                                                                                                                  |
| `reconnect`                         | No       | `bool`    | Reconnecting sets the status to the last known state instead of the default one.                                                 |
| `push_notifications`                | No       | `object`  |                                                                                                                                  |
| `push_notifications.firebase_token` | No       | `string`  | Firebase device token to allow connecting this instance with the existing push notification instance (to be seen as 1 instance). |
| `push_notifications.platform`       | Yes      | `string`  | OS platform; possible values:`ios`, `android`. Required only when `push_notifications` is included.                              |
| `application`                       | No       | `object`  |                                                                                                                                  |
| `application.name`                  | No       | `string`  | Application name                                                                                                                 |
| `application.version`               | No       | `string`  | Application version                                                                                                              |

#### Response

| Parameter    | Req./Optional |     |     |
| ------------ | ------------- | --- | --- |
| `access`     | optional      |     |     |
| `properties` | optional      |     |     |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
	"action": "login",
	"payload": {
		"token": "Bearer dal:S2V0s1fgTbfXmgthj4cZSA"
		}
	}
}
```

</CodeSample>

<!-- > **`login`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "login",
	"payload": {
		"push_notifications": {
			"firebase_token": "JDa8813Ka92mmKda00dsdkAKDA0",
			"platform": "ios"
	},
	"application": {
		"name": "SmartClient - Chrome",
		"version": "4.1.2.1231 (57.0.2987.133)"
	}
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "login",
  "type": "response",
  "success": true,
  "payload": {
    "license": {
      "id": "104130623",
      "plan": "enterprise",
      "expiration_timestamp": 1483433500,
      "creation_timestamp": 1482433500,
      "in_trial": true,
      "website_last_activity": "2018-01-05" // optional
    },
    "my_profile": {
      // "User > My profile" object
    },
    "chats_summary": [
      {
        "id": "PJ0MRSHTDG",
        "users": [
          // array of "User" objects
        ],
        "last_event_per_type": {
          // the last event of each type in chat
          "message": {
            "thread_id": "K600PKZON8",
            "thread_order": 343544565,
            "event": {
              // "restricted_access": true
              // or
              // Event > Message object
            }
          },
          "system_message": {
            "thread_id": "K600PKZON8",
            "thread_order": 343544565,
            "event": {
              // "restricted_access": true
              // or
              // Event > System Message object
            }
          }
          // ...
        },
        "last_thread_summary": {
          "id": "K600PKZON8",
          "timestamp": 1473433500,
          "user_ids": ["agent1@example.com"],
          "order": 12417249812721,
          "properties": {
            "routing": {
              "idle": {
                "value": false
              },
              "unassigned": {
                "value": false
              }
            }
            // ...
          }
        },
        "properties": {
          "routing": {
            "idle": {
              "value": false
            },
            "unassigned": {
              "value": false
            }
          }
          // ...
        },
        "access": {
          // "Access" object
        }
      }
    ]
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Set Away Status

#### Specifics

|                        |                   |
| ---------------------- | ----------------- |
| **Action**             | `set_away_status` |
| **Required scopes**    | `agents--my:rw`   |
| **Web API equivalent** | -                 |
| **Push message**       | -                 |

#### Request

| Request object | Required | Type   |     |
| -------------- | -------- | ------ | --- |
| `away`         | Yes      | `bool` |     |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "set_away_status",
  "payload": {
    "away": true
  }
}
```

</CodeSample>

<!-- > **`set_away_status`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "set_away_status",
	"payload": {
		"away": true
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "set_away_status",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Change Push Notifications

Change the firebase push notifications properties.

#### Specifics

|                        |                             |
| ---------------------- | --------------------------- |
| **Action**             | `change_push_notifications` |
| **Required scopes**    | -                           |
| **Web API equivalent** | -                           |
| **Push message**       | -                           |

#### Request

| Parameter        | Required | Data type | Notes                                                        |
| ---------------- | -------- | --------- | ------------------------------------------------------------ |
| `firebase_token` | Yes      | string    | Firebase device token                                        |
| `platform`       | Yes      | string    | OS platform; possible values: `ios`, `android`               |
| `enabled`        | Yes      | bool      | Enable or disable push notifications for the requested token |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "change_push_notifications",
  "payload": {
    "firebase_token": "8daDAD9dada8ja1JADA11",
    "platform": "ios",
    "enabled": true
  }
}
```

</CodeSample>

<!-- > **`change_push_notifications`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "change_push_notifications",
	"payload": {
		"firebase_token": "8daDAD9dada8ja1JADA11",
		"platform": "ios",
		"enabled": true
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "change_push_notifications",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Update Agent

Updates Agent's properties.

#### Specifics

|                        |                                    |
| ---------------------- | ---------------------------------- |
| **Action**             | `update_agent`                     |
| **Required scopes**    | `agents--my:rw` `agents--all:rw`   |
| **Web API equivalent** | [`update_agent`](../#update-agent) |
| **Push message**       | [`agent_updated`](#agent_updated)  |

#### Request

| Parameter        | Required | Data type | Notes                                                     |
| ---------------- | -------- | --------- | --------------------------------------------------------- |
| `agent_id`       | No       | `string`  | The current Agent is used by default.                     |
| `routing_status` | No       | `string`  | Possible values: `accepting_chats`, `not_accepting_chats` |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "update_agent",
  "payload": {
    "agent_id": "uagent1@example.com",
    "routing_status": "accepting_chats"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "update_agent",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Logout

Logs the Agent out.

#### Specifics

|                        |          |
| ---------------------- | -------- |
| **Action**             | `logout` |
| **Required scopes**    | -        |
| **Web API equivalent** | -        |
| **Push message**       | -        |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "logout",
  "payload": {}
}
```

</CodeSample>

<!-- > **`logout`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "logout",
	"payload": {},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "logout",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

## Other

<Section>
<Text>

### Mark Events as Seen

#### Specifics

|                        |                                                               |
| ---------------------- | ------------------------------------------------------------- |
| **Action**             | `mark_events_as_seen`                                         |
| **Required scopes**    | `chats--access:ro` `chats--all:ro`                            |
| **Web API equivalent** | [`mark_events_as_seen`](../#mark-events-as-seen)              |
| **Push message**       | [`events_marked_as_seen`](#events_marked_as_seen) |

#### Request

| Parameter    | Required | Data type   | Notes |
| ------------ | -------- | ----------- | ----- |
| `chat_id`    | Yes      | `string`    |       |
| `seen_up_to` | Yes      | `string`    | RFC 3339 date-time format |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "mark_events_as_seen",
  "payload": {
    "chat_id": "PJ0MRSHTDG",
    "seen_up_to": "2017-10-12T15:19:21.010200Z"
  }
}
```

</CodeSample>

<!-- > **`mark_events_as_seen`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "mark_events_as_seen",
	"payload": {
		 "chat_id": "PJ0MRSHTDG",
		 "seen_up_to": "2017-10-12T15:19:21.010200Z"
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

</Code>
</Section>

<Section>
<Text>

### Send Typing Indicator

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Action**             | `send_typing_indicator`                                                                  |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **Web API equivalent** | [`send_typing_indicator`](../#send_typing_indicator)                                     |
| **Push message**       | -                                                                                        |

#### Request

| Parameter    | Required | Data type | Notes                                                    |
| ------------ | -------- | --------- | -------------------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to send the typing indicator to. |
| `recipients` | No       | `string`  | `all` (default), `agents`                                |
| `is_typing`  | Yes      | `bool`    |                                                          |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
  "action": "send_typing_indicator",
  "payload": {
    "chat_id": "PJ0MRSHTDG",
    "is_typing": true
  }
}
```

</CodeSample>

<!-- > **`send_typing_indicator`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "send_typing_indicator",
	"payload": {
		"chat_id": "PJ0MRSHTDG",
		"recipients": "all",
		"is_typing": true
		},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "send_typing_indicator",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Multicast

This method serves for the **chat-unrelated communication**. Messages sent using `multicast` are not being saved.

For example, it could be used in an app that sends notifications to Agents or Customers, when a certain condition is met (e.g. an important Customer started the chat).

#### Specifics

|                        |                                             |
| ---------------------- | ------------------------------------------- |
| **Action**             | `multicast`                                 |
| **Required scopes**    | `multicast:rw`                              |
| **Web API equivalent** | [`multicast`](../#multicast)                |
| **Push message**       | [`incoming_multicast`](#incoming_multicast) |

#### Request

| Parameter | Required | Data type | Notes                     |
| --------- | -------- | --------- | ------------------------- |
| `scopes`  | Yes      | `object`  | **\***                    |
| `content` | Yes      | `any`     | A JSON message to be sent |
| `type`    | No       | `string`  | Multicast message type    |

**\*)** `scopes` can take the following values:

- `agents`:

  - `all` (`bool` - includes all agents)
  - `ids` (`[]string` - an array of agents' IDs)
  - `groups` (`[]string` - an array of groups' IDs)

- `customers`:
  - `ids` (`[]string` - an array of customer's IDs)

At least one `scopes` type (`agents.all`, `agents.ids`, `agents.groups`, `customers.ids`) is required.

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```json
{
	"action": "multicast",
	"payload": {
		"scopes": {
            "agents": {
                "all": true,
                "ids": [
                    "agent1@example.com",
                    "agent2@example.com"
                ],
                "groups": [
                    1,
                    2
                ]
            },
            "customers": {
                "ids": [
                    "b7eff798-f8df-4364-8059-649c35c9ed0c"
                ]
            }
        },
        "content": {
            "example": {
                "nested": "json"
				}
			}
		}
	}
}
```

</CodeSample>

<!-- > **`multicast`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "multicast",
	"payload": {
		"scopes": {
            "agents": {
                "all": true,
                "ids": [
                    "agent1@example.com",
                    "agent2@example.com"
                ],
                "groups": [
                    1,
                    2
                ]
            },
            "customers": {
                "ids": [
                    "b7eff798-f8df-4364-8059-649c35c9ed0c"
                ]
            }
        },
        "content": {
            "example": {
                "nested": "json"
				}
			}
		},
		"type": "type1"
	},
	"author_id": "<author_id>" // optional, applies only to bots
}
``` -->

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "multicast",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>
</Code>
</Section>

<Section>

<Text>

# Pushes

Here's what you need to know about **pushes**: 

- They are generated primarily by RTM API actions, but also by Web API actions.
- They notify you when specific events occur. 
- Can be **delivered** only in the websocket transport. 
- You don't need to register pushes to receive them. 
- Their equivalents in Web API are [webhooks](/management/configuration-api/#webhooks). 
- Pushes and webhooks have similar payloads.

|                 |                                                                                                                                                                                                                                                                                                                                                                     |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Chats**       | [`incoming_chat_thread`](#incoming_chat_thread) [`thread_closed`](#thread_closed)                                                                                                                                                                                                                                                                                   |
| **Chat access** | [`access_granted`](#access_granted) [`access_revoked`](#access_revoked) [`access_set`](#access_set) [`chat_transferred`](#chat_transferred-1)                                                                                                                                                                                                                         |
| **Chat users**  | [`chat_user_added`](#chat_user_added) [`chat_user_removed`](#chat_user_removed)                                                                                                                                                                                                                                                                                     |
| **Events**      | [`incoming_event`](#incoming_event) [`event_updated`](#event_updated)[`incoming_rich_message_postback`](#incoming_rich_message_postback)                                                                                                                                                                                                                            |
| **Properties**  | [`chat_properties_updated`](#chat_properties_updated) [`chat_properties_deleted`](#chat_properties_deleted) [`chat_thread_properties_updated`](#chat_thread_properties_updated) [`chat_thread_properties_deleted`](#chat_thread_properties_deleted) [`event_properties_updated`](#event_properties_updated) [`event_properties_deleted`](#event_properties_deleted) |
| **Thread tags** | [`chat_thread_tagged`](#chat_thread_tagged) [`chat_thread_untagged`](#chat_thread_untagged)                                                                                                                                                                                                                                                                         |
| **Customers**   | [`customer_visit_started`](#customer_visit_started) [`customer_created`](#customer_created) [`customer_updated`](#customer_updated) [`customer_page_updated`](#customer_page_updated) [`customer_banned`](#customer_banned) [`customer_visit_ended`](#customer_visit_ended)                                                                                         |
| **Status**      | [`agent_updated`](#agent_updated) [`agent_disconnected`](#agent_disconnected)                                                                                                                                                                                                                                                                                       |
| **Other**       | [`events_marked_as_seen`](#events_marked_as_seen) [`incoming_sneak_peek`](#incoming_sneak_peek) [`incoming_typing_indicator`](#incoming_typing_indicator) [`incoming_multicast`](#incoming_multicast)                                                                                                                                                   |

</Text>

<Code>

<CodeResponse title={'general push format'}>

```json
{
  "request_id": "<request_id>", // optional, applies only to the requester
  "action": "<action>",
  "type": "push",
  "payload": {
    // optional payload
  }
}
```

</CodeResponse>

</Code>

</Section>

## Chats

### `incoming_chat_thread`
Informs about a new thread coming in the chat. The push payload contains not only the new thread, but the whole chat data structure. If the chat was started with some initial events, the thread object contains them.  

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat": {
    "id": "PJ0MRSHTDG",
    "users": [
      // array of "User" objects
    ],
    "properties": {
      "source": {
        "type": "facebook"
      }
      // ...
    },
    "thread": {
      // "Thread" object
    }
  }
}
```

</CodeResponse>

#### Specifics

|                        |                                                                       |
| ---------------------- | --------------------------------------------------------------------- |
| **Action**             | `incoming_chat_thread`                                                |
| **Webhook equivalent** | [`incoming_chat_thread`](/management/configuration-api/#incoming_chat_thread) |

### `thread_closed`
Informs that a thread was closed. 

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "K600PKZON8",
  "user_id": "b7eff798-f8df-4364-8059-649c35c9ed0c" // optional
}
```

</CodeResponse>

#### Specifics

|                        |                                                         |
| ---------------------- | ------------------------------------------------------- |
| **Action**             | `thread_closed`                                         |
| **Webhook equivalent** | [`thread_closed`](/management/configuration-api/#thread_closed) |

#### Push payload

| Object    | Notes                                         |
| --------- | --------------------------------------------- |
| `user_id` | Missing if a thread was closed by the router. |

## Chat access

### `access_granted`
Informs that new, single access to a resource was granted. The existing access isn't overwritten. 

<CodeResponse title={'Sample push payload'}>

```json
{
  "resource": "chat",
  "id": "PJ0MRSHTDG",
  "access": {
    "group_ids": [1]
  }
}
```

</CodeResponse>

#### Specifics

|                        |                                                           |
| ---------------------- | --------------------------------------------------------- |
| **Action**             | `access_granted`                                          |
| **Webhook equivalent** | [`access_granted`](/management/configuration-api/#access_granted) |

#### Push payload

| Object     | Notes         |
| ---------- | ------------- |
| `resource` | Resource type |
| `id`       | Resource id   |

### `access_revoked`
Informs that access to a certain resource was revoked.

<CodeResponse title={'Sample push payload'}>

```json
{
  "resource": "chat",
  "id": "PJ0MRSHTDG",
  "access": {
    "group_ids": [1]
  }
}
```

</CodeResponse>

#### Specifics

|                        |                                                           |
| ---------------------- | --------------------------------------------------------- |
| **Action**             | `access_revoked`                                          |
| **Webhook equivalent** | [`access_revoked`](/management/configuration-api/#access_revoked) |

#### Push payload

| Object     | Notes         |
| ---------- | ------------- |
| `resource` | Resource type |
| `id`       | Resource Id   |

### `access_set`
Informs that new, single access to a resource was set. The existing access is overwritten.

<CodeResponse title={'Sample push payload'}>

```json
{
  "resource": "chat",
  "id": "PJ0MRSHTDG",
  "access": {
    "group_ids": [1]
  }
}
```

</CodeResponse>

#### Specifics

|                        |                                                   |
| ---------------------- | ------------------------------------------------- |
| **Action**             | `access_set`                                      |
| **Webhook equivalent** | [`access_set`](/management/configuration-api/#access_set) |

#### Push payload

| Object     | Notes         |
| ---------- | ------------- |
| `resource` | Resource type |
| `id`       | Resource Id   |

### `chat_transferred`
Informs that a chat was transferred to a different group or to an Agent.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "requester_id": "cb531744-e6a4-4ded-b3eb-b3eb4ded4ded",
  "type": "agent",
  "ids": ["agent1@example.com"]
}
```

</CodeResponse>

#### Specifics

|                        |                    |
| ---------------------- | ------------------ |
| **Action**             | `chat_transferred` |
| **Webhook equivalent** | -                  |

#### Push payload

| Object | Notes                        |
| ------ | ---------------------------- |
| `type` | `agent` or `group`           |
| `ids`  | `group` or `agent` IDs array |

## Chat users

### `chat_user_added`
Informs that a user (Customer or Agent) was added to a chat.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "K600PKZON8",
  "user": {
    // "User > Customer" or "User > Agent" object
  },
  "user_type": "agent"
}
```

</CodeResponse>

#### Specifics

|                        |                                                             |
| ---------------------- | ----------------------------------------------------------- |
| **Action**             | `chat_user_added`                                           |
| **Webhook equivalent** | [`chat_user_added`](/management/configuration-api/#chat_user_added) |

#### Push payload

| Object      | Notes                                |
| ----------- | ------------------------------------ |
| `user_type` | Possible values: `agent`, `customer` |

### `chat_user_removed`
Informs that a user (Customer or Agent) was removed from a chat.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "K600PKZON8",
  "user_id": "agent1@example.com",
  "user_type": "agent"
}
```

</CodeResponse>

#### Specifics

|                        |                                                                 |
| ---------------------- | --------------------------------------------------------------- |
| **Action**             | `chat_user_removed`                                             |
| **Webhook equivalent** | [`chat_user_removed`](/management/configuration-api/#chat_user_removed) |

#### Push payload

| Object      | Notes                                |
| ----------- | ------------------------------------ |
| `user_type` | Possible values: `agent`, `customer` |

## Events

### `incoming_event`
Informs about an incoming [event](#events) sent to a chat.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "K600PKZON8",
  "event": {
      "id": "Q20163UAHO_2",
      "created_at": "2019-12-05T07:27:08.820000Z",
      "recipients": "all",
      "type": "message",
      "properties": {
          "0805e283233042b37f460ed8fbf22160": {
              "string_property": {
                "value": "string value"
              }
          }
      },
      "text": "Hello",
      "author_id": "author@example.com"
  }
}
```

</CodeResponse>

#### Specifics

|                        |                                                           |
| ---------------------- | --------------------------------------------------------- |
| **Action**             | `incoming_event`                                          |
| **Webhook equivalent** | [`incoming_event`](/management/configuration-api/#incoming_event) |

### `event_updated`
Informs that an [event](#events) was updated.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "123-123-123-123",
  "thread_id": "E2WDHA8A",
  "event": {
    // "Event" object
  }
}
```

</CodeResponse>

#### Specifics

|                        |                                                         |
| ---------------------- | ------------------------------------------------------- |
| **Action**             | `event_updated`                                         |
| **Webhook equivalent** | [`event_updated`](/management/configuration-api/#event_updated) |

### `incoming_rich_message_postback`
Informs about an incoming [rich message](#rich-message) postback. The push payload contains the info on the postback itself, as well as the chat it was sent in.

<CodeResponse title={'Sample push payload'}>

```json
{
  "user_id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "K600PKZON8",
  "event_id": "a0c22fdd-fb71-40b5-bfc6-a8a0bc3117f7",
  "postback": {
    "id": "action_yes",
    "toggled": true
  }
}
```

</CodeResponse>

#### Specifics

|                        |                                                                                           |
| ---------------------- | ----------------------------------------------------------------------------------------- |
| **Action**             | `incoming_rich_message_postback`                                                          |
| **Webhook equivalent** | [`incoming_rich_message_postback`](/management/configuration-api/#incoming_rich_message_postback) |

## Properties

### `chat_properties_updated`
Informs about those chat properties that were updated.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "properties": {
    "rating": {
      "score": {
        "value": 1
      },
      "comment": {
        "value": "Very good, veeeery good"
      }
    }
    // ...
  }
}
```

</CodeResponse>

#### Specifics

|                        |                                                                             |
| ---------------------- | --------------------------------------------------------------------------- |
| **Action**             | `chat_properties_updated`                                                   |
| **Webhook equivalent** | [`chat_properties_updated`](/management/configuration-api/#chat_properties_updated) |

#### Push payload

| Object       | Notes                                                                                                        |
| ------------ | ------------------------------------------------------------------------------------------------------------ |
| `properties` | This is not a full `properties` object. This push shows only the properties that have been recently updated. |

### `chat_properties_deleted`
Informs about those chat properties that were deleted.

<CodeResponse title={'Sample push payload'}>

```json
{
	"chat_id": "PJ0MRSHTDG",
	"properties": {
		"rating": ["score", "comment"]
		},
		// ...
	}
}
```

</CodeResponse>

#### Specifics

|                        |                                                                             |
| ---------------------- | --------------------------------------------------------------------------- |
| **Action**             | `chat_properties_deleted`                                                   |
| **Webhook equivalent** | [`chat_properties_deleted`](/management/configuration-api/#chat_properties_deleted) |

#### Push payload

| Object       | Notes                                                                                                        |
| ------------ | ------------------------------------------------------------------------------------------------------------ |
| `properties` | This is not a full `properties` object. This push shows only the properties that have been recently updated. |

### `chat_thread_properties_updated`
Informs about those chat thread properties that were updated.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "K600PKZON8",
  "properties": {
    "rating": {
      "value": {
        "value": 1
      },
      "comment": {
        "value": "Very good, veeeery good"
      }
    }
    // ...
  }
}
```

</CodeResponse>

#### Specifics

|                        |                                                                                           |
| ---------------------- | ----------------------------------------------------------------------------------------- |
| **Action**             | `chat_thread_properties_updated`                                                          |
| **Webhook equivalent** | [`chat_thread_properties_updated`](/management/configuration-api/#chat_thread_properties_updated) |

#### Push payload

| Object       | Notes                                                                                                        |
| ------------ | ------------------------------------------------------------------------------------------------------------ |
| `properties` | This is not a full `properties` object. This push shows only the properties that have been recently updated. |

### `chat_thread_properties_deleted`
Informs about those chat thread properties that were deleted.

<CodeResponse title={'Sample push payload'}>

```json
{
	"chat_id": "PJ0MRSHTDG",
	"thread_id": "K600PKZON8",
	"properties": {
		"rating": ["score", "comment"]
		},
		// ...
	}
}
```

</CodeResponse>

#### Specifics

|                        |                                                                                           |
| ---------------------- | ----------------------------------------------------------------------------------------- |
| **Action**             | `chat_thread_properties_deleted`                                                          |
| **Webhook equivalent** | [`chat_thread_properties_deleted`](/management/configuration-api/#chat_thread_properties_deleted) |

#### Push payload

| Object       | Notes                                                                                                        |
| ------------ | ------------------------------------------------------------------------------------------------------------ |
| `properties` | This is not a full `properties` object. This push shows only the properties that have been recently updated. |

### `event_properties_updated`
Informs about those event properties that were updated.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "K600PKZON8",
  "event_id": "2_E2WDHA8A",
  "properties": {
    "rating": {
      "comment": {
        "value": "goooood"
      }
    }
  }
}
```

</CodeResponse>

#### Specifics

|                        |                                                                               |
| ---------------------- | ----------------------------------------------------------------------------- |
| **Action**             | `event_properties_updated`                                                    |
| **Webhook equivalent** | [`event_properties_updated`](/management/configuration-api/#event_properties_updated) |

#### Push payload

| Object       | Notes                                                                                                        |
| ------------ | ------------------------------------------------------------------------------------------------------------ |
| `properties` | This is not a full `properties` object. This push shows only the properties that have been recently updated. |

### `event_properties_deleted`
Informs about those event properties that were deleted.

<CodeResponse title={'Sample push payload'}>

```json
{
	"chat_id": "PJ0MRSHTDG",
	"thread_id": "K600PKZON8",
	"event_id": "2_E2WDHA8A",
	"properties": {
		"rating": ["score", "comment"]
		},
		// ...
	}
}
```

</CodeResponse>

#### Specifics

|                        |                                                                               |
| ---------------------- | ----------------------------------------------------------------------------- |
| **Action**             | `event_properties_deleted`                                                    |
| **Webhook equivalent** | [`event_properties_deleted`](/management/configuration-api/#event_properties_deleted) |

#### Push payload

| Object       | Notes                                                                                                        |
| ------------ | ------------------------------------------------------------------------------------------------------------ |
| `properties` | This is not a full `properties` object. This push shows only the properties that have been recently updated. |

## Thread tags

### `chat_thread_tagged`
Informs that a chat thread was tagged.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "K600PKZON8",
  "tag": "bug_report"
}
```

</CodeResponse>

#### Specifics

|                        |                                                                   |
| ---------------------- | ----------------------------------------------------------------- |
| **Action**             | `chat_thread_tagged`                                              |
| **Webhook equivalent** | [`chat_thread_tagged`](/management/configuration-api/#chat_thread_tagged) |

### `chat_thread_untagged`
Informs that a chat thread was untagged.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "K600PKZON8",
  "tag": "bug_report"
}
```

</CodeResponse>

#### Specifics

|                        |                                                                       |
| ---------------------- | --------------------------------------------------------------------- |
| **Action**             | `chat_thread_untagged`                                                |
| **Webhook equivalent** | [`chat_thread_untagged`](/management/configuration-api/#chat_thread_untagged) |

## Customers

### `customer_visit_started`
Informs that a Customer entered the tracked website.

<CodeResponse title={'Sample push payload'}>

```json
{
  "customer_id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
  "visit_id": 42,
  "started_at": "2017-10-12T15:19:21.010200Z",
  "ip": "194.181.146.130",
  "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36",
  "geolocation": {
    "latitude": "51.0805",
    "longitude": "17.0211",
    "country": "Poland",
    "country_code": "PL",
    "region": "Dolnoslaskie",
    "city": "Wroclaw",
    "timezone": "Europe/Warsaw"
  }
}
```

</CodeResponse>

#### Specifics

|                        |                          |
| ---------------------- | ------------------------ |
| **Action**             | `customer_visit_started` |
| **Webhook equivalent** | -                        |

### `customer_created`
Informs that a new Customer registered.

<CodeResponse title={'Sample push payload'}>

```json
{
  "customer": {
    // "User > Customer" object
    "id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
    "created_at": "2019-11-14T14:27:24.410018Z",
    "email": "customer1@example.com",
    "avatar": "https://domain.com/avatars/1.jpg",
    "fields": {
        "some_key": "some_value"
    }
  }
}
```

</CodeResponse>

#### Specifics

|                        |                                                               |
| ---------------------- | ------------------------------------------------------------- |
| **Action**             | `customer_created`                                            |
| **Webhook equivalent** | [`customer_created`](/management/configuration-api/#customer_created) |

### `customer_updated`
Informs that Customer's data was updated.

<CodeResponse title={'Sample push payload'}>

```json
{
  "id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
  "name": "John Doe",
  "email": "john@doe.me",
  "avatar": "https://domain.com/avatars/1.jpg",
  "type": "customer",
  "present": false,
  "banned": false,
  "fields": {
    "custom field name": "custom field value"
  }
}
```

</CodeResponse>

#### Specifics

|                        |                    |
| ---------------------- | ------------------ |
| **Action**             | `customer_updated` |
| **Webhook equivalent** | -                  |

### `customer_page_updated`
Informs that a Customer changed the website - moved to another page of the website, for example by clicking a link.

<CodeResponse title={'Sample push payload'}>

```json
{
  "customer_id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
  "visit_id": 42,
  "opened_at": "2017-10-12T15:19:21.010200Z",
  "url": "https://www.livechatinc.com/",
  "title": "LiveChat - Homepage",
  "referrer": "http://www.google.com/"
}
```

</CodeResponse>

#### Specifics

|                        |                         |
| ---------------------- | ----------------------- |
| **Action**             | `customer_page_updated` |
| **Webhook equivalent** | -                       |

### `customer_banned`
Informs that a Customer was banned for a specified number of days.

<CodeResponse title={'Sample push payload'}>

```json
{
  "customer_id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
  "ban": {
    "days": 5
  }
}
```

</CodeResponse>

#### Specifics

|                        |                   |
| ---------------------- | ----------------- |
| **Action**             | `customer_banned` |
| **Webhook equivalent** | -                 |

### `customer_visit_ended`
Informs that a Customer left the tracked website.

<CodeResponse title={'Sample push payload'}>

```json
{
  "customer_id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
  "visit_id": 42,
  "ended_at": "2017-10-12T15:19:21.010200Z"
}
```

</CodeResponse>

#### Specifics

|                        |                        |
| ---------------------- | ---------------------- |
| **Action**             | `customer_visit_ended` |
| **Webhook equivalent** | -                      |

## Status

### `agent_updated`
Informs that an Agent's status was updated.

<CodeResponse title={'Sample push payload'}>

```json
{
  "agent_id": "agent1@example.com",
  "routing_status": "accepting_chats"
}
```

</CodeResponse>

#### Specifics

|                        |                 |
| ---------------------- | --------------- |
| **Action**             | `agent_updated` |
| **Webhook equivalent** | -               |

### `agent_disconnected`
Informs that an Agent was disconnected. The payload contains the reason of Customer's disconnection.

<CodeResponse title={'Sample push payload'}>

```json
{
  "reason": "misdirected_request",
  "data": {
    // optional
    "region": "fra"
  }
}
```

</CodeResponse>

#### Specifics

|                        |                      |
| ---------------------- | -------------------- |
| **Action**             | `agent_disconnected` |
| **Webhook equivalent** | -                    |

#### Possible reasons

| Type                           | Notes                                                  |
| ------------------------------ | ------------------------------------------------------ |
| `access_token_revoked`         | Agent access token has been revoked.                   |
| `access_token_expired`         | Access token life time has elapsed.                    |
| `license_expired`              | License has expired.                                   |
| `agent_deleted`                | Agent account has been deleted.                        |
| `agent_logged_out_remotely`    | Agent has been logged out remotely.                    |
| `agent_disconnected_by_server` | Agent has been disconnected by the server.             |
| `unsupported_version`          | Connecting to an unsupported version of the Agent API. |
| `ping_timeout`                 | Not receiving ping for some time from the Customer.    |
| `internal_error`               | Internal error                                         |
| `too_many_connections`         | Agent reached the max. number of connections.          |
| `misdirected_request` **\***   | Agent connected to the server in the wrong region.     |
| `product_version_changed`      | Product version has been changed.                      |
| `license_not_found`            | License with the specified ID doesn't exist.           |

**\*)**
Also, `misdirected_request` returns the correct `region` value in the optional `data` object.
With this piece of information, the client is able to figure out where it should be connected.

## Other

### `incoming_typing_indicator`
Informs that one of the chat users is currently typing a message. The message hasn't been sent yet. The push payload contains the typing indicator object.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "K600PKZON8",
  "typing_indicator": {   
    "author_id": "d17cd570-11a9-45c0-45c0-1b020b7586dc",
    "recipients": "all",
    "timestamp": 1574245378,
    "is_typing": true
  }
}
```

</CodeResponse>

#### Specifics

|                        |                             |
| ---------------------- | --------------------------- |
| **Action**             | `incoming_typing_indicator` |
| **Webhook equivalent** | -                           |

### `incoming_sneak_peek`
Informs about the message a Customer is currently typing. The push payload contains the sneak peek object.

<CodeResponse title={'Sample push payload'}>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "K600PKZON8",
  "sneak_peek": {   
    author_id: "d17cd570-11a9-45c0-45c0-1b020b7586dc",
    recipients: "all",
    text: "Hello",
    timestamp: 1574245378
  }
}
```

</CodeResponse>

#### Specifics

|                        |                       |
| ---------------------- | --------------------- |
| **Action**             | `incoming_sneak_peek` |
| **Webhook equivalent** | -                     |

### `events_marked_as_seen`
Informs that a user has seen events up to a specific time.

<CodeResponse title={'Sample push payload'}>

```json
{
  "user_id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
  "chat_id": "PJ0MRSHTDG",
  "seen_up_to": "2017-10-12T15:19:21.010200Z"
}
```

</CodeResponse>

#### Specifics

|                        |                                                                                     |
| ---------------------- | ----------------------------------------------------------------------------------- |
| **Action**             | `events_marked_as_seen`                                                       |
| **Webhook equivalent** | [`events_marked_as_seen`](/management/configuration-api/#events_marked_as_seen) |

### `incoming_multicast`
Informs about messages sent via the `multicast` method or by the system. 

<CodeResponse title={'Sample push payload'}>

```json
{
  "author_id": "agent1@example.com",
  "content": {
    "example": {
      "nested": "json"
    }
  },
  "type": "type1"
}
```

</CodeResponse>

#### Specifics

|                        |                      |
| ---------------------- | -------------------- |
| **Action**             | `incoming_multicast` |
| **Webhook equivalent** | -                    |

#### Push payload

| Object      | Required | Notes |
| ----------- | -------- | ----- |
| `author_id` | No       | Present only if the push was generated by the **Multicast** method and not sent from the server. |
| `content`   | Yes      |       |
| `type`      | No       |       |


# Errors

<CodeResponse title={'General error format'}>

```json
{
  "error": {
    "type": "misdirected_request",
    "message": "Wrong region",
    "data": {
      // optional
      "region": "dal"
    }
  }
}
```

</CodeResponse>

#### Possible errors

| Type                             | Default Message               | Notes                                                              |
| -------------------------------- | ----------------------------- | ------------------------------------------------------------------ |
| `authentication`                 | Authentication error          | An invalid or expired access token.                                |
| `authorization`                  | Authorization error           | User is not allowed to perform the action.                         |
| `internal`                       | Internal server error         |                                                                    |
| `license_expired`                | License expired               | The end of license trial or subcription.                            |
| `pending_requests_limit_reached` | Requests limit reached        | The limit of pending requests within one websocket connection has been reached. The limit is 10.|
| `requester_already_offline`      | Requester offline             | The method is only allowed for the logged in Agents (via RTM API). |
| `requester_awaiting_approval`    | Requester&nbsp;awaiting&nbsp;approval   | A new Agent hasn't been approved by the license owner yet.     |
| `request_timeout`                | Request timed out             | Timeout threshold is 15 seconds.                                    |
| `requester_suspended`            | Requester suspended           | The rights of a given Agent have been withdrawn by the license owner.|
| `validation`                     | Wrong format of request       |                                                                    |
| `wrong_product_version`          | Wrong product version         | License is not LiveChat 3 (probably still LiveChat 2).             |
| `seats_limit_exceeded`           | Seats limit exceeded          | Displayed on the attempt of logging in. All seats within a given license are already taken.|


# Contact us

If you found a bug or a typo, you can let us know directly on GitHub.
In case of any questions or feedback, don't hesitate to contact us at [developers@livechatinc.com](mailto:developers@livechatinc.com). We'll be happy to hear from you!

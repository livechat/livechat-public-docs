---
weight: 50
category: "authorization"
subcategory: "sign-in-with-livechat"
title: "Sign in with LiveChat"
tagline: "Access the LiveChat data with a simple JavaScript SDK."
desc: 'Some apps you build may need to access data from the LiveChat users accounts. Learn how to achieve that by installing the "Sign in with LiveChat" button.'
---

# Introduction

## User flow

Th **Sign in with LiveChat** flow is the easiest way to get access to basic information in LiveChat accounts. It allows you to quickly build an app that can access that info.

Users start the flow by clicking the **Sign in with LiveChat** button:

<!-- <div style="max-width: 250px">
  <img src="./images/sign-in-with-lc-btn.png" alt="Sign in with LiveChat Button" />
</div> -->

<button class="lc-btn" type="button" style="margin-right:auto; display:block; margin-bottom: 20px;">
  Sign in with LiveChat
</button>

If a user is not signed in to LiveChat, they'll be asked to do that:

<div style="max-width: 550px">
  <img src="./images/log-in-livechat.png" alt="Log in to LiveChat view" />
</div>

Then, the user must give the app access to the specified parts of their LiveChat account:

<div style="max-width: 550px">
  <img src="./images/grant-access-livechat.png" alt="Grant access to LiveChat app" />
</div>

Finally, the app receives an `access_token` that allows it perform LiveChat API calls, limited to what the user agreed to in the prompt.

For example, you can display the LiveChat tracking code which already includes the user's account license number:

<CodeSample path={'TRACKING CODE'}>

```js
<!-- Start of LiveChat (www.livechat.com) code -->
<script>
    window.__lc = window.__lc || {};
    window.__lc.license = 11069052;
    ;(function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},once:function(){i(["once",c.call(arguments)])},off:function(){i(["off",c.call(arguments)])},get:function(){if(!e._h)throw new Error("[LiveChatWidget] You can't use getters before load.");return i(["get",c.call(arguments)])},call:function(){i(["call",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.livechatinc.com/tracking.js",t.head.appendChild(n)}};!n.__lc.asyncInit&&e.init(),n.LiveChatWidget=n.LiveChatWidget||e}(window,document,[].slice))
</script>
<noscript><a href="https://www.livechatinc.com/chat-with/11069052/" rel="nofollow">Chat with us</a>, powered by <a href="https://www.livechatinc.com/?welcome" rel="noopener nofollow" target="_blank">LiveChat</a></noscript>
<!-- End of LiveChat code -->
```

</CodeSample>

## Use cases

With the **Sign in with LiveChat** flow, you can easily build an app that:

- Gets access to the LiveChat user's email, account ID, or organization ID.
- Receives an `access_token` that can be used to perform different LiveChat API calls.
- Receives a `code` using the PKCE extension, which could be used to obtain the account's `refresh_token` and `access_token`.

# Setup

## Step 1: Create a new app

Create a new **LiveChat OAuth 2.1 Client** app in <a href="https://developers.livechat.com/console/" rel="noopener nofollow" target="_blank">Developer Console</a>. You will receive a new `client_id` that can be used in the next steps.

Please note that **Redirect URI** field must match the URL of the website that has the **Sign in with LiveChat** button installed. The button will not work with any other URL addresses.

## Step 2: Include the SDK library

The SDK is available in two formats: an NPM module and a CDN-hosted library.

### NPM module

```bash
npm install --save @livechat/accounts-sdk@^2.0.0
```

```js
import AccountsSDK from '@livechat/accounts-sdk';
```

If you build an app using Webpack, you can just import the `AccountsSDK` module from NPM.

### CDN-hosted library

```html
<script src="//cdn.livechatinc.com/accounts/accounts-sdk.min.js"></script>
```

If you do not use Webpack, you can still include the library using the `<script>` tag in your HTML. This will create an `AccountsSDK` global object.

## Step 3: Prepare button container

Prepare the login button, which will invoke the authorization flow when a user clicks it.

```html
<div id="login-button" style="background: url(.../livechat_sign_in.png)"></div>
```

<CodeSample path={'Prepare the button container'}>

```js
// javascript
const instance = new AccountsSDK({
  client_id: '<your_app_client_id>',
  redirect_uri: '<your_app_redirect_uri>'
});

document.getElementById('login-button').onclick = (e) => {
  if (e && e.preventDefault) {
    e.preventDefault();
  }

  sdk.popup().authorize().then((authorizeData)=>{
    const transaction = sdk.verify(authorizeData);
    if (transaction != null) {
      // authorization success
      // authorizeData contains `accessToken` or `code`
      // transaction contains state and optional code_verifier (code + PKCE)
      console.log("User access token: " + transaction.accessToken)
      document.getElementById('login-button').style.display = "none"
    } else {
      console.log("Redirect state don't matches previous one")
    }
  }).catch((e)=>{
    console.error("Failed to authorize user", e)
  })
};
```

</CodeSample>

During the creation of the Sign in LiveChat button, you can use [LiveChat Designs](https://livechat.design/).

<Warning>

[**Don't forget to test the give consent step**](/monetization/app-review-process/#common-problems). Use `prompt: "consent"` to force the app to **ask you for access** to certain resources. It’s necessary for you to test the app as if you were a user who installs the app from Marketplace.

</Warning>

# SDK documentation

## Classes

### **AccountsSDK**

The main instance of the SDK used to authorize users in LiveChat Accounts.

#### **constructor(options = {})**

<CodeSample path={'Example class creation'}>

```js
const instance = new AccountsSDK({
  client_id: '<your_app_client_id>'
});
```

</CodeSample>

##### options object

The constructor accepts an `options` object with the following properties:

| Property                             | Required | Description                                                                                                                                                                                                     |
|--------------------------------------|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `client_id`                          | yes      | Application **Client Id** (can be found in <a href="https://developers.livechat.com/console/" rel="noopener nofollow" target="_blank">Developer Console</a>)                                                    |
| `prompt`                             | no       | Use `consent` to force the consent prompt in a popup and the redirect flows. ([See the warning.](#step-3-prepare-button-container)). Default: `''`                                                              |
| `response_type`                      | no       | OAuth response type. Possible values: `token` or `code`. Default: `token`                                                                                                                                       |
| `popup_flow`                         | no       | `auto` - close the popup automatically when user is already logged in; `manual` - always show the popup which requires user to provide his credentials; default: `auto`                                         |
| `state`                              | no       | OAuth state parameter. Use it for better security.                                                                                                                                                              |
| `verify_state`                       | no       | Check if `state` matches after the redirect; default: `true`                                                                                                                                                    |
| `scope`                              | no       | The scopes your application will request from the user. If not provided, then all application scopes will be requested. - must be configured for a given `client id`, a comma-separated string, default: `null` |
| `redirect_uri`                       | yes      | OAuth redirect URI; default: the current location                                                                                                                                                               |
| `email_hint`                         | no       | Fill in email in forms                                                                                                                                                                                          |
| `server_url`                         | no       | Authorization server URL                                                                                                                                                                                        |
| `tracking`                           | no       | Tracking query string parameters                                                                                                                                                                                |
| [`transaction`](#transaction-object) | no       | An object with options for the transaction manager                                                                                                                                                              |
| [`pkce`](#pkce-object)               | no       | An object with the PKCE configuration                                                                                                                                                                           |

##### transaction object

The `transaction` object consists of the following parameters:

| Property              | Required | Description                                                  |
| --------------------- | -------- | ------------------------------------------------------------ |
| `namespace`           | no       | Transaction key prefix; default: `'com.livechat.accounts'`   |
| `key_length`          | no       | Transaction random state length; default: `32`               |
| `force_local_storage` | no       | Try to use localStorage instead of cookies; default: `false` |

##### pkce object

You need to use the PKCE extension if your JavaScript application will try to acquire the authorization `code` in order to exchange it for tokens.

In the `pkce` object, define the following configuration properties:

| Property                | Required | Description                                                                                                                                                                                                               |
| ----------------------- | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `enabled`               | yes      | Enable OAuth 2.1 PKCE extension; default: `true`                                                                                                                                                                          |
| `code_verifier`         | no       | Override the auto-generated code verifier.                                                                                                                                                                                |
| `code_verifier_length`  | no       | Define the length of the code verifier. It should be between 43 and 128 characters; default: `128`. <a href=" https://tools.ietf.org/html/rfc7636#section-4.1" target="_blank" rel="noopener noreferrer">Read more...</a> |
| `code_challange_method` | no       | Define the code challenge method. Possible values: `S256` or `plain`; default: `S256`                                                                                                                                     |

#### **instance.popup(options = {})**  

Returns a `Popup` object instance built on top of `sdk`.

```js
  const popup = instance.popup();
```

#### **instance.redirect(options = {})**  

Returns a `Redirect` object instance built on top of `sdk`.

```js
  const redirect = instance.redirect();
```

#### **instance.authorizeURL(options = {}, flow = '')**

Creates an authorization URL for the given flow and parameters.

```js
  const authURL = instance.authorizeURL();
```

#### **instance.verify(authorizeData)**

This function verifies if the redirect transaction parameters are valid. It they are, it returns `Transaction`. Otherwise, it returns `null`.

In all methods of the `AccountsSDK` object, the `options` objects is used to overwrite the data provided upon initialization.

<CodeSample path={'instance.verify(authorizeData)'}>

```js
  const transactionData = instance.verify(authorizeData);
  if (transactionData) {
    console.log("Verified correctly");
  } else {
    console.log("Url/state mismatch");
  }
```

</CodeSample>

### **Popup**

A class responsible for acquiring the user authorization data through a popup window.

#### **constructor(sdk, options)**

The constructor accepts an `sdk` instance and `options` object with the same parameters as `AccountsSDK`.

<CodeSample path={'constructor(sdk, options)'}>

```js
const instance = new AccountsSDK({
  client_id: '<your_app_client_id>'
});

const popup = new Popup(instance, instance.options);
```

</CodeSample>

A popup object instance could be also created via `sdk` with:

  ```js
  const popup = instance.popup();
  ```

#### **popup.authorize()**

Returns a promise that resolves with the user authorization data or an error.

<CodeSample path={'popup.authorize()'}>

```js
  popup.authorize().then((authorizeData) => {
    console.log("authorize data acquired: " + authorizeData);
  }).catch(e => {
    console.error("Failed to acquire authorization data: " + e);
  });
```

</CodeSample>

### **Redirect**

A class responsible for acquiring the user authorization data through the `redirect` method.

#### **constructor(sdk, options)**

The constructor accepts an `sdk` instance and the `options` object with the same parameters as `AccountsSDK`.

<CodeSample path={'constructor(sdk, options)'}>

```js
const instance = new AccountsSDK({
  client_id: '<your_app_client_id>'
});

const redirect = new Redirect(instance, instance.options);
```

</CodeSample>
  
<Text>

A redirect object instance could be also created via `sdk` with:

</Text>

<CodeSample path={'instance.redirect()'}>

```js
const redirect = instance.redirect();
```

</CodeSample>

#### **redirect.authorize()**

Starts the redirect authorization flow.

```js
  redirect.authorize();
```

#### **redirect.authorizeData()**

Checks if a user was redirected to the current origin with the authorization data. It returns a promise that resolves with the user authorization data or with an error.

<CodeSample path={'redirect.authorizeData()'}>

```js
  redirect.authorizeData().then((authorizeData) => {
    console.log("Authorization data acquired: " + authorizeData);
  }).catch(e => {
    console.error("Failed to acquire authorization data: " + e);
    redirect.authorize(); // Try to redirect user to authorization once more
  });
```

</CodeSample>

### **Transaction**

A class responsible for validating the received authorization data against. The class allows you to compare the value of `state` before the auth flow was started and after it was completed.

#### **constructor(options)**

Creates a new instance of the transaction helper. The constructor accepts the `options` object with the same parameters as `AccountsSDK`.

```js
  const transaction = new Transaction({});
```

#### **generate(params)**

Generates a new transaction from parameters and stores the transaction in cookies or in localStorage for 30 minutes.

<CodeSample path={'generate(params)'}>

```js
  transaction.generate({
    user_page: "/login_test",
    state: "fdac3321gfd"
  });
```

</CodeSample>

#### **get(state)**

 Returns the transaction generated for a given state.

```js
  const transactionData = transaction.get("fdac3321gfd");
```

#### **clear(state)**

Removes the transaction generated for the provided state.

```js
  transaction.clear("fdac3321gfd");

  transaction.get("fdac3321gfd"); // Will return `{}` object
```

## Exchanging code for tokens with the PKCE extension

In order to acquire both `access_token` and `refresh_token` by a frontend application, you should use the <a href="https://www.oauth.com/oauth2-servers/oauth-native-apps/pkce/" rel="noopener nofollow" target="_blank">PKCE Extension</a>, which prevents the usage of a hijacked redirect by malicious apps.

1. Start by enabling PKCE. To do so, provide `AccountsSDK` instance with PKCE options.

<CodeSample path={'Enable PKCE'}>

```js
  const instance = new AccountsSDK({
    client_id: '<your_app_client_id>',
    redirect_uri: '<your_app_redirect_uri>',
    response_type: "code",
    pkce: {
      enabled: true
    }
  });
```

</CodeSample>

2. Then, using the `redirect` flow, you're able to receive the `code` authorization data:

<CodeSample path={'Receive authorization code data'}>

```js
  instance.redirect().authorizeData().then((authorizeData) => {
    const transactionData = instance.verify(authorizeData);
    if (transactionData === null) {
      console.log("Failed to verify authorization data");
      return;
    }
    fetch(instance.options.server_url + "/v2/token", {
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        method: "POST",
        body: JSON.stringify({
          grant_type: "authorization_code",
          code: authorizeData.code,
          client_id: transactionData.client_id,
          redirect_uri: transactionData.redirect_uri,
          code_verifier: transactionData.code_verifier,
      })
    })
    .then((res) => { res.json()}).then((data) => {console.log("User tokens: " + data)})
    .catch((e) => { console.log("Failed to exchange code: " + e) })
  }).catch(e => {
    // As we don't have any authorization data, then we can try o authorize user
    const wasRedirected = sessionStorage.getItem('lc_accounts');
    if (wasRedirected === "yes") {
      console.error("Couldn't authorize user: " + e);
      return
    }
    sessionStorage.setItem('lc_accounts', yes);
    instance.redirect().authorize(); // Initiate authorization redirect flow

  })
```

</CodeSample>

## Response format

All `authorize` methods return the user authorization data when resolving with success, or return an error when something goes wrong.

### Success

For successful user authorization processes, the returned data will consists of the following elements:

| Field             | Returned                               | Description                                                                                                                                                  |
| ----------------- | -------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `access_token`    | only for `response_type: access_token` | Used for authorizing LiveChat API calls.                                                                                                                     |
| `code`            | only for `response_type: code`         | Must be exchanged for `access_token` and `refresh_token`                                                                                                     |
| `scopes`          | for both response types                | An array of scopes that `access_token` has.                                                                                                                  |
| `expires_in`      | for both response types                | Defines for how long `access_token` will be valid.                                                                                                           |
| `account_id`      | for both response types                | LiveChat Accounts user ID (can be found in <a href="https://developers.livechat.com/console/" rel="noopener nofollow" target="_blank">Developer Console</a>) |
| `organization_id` | for both response types                | LiveChat Accounts organization ID to which the account is logged in.                                                                                         |
| `client_id`       | for both response types                | `client_id` that you passed in the `init` method.                                                                                                            |

### Error

If the authorization process fails, the promise will be rejected with an error. The error will have the following properties:

```js
  {
    "oauth_exception": "<exception_name>"
    "identity_exception": "<exception_name>"
    "description": "<exception_description>"
  }
  ""
```

#### Authentication errors

##### identity_exception

Possible values:

- `unauthorized` – The resource owner identity is uknown or the consent is missing.

#### Authorization errors

##### oauth_exception

Possible values:

- `invalid_request` – The request is missing a required parameter, includes an invalid parameter value, includes a parameter more than once, or is otherwise malformed. Examples: wrong HTTP method, invalid HTTP body encoding.
- `unauthorized_client` – The client is not authorized to request a token using this method. Examples: missing `client_id` param, incorrect `client_id` value, `refresh_token` not found, invalid `client_secret`, invalid `redirect_uri`.
- `access_denied` – The resource owner or authorization server denied the request. For example, the requested scope includes a scope not originally granted by the resource owner.
- `unsupported_response_type` – The authorization server doesn't support acquiring a token using this method. For example, `response_type` is not `token` or `code`.

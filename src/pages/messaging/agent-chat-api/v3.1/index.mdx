---
weight: 20
category: "messaging"
subcategory: "agent-chat-api"
title: "Web API Reference"
tagline: "Interact with the chat as an Agent."
desc: "Build powerful LiveChat integrations with an open messaging protocol. Use the Agent Chat Web API to send messages, manage access and properties."
apiVersion: "3.1"
---

# Introduction

## Versioning

This document describes the **Agent Chat Web API v3.1**. This is the **legacy** version. We encourage you to migrate to the latest stable version. [Read more about versioning...](/messaging/#api-versioning)

## What is Web API

Web API is similar to REST API. Client can send a **request message** that results in getting a **response message**. It's also possible to get webhooks.

## When to use Web API

If you're wondering which API to use - Agent Chat **RTM API** or **Web API**, keep on reading.

**Web API** allows for building stateless integrations. The communication is done via **XHR requests**. The implementation is easier than with RTM API, but you need to take possible time delays into consideration.

**Not what you're looking for?** Perhaps, you need to use [**Agent Chat RTM API**](/messaging/agent-chat-api/v3.1/rtm-reference/) instead.

## Access

The basics on authorization, access tokens, and scopes in the Agent Chat Web API.

### Authorization

**Agent authorization** is handled with access tokens. Find out how to get an **access token** from [Agent authorization flows](/authorization/authorizing-api-calls/#agent-authorization-flows). Take note **you won't be able to use this token** for the Customer Chat API.

### Scopes

All authorization scopes are listed in the [Scopes](/getting-started/authorization/scopes/) document. If a method requires certain scopes, you'll find them included in the method description. Keep in mind that Web API requires authorization every time you make a request.

## Data centers

LiveChat system operates in two data centers: `dal` (USA) and `fra` (Europe). The default data center is `dal`.

All the LiveChat OAuth2.0 access tokens have a prefix: `dal-` or `fra-`. This prefix indicates the data center they belong to. If you need to specify the data center while making an API call, simply add the `X-Region: <token_prefix>` optional header.

Summing up, if the user token starts with `fra-`, you should add the `X-Region: fra` header. If the token starts with `dal-`, you don’t have to specify the header.

## Rate limits

To prevent sending a massive number of requests, there are rate limits for method calls. After exceeding those limits, the requester will get a `Too many requests` error in the response of a specific request. After some time, the request will be unblocked so it can be sent again.

## Postman collection

You can find all the requests from the Agent Chat Web API v3.1 in Postman. In our collection, we use [environment variables](https://learning.getpostman.com/docs/postman/environments_and_globals/manage_environments/) for the API version and the access token. Importing the collection from the link below downloads the **LiveChat Web API** environment as well. Remember to replace the sample token with your own.

[![Run in Postman](https://run.pstmn.io/button.svg)](https://app.getpostman.com/run-collection/ac23e81bc6b8054480e5#?env%5BLiveChat%20Web%20API%5D=W3sia2V5IjoiYXBpX3ZlcnNpb24iLCJ2YWx1ZSI6InYzLjEiLCJlbmFibGVkIjp0cnVlfSx7ImtleSI6ImFjY2Vzc190b2tlbiIsInZhbHVlIjoiZGFsOlRMSjdRc3RYUXNTeHVWOGI1aDFSZmciLCJlbmFibGVkIjp0cnVlfV0=)

<Section>
<Text>

# Data structures

To find sample payloads of **events**, **users**, and **other common structures** such as chats or threads [visit the Data structures](/messaging/agent-chat-api/v3.1/data-structures) document.

# Methods

Web API actions can generate webhooks, as well as pushes. However, pushes can be delivered only in the websocket transport. If you want to be notified about emitted events with webhooks, you need to [register](/management/configuration-api/v3.1/#register-webhook) them first.

| HTTP method | The API endpoint                                         |
| ----------- | -------------------------------------------------------- |
| `POST`      | `https://api.livechatinc.com/v3.1/agent/action/<action>` |

| Header          |                   Value                    |                                                             Notes |
| --------------- | :----------------------------------------: | ----------------------------------------------------------------: |
| `Content-Type`  | `multipart/form-data; boundary=<boundary>` |                                Valid for the `upload_file` method |
| `Content-Type`  |             `application/json`             |                    Valid for all methods except for `upload_file` |
| `Authorization` |              `Bearer <token>`              |                                                      Access token |
| `X-Region`      |                   `fra`                    | Required for a license from Europe. [More info...](#data-centers) |
| `X-Author-Id`   |              `<bot_agent_id>`              |                                         Valid only for Bot Agents |
| `X-API-Version` |       API version, for example `3.1`       | You don't need this header if you specify API version in the URL. |

</Text>
<Code>
<CodeSample path={'GENERAL WEB API REQUEST FORMAT '}>

```shell
curl -X POST \
  https://api.livechatinc.com/v3.1/agent/action/<action> \
  -H 'Content-Type: <content-type>' \
  -H 'Authorization: Bearer <your_access_token>' \
  -d '{
        // payload
      }'
```

</CodeSample>
</Code>
</Section>

## Available methods

|                 |                                                                                                                                                                                                                                                                                                                                                         |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Chats**       | [`get_chats_summary`](#get-chats-summary) [`get_chat_threads_summary`](#get-chat-threads-summary) [`get_chat_threads`](#get-chat-threads) [`get_archives`](#get-archives) [`start_chat`](#start-chat) [`activate_chat`](#activate-chat) [`close_thread`](#close-thread) [`follow_chat`](#follow-chat) [`unfollow_chat`](#unfollow-chat)                 |
| **Chat access** | [`grant_access`](#grant-access) [`revoke_access`](#revoke-access) [`set_access`](#set-access) [`transfer_chat`](#transfer-chat)                                                                                                                                                                                                                         |
| **Chat users**  | [`add_user_to_chat`](#add-user-to-chat) [`remove_user_from_chat`](#remove-user-from-chat)                                                                                                                                                                                                                                                               |
| **Events**      | [`send_event`](#send-event) [`upload_file`](#upload-file) [`send_rich_message_postback`](#send-rich-message-postback)                                                                                                                                                                                                                                   |
| **Properties**  | [`update_chat_properties`](#update-chat-properties) [`delete_chat_properties`](#delete-chat-properties) [`update_chat_thread_properties`](#update-chat-thread-properties) [`delete_chat_thread_properties`](#delete-chat-thread-properties) [`update_event_properties`](#update-event-properties) [`delete_event_properties`](#delete-event-properties) |
| **Thread tags** | [`tag_chat_thread`](#tag-chat-thread) [`untag_chat_thread`](#untag-chat-thread)                                                                                                                                                                                                                                                                         |
| **Customers**   | [`get_customers`](#get-customers) [`create_customer`](#create-customer) [`update_customer`](#update-customer) [`ban_customer`](#ban-customer)                                                                                                                                                                                                           |
| **Status**      | [`update_agent`](#update-agent)                                                                                                                                                                                                                                                                                                                         |
| **Other**       | [`mark_events_as_seen`](#mark-events-as-seen) [`send_typing_indicator`](#send-typing-indicator) [`multicast`](#multicast)                                                                                                                                                                                                                               |

[![Run in Postman](https://run.pstmn.io/button.svg)](https://app.getpostman.com/run-collection/ac23e81bc6b8054480e5#?env%5BLiveChat%20Web%20API%5D=W3sia2V5IjoiYXBpX3ZlcnNpb24iLCJ2YWx1ZSI6InYzLjEiLCJlbmFibGVkIjp0cnVlfSx7ImtleSI6ImFjY2Vzc190b2tlbiIsInZhbHVlIjoiZGFsOlRMSjdRc3RYUXNTeHVWOGI1aDFSZmciLCJlbmFibGVkIjp0cnVlfV0=)

## Chats

<Section>
<Text>

### Get Chats Summary

It returns [summaries](#chat-summaries) of the chats an Agent has access to.

#### Specifics

|                        |                                                                   |
| ---------------------- | ----------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/get_chats_summary` |
| **Required scopes**    | `chats--all:ro` `chats--access:ro` `chats--my:ro`                 |
| **RTM API equivalent** | [`get_chats_summary`](rtm-reference/#get-chats-summary)           |
| **Webhook**            | -                                                                 |

#### Request

| Parameter                                             | Required | Type     | Notes                                                                                       |
| ----------------------------------------------------- | -------- | -------- | ------------------------------------------------------------------------------------------- |
| `filters`                                             | No       | `object` | Mustn't change between requests for subsequent pages. Otherwise, the behavior is undefined. |
| `filters.include_active`                              | No       | `bool`   | Defines if the returned chat summary includes active chats; default: `true`.                |
| `filters.group_ids`                                   | No       | `array`  | Array of group IDs.                                                                         |
| `filters.properties.<namespace>.<name>.<filter_type>` | No       | `any`    |                                                                                             |
| `order`                                               | No       | `string` | Possible values: `asc` - oldest chats firstm `desc` - newest chats first (default)          |
| `limit`                                               | No       | `number` | Default: 10, maximum: 100                                                                   |
| `page_id`                                             | No       | `string` |                                                                                             |

`filter_type` can take the following values:

- exists (bool)
- values (type[] - array with specific type for property: `string`, `int`, or `bool`)
- exclude_values (type[] - array with specific type for property: `string`, `int`, or `bool`)

There's only one value allowed for a single property.

#### Response

| Field              | Data type | Notes                                                                    |
| ------------------ | --------- | ------------------------------------------------------------------------ |
| `found_chats`      | `number`  | An estimated number. The real number of found chats can slightly differ. |
| `next_page_id`     | `string`  | In relation to `page_id` specified in the request.                       |
| `previous_page_id` | `string`  | In relation to `page_id` specified in the request.                       |


</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
  https://api.livechatinc.com/v3.1/agent/action/get_chats_summary \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer <your_access_token>' \
  -d '{}'
```

</CodeSample>
<CodeResponse>

```json
{
    "next_page_id": "MTUxNzM5ODEzMTQ5Ng==", // optional
    "chats_summary": [
        {
            "id": "PJ0MRSHTDG",
            "last_event_per_type": {
                "message": {
                    "thread_id": "K600PKZON8",
                    "thread_order": 1,
                    "event": {
                        "id": "Q298LUVPRH_1",
                        "created_at": "2019-12-09T12:01:18.909000Z",
                        "recipients": "all",
                        "type": "message",
                        "text": "hello world",
                        "author_id": "5ae8b076-03b0-43db-44f9-b95f8ead62e4"
                    }
                },
                "system_message": {
                    "thread_id": "K600PKZON8",
                    "thread_order": 1,
                    "event": {
                      // "System message" event
                    }
                }
            },
            "users": [
                {
                  // "Customer" user object
                },
                {
                  // "Agent" user object
                }
            ],
            "last_thread_summary": {
                "id": "K600PKZON8",
                "timestamp": 1575892853,
                "user_ids": [
                    "5ae8b076-03b0-43db-44f9-b95f8ead62e4",
                    "customer1@example.com"
                ],
                "order": 1,
                "properties": {
                  // "Properties" object
                },
                "active": true,
                "access": {
                    "group_ids": [0]
                }
            },
            "properties": {
              // "Properties" object
            },
            "access": {
                "group_ids": [0]
            },
            "order": 1575892853242000,
            "is_followed": true
            }
        ],
        "found_chats": 4
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Get Chat Threads Summary

#### Specifics

|                        |                                                                          |
| ---------------------- | ------------------------------------------------------------------------ |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/get_chat_threads_summary` |
| **Required scopes**    | `chats--all:ro` `chats--access:ro` `chats--my:ro`                        |
| **RTM API equivalent** | [`get_chat_threads_summary`](rtm-reference/#get-chat-threads-summary)    |
| **Webhook**            | -                                                                        |

#### Request

| Parameter | Required | Data type | Notes                                                                                  |
| --------- | -------- | --------- | -------------------------------------------------------------------------------------- |
| `chat_id` | Yes      | `string`  |                                                                                        |
| `order`   | No       | `string`  | Possible values: `asc` - oldest chats first and `desc` - newest chats first (default). |
| `limit`   | No       | `number`  | Default: 10, maximum: 100                                                              |
| `page_id` | No       | `string`  |                                                                                        |

#### Response

| Field              | Data type | Notes                                              |
| ------------------ | --------- | -------------------------------------------------- |
| `found_threads`    | `number`  | Number of threads in a chat                        |
| `next_page_id`     | `string`  | In relation to `page_id` specified in the request. |
| `previous_page_id` | `string`  | In relation to `page_id` specified in the request. |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/get_chat_threads_summary \
 -H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
    "chat_id": "PWJ8Y4THAV"
    }'
```

</CodeSample>
<CodeResponse>

```json
{
  "threads_summary": [
    {
      "id": "PT039ES4OG",
      "order": 2,
      "events_count": 2
    },
    {
      "id": "PT039DS6IP",
      "order": 1,
      "events_count": 17
    }
  ],
  "found_threads": 7,
  "next_page_id": "MTUxNzM5ODEzMTQ5Ng==", // optional
  "previous_page_id": "MTUxNzM5ODEzMTQ5Nw==" // optional
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Get Chat Threads

It returns threads that the current Agent has access to in a given chat.

#### Specifics

|                        |                                                                  |
| ---------------------- | ---------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/get_chat_threads` |
| **Required scopes**    | `chats--all:ro` `chats--access:ro`                               |
| **RTM API equivalent** | [`get_chat_threads`](rtm-reference/#get-chat-threads)            |
| **Webhook**            | -                                                                |

#### Request

| Parameter    | Required | Data type |     |
| ------------ | -------- | --------- | --- |
| `chat_id`    | Yes      | `string`  |     |
| `thread_ids` | No       | `array`   |     |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
  https://api.livechatinc.com/v3.1/agent/action/get_chat_threads \
  -H 'Authorization: Bearer <your_access_token>' \
  -H 'Content-Type: application/json' \
  -d '{
      "chat_id": "PWJ8Y4THAV"
      }'
```

</CodeSample>
<CodeResponse>

```json
{
    "chat": {
        "id": "PWJ8Y4THAV",
        "users": [
            {
                "id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
                "type": "customer",
                "present": true,
                "created_at": "2019-12-17T08:53:20.693553+01:00",
                "statistics": {
                    "chats_count": 1,
                    // ...
                },
                "agent_last_event_created_at": "2019-12-17T09:04:05.239000+01:00"
            },
            {
                "id": "agent1@example.com",
                "name": "Agent Name",
                "email": "agent1@example.com",
                "type": "agent",
                "present": true,
                "avatar": "https://example.com/avatar.jpg"
            }
        ],
        "threads_summary": [
            {
                "thread_id": "Q20N9CKRX2",
                "order": 1
            }
        ],
        "properties": {
          // "Property" object
        },
        "access": {
            "group_ids": [0]
        },
        "is_followed": true
    }
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Get Archives

It returns a list of the chats an Agent has access to. Together with a **chat**, the **events** of **one thread** from this chat are returned.

The list classification is based on threads; 1 chat per 1 thread. Thus, the same **chat** object may appear on the list several times, but each time with a different **thread**. The returned **chat** is a complete object, not only a **chat summary**.

#### Specifics

|                        |                                                              |
| ---------------------- | ------------------------------------------------------------ |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/get_archives` |
| **Required scopes**    | `chats--all:ro` `chats--access:ro`                           |
| **RTM API equivalent** | [`get_archives`](rtm-reference/#get-archives)                |
| **Webhook**            | -                                                            |

#### Request

| Parameter                                             | Required | Data type | Notes                                                                                     |
| ----------------------------------------------------- | -------- | --------- | ----------------------------------------------------------------------------------------- |
| `filters`                                             | No       | `object`  |                                                                                           |
| `filters.query`                                       | No       | `string`  |                                                                                           |
| `filters.date_from`                                   | No       | `string`  | `YYYY-MM-DD` format                                                                       |
| `filters.date_to`                                     | No       | `string`  | `YYYY-MM-DD` format                                                                       |
| `filters.agent_ids`                                   | No       | `array`   | Array of agent IDs                                                                        |
| `filters.thread_ids`                                  | No       | `array`   | Array of thread IDs. Cannot be used with other filters or pagination; max array size: 20. |
| `filters.group_ids`                                   | No       | `array`   | Array of group IDs                                                                        |
| `filters.properties.<namespace>.<name>.<filter_type>` | No       | `any`     | **\*** **described below**                                                                |
| `filters.tags.<filter_type>`                          | No       | `any`     |                                                                                           |
| `filters.sales.<filter_type>`                         | No       | `any`     |                                                                                           |
| `filters.goals.<filter_type>`                         | No       | `any`     |                                                                                           |
| `filters.surveys.<survey>`                            | No       | `array`   | **\*\*** **described below**                                                              |
| `pagination`                                          | No       | `object`  |                                                                                           |
| `pagination.page`                                     | No       | `number`  | Default: 1, min: 1, max: 1000                                                             |
| `pagination.limit`                                    | No       | `number`  | Default: 25, min: 0, max: 100                                                             |

**\*)**

`sort_order` can take the following values:

- `asc` - the oldest chats first
- `desc` - the newest chats first

`<filter_type>` can take the following values:

- `exists` (`bool`)
- `values` (`type[]` - an array with a specific type for property: `string`, `int` or `bool`)
- `exclude_values` (`type[]` - an array with a specific type for property: `string`, `int` or `bool`)

There's only one value allowed for a single property.

**\*\*)**
`<survey>` contains the following fields:

- `type` (`string`) - allowed values: `pre_chat`, `post_chat`
- `answer_id` (`string`)

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
  https://api.livechatinc.com/v3.1/agent/action/get_archives \
  -H 'Authorization: Bearer <your_access_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "filters": {
      "thread_ids": ["K600PKZON8"]
    }
  }'
```

</CodeSample>

<CodeResponse>

```json
{
  "chats": [
    {
      "id": "PJ0MRSHTDG",
      "users": [
        {
          "id": "smith@example.com",
          "name": "Agent Smith",
          "email": "smith@example.com",
          "type": "agent",
          "present": true,
          "avatar": "https://cdn.livechatinc.com/cloud/?uri=avatar.jpg"
        }
      ],
      "thread": {
        "id": "K600PKZON8",
        "timestamp": 1590666298,
        "active": false,
        "user_ids": [
          "smith@example.com"
        ],
        "events": [
          {
            "id": "QBT14H0Y3Y_1",
            "created_at": "2020-05-28T11:45:32.269000Z",
            "recipients": "all",
            "type": "message",
            "properties": {
              "0805e283233042b37f460ed8fbf22160": {
                "event_property": {
                  "value": "property_value"
                }
              }
            },
            "text": "Hello, how can I help you?",
            "author_id": "smith@example.com"
          }
        ],
        "order": 1,
        "properties": {
          "0805e283233042b37f460ed8fbf22160": {
            "thread_property": {
              "value": "property_value"
            }
          }
        },
        "access": {
          "group_ids": [
            0
          ]
        }
      },
      "properties": {
        "0805e283233042b37f460ed8fbf22160": {
          "chat_property": {
            "value": "property_value"
          }
        },
      },
      "access": {
        "group_ids": [
          0
        ]
      },
      "is_followed": false
    }
  ],
  "found_chats": 42,
  "next_page_id": "MTUxNzM5ODEzMTQ5Ng==",
  "previous_page_id": "MTUxNzM5ODEzMTQ5Ng=="
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Start Chat

Starts a chat.

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/start_chat`                               |
| **Required scopes \*** | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **RTM API equivalent** | [`start_chat`](rtm-reference/#start-chat)                                                |
| **Webhook**            | [`incoming_chat_thread`](/management/webhooks/v3.1/#incoming_chat_thread)                |

**\*)**
When `chat.users` is defined, one of following scopes is required:

- `chats--all:rw`
- `chats--access:rw`
- `chats--my:rw`

#### Request

| Parameters               | Required | Data type | Notes                                                                       |
| ------------------------ | -------- | --------- | --------------------------------------------------------------------------- |
| `chat`                   | No       | `object`  |                                                                             |
| `chat.properties`        | No       | `object`  |                                                                             |
| `chat.access`            | No       | `object`  |                                                                             |
| `chat.users`             | No       | `array`   | The list of existing users. Only one user is allowed (type `customer`).     |
| `chat.thread`            | No       | `object`  |                                                                             |
| `chat.thread.events`     | No       | `array`   | The list of initial chat events.                                            |
| `chat.thread.properties` | No       | `object`  |                                                                             |
| `continuous`             | No       | `bool`    | Starts chat as continuous (online group is not required); default: `false`. |

#### Response

| Field       | Data type  | Notes                                                                                                                                                                   |
| ----------- | ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`   | `string`   |                                                                                                                                                                         |
| `thread_id` | `string`   |                                                                                                                                                                         |
| `event_ids` | `[]string` | Returned only when the chat was started with initial events. Returns only the IDs of user-generated events; server-side generated events are not included in the array. |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
  https://api.livechatinc.com/v3.1/agent/action/start_chat \
  -H 'Authorization: Bearer <your_access_token>' \
  -H 'Content-Type: application/json' \
  -d '{}'
```

</CodeSample>
<CodeResponse>

```json
{
  "chat_id": "PJ0MRSHTDG",
  "thread_id": "PGDGHT5G"
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Activate Chat

Restarts an archived chat.

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/activate_chat`                            |
| **Required scopes \*** | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **RTM API equivalent** | [`activate_chat`](rtm-reference/#activate-chat)                                          |
| **Webhook**            | [`incoming_chat_thread`](/management/webhooks/v3.1/#incoming_chat_thread)                |

**\*)**
When `chat.users` is defined, one of following scopes is required:

- `chats--all:rw`
- `chats--access:rw`
- `chats--my:rw`

#### Request

| Parameter                | Required | Data type | Notes                                                                      |
| ------------------------ | -------- | --------- | -------------------------------------------------------------------------- |
| `chat`                   | Yes      | `object`  |                                                                            |
| `chat.id`                | Yes      | `string`  | ID of the chat that will be activated.                                     |
| `chat.access`            | No       | `object`  | Chat access to set, default: all agents.                                   |
| `chat.properties`        | No       | `object`  | Initial chat properties                                                    |
| `chat.users`             | No       | `array`   | The list of existing users. Only one user is allowed (type `customer`).    |
| `chat.thread`            | No       | `object`  |                                                                            |
| `chat.thread.events`     | No       | `array`   | Initial chat events array                                                  |
| `chat.thread.properties` | No       | `object`  | Initial chat thread properties                                             |
| `continuous`             | No       | `bool`    | Sets a chat to the continuous mode. When unset, leaves the mode unchanged. |

#### Response

| Field       | Data type  | Notes                                                                                                                                                                     |
| ----------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `thread_id` | `string`   |                                                                                                                                                                           |
| `event_ids` | `[]string` | Returned only when the chat was activated with initial events. Returns only the IDs of user-generated events; server-side generated events are not included in the array. |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
  https://api.livechatinc.com/v3.1/agent/action/activate_chat \
  -H 'Authorization: Bearer <your_access_token>' \
  -H 'Content-Type: application/json' \
  -d '{
      "chat": {
          "id": "PWJ8Y4THAV"
          }
      }'
```

</CodeSample>
<CodeResponse>

```json
{
  "thread_id": "Z8AGR5OUW"
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Close Thread

Closes a thread. Sending messages to this thread will no longer be possible.

#### Specifics

|                        |                                                              |
| ---------------------- | ------------------------------------------------------------ |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/close_thread` |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`            |
| **RTM API equivalent** | [`close_thread`](rtm-reference/#close-thread)                |
| **Webhook**            | [`thread_closed`](/management/webhooks/v3.1/#thread_closed)  |

#### Request

| Parameter | Required | Data type |     |
| --------- | -------- | --------- | --- |
| `chat_id` | Yes      | `string`  |     |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
  https://api.livechatinc.com/v3.1/agent/action/close_thread \
  -H 'Authorization: Bearer <your_access_token>' \
  -H 'Content-Type: application/json' \
  -d '{
      "chat_id": "PJ0MRSHTDG"
      }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Follow Chat

Marks a chat as followed. All changes to the chat will be sent to the requester until the chat is reactivated or unfollowed. Chat members don't need to follow their chats. They receive all chat pushes regardless of their follower status.

#### Specifics

|                        |                                                                                 |
| ---------------------- | ------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/follow_chat`                     |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`                               |
| **RTM API equivalent** | [`follow_chat`](rtm-reference/#follow-chat)                                     |
| **Webhook**            | [`incoming_chat_thread`](/management/webhooks/v3.1/#incoming_chat_thread)**\*** |

**\*)**
It won't be sent when the requester already follows the chat or is the chat member.

#### Request

| Parameter | Required | Data type |     |
| --------- | -------- | --------- | --- |
| `chat_id` | Yes      | `string`  |     |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/follow_chat \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
    "chat_id": "PW94SJTGW6"
    }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Unfollow Chat

Removes the requester from the chat followers. After that, only key changes to the chat (like `transfer_chat` or `close_active_thread`) will be sent to the requester. Chat members cannot unfollow the chat.

#### Specifics

|                        |                                                               |
| ---------------------- | ------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/unfollow_chat` |
| **Required scopes**    | -                                                             |
| **RTM API equivalent** | [`unfollow_chat`](rtm-reference/#unfollow-chat)               |
| **Webhook**            | -                                                             |

#### Request

| Parameter | Required | Data type |     |
| --------- | -------- | --------- | --- |
| `chat_id` | Yes      | `string`  |     |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/unfollow_chat \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "chat_id": "PWF6BACIKO"
   }'
```

</CodeSample>
</Code>
</Section>

## Chat access

<Section>
<Text>

### Grant Access

Grants access to a new resource without overwriting the existing ones.

#### Specifics

|                        |                                                               |
| ---------------------- | ------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/grant_access`  |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`             |
| **RTM API equivalent** | [`grant_access`](rtm-reference/#grant-access)                 |
| **Webhook**            | [`access_granted`](/management/webhooks/v3.1/#access_granted) |

#### Request

| Parameter     | Required | Data ype | Notes                                                       |
| ------------- | -------- | -------- | ----------------------------------------------------------- |
| `resource`    | Yes      | `string` | `chat` or `customer`                                        |
| `id`          | Yes      | `string` | Resource Id                                                 |
| `access`      | Yes      | `object` | The entity that is granted access to the specified resource |
| `access.type` | Yes      | `string` | `group`                                                     |
| `access.id`   | Yes      | `number` |                                                             |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/grant_access \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
    "resource": "chat",
    "id": "PW94SJTGW6",
    "access": {
        "type": "group",
        "id": 19
        }
    }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Revoke Access

#### Specifics

|                        |                                                               |
| ---------------------- | ------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/revoke_access` |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`             |
| **RTM API equivalent** | [`revoke_access`](rtm-reference/#revoke-access)               |
| **Webhook**            | [`access_revoked`](/management/webhooks/v3.1/#access_revoked) |

#### Request

| Parameter     | Required | Data type | Notes                                                  |
| ------------- | -------- | --------- | ------------------------------------------------------ |
| `resource`    | Yes      | `string`  | `chat` or `customer`                                   |
| `id`          | Yes      | `string`  | Resource Id                                            |
| `access`      | Yes      | `object`  | The entity that loses access to the specified resource |
| `access.type` | Yes      | `string`  | `group`                                                |
| `access.id`   | Yes      | `number`  |                                                        |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/revoke_access \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "resource": "chat",
   "id": "PW94SJTGW6",
   "access": {
       "type": "group",
       "id": 19
       }
   }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Set Access

Gives access to a new resource overwriting the existing ones.

#### Specifics

|                        |                                                            |
| ---------------------- | ---------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/set_access` |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`          |
| **RTM API equivalent** | [`set_access`](rtm-reference/#set-access)                  |
| **Webhook**            | [`access_set`](/management/webhooks/v3.1/#access_set)      |

#### Request

| Parameter     | Required | Type     | Notes                                                     |
| ------------- | -------- | -------- | --------------------------------------------------------- |
| `resource`    | Yes      | `string` | `chat` or `customer`                                      |
| `id`          | Yes      | `string` | resource id                                               |
| `access`      | Yes      | `object` | The entity that is given access to the specified resource |
| `access.type` | Yes      | `string` | `group`                                                   |
| `access.id`   | Yes      | `number` |                                                           |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/set_access \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "resource": "chat",
   "id": "PW94SJTGW6",
   "access": {
       "type": "group",
       "id": 19
       }
   }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Transfer Chat

Transfers a chat to an Agent or a group. When transferring directly to an agent, the agent must have access to the transferred chat.

#### Specifics

|                        |                                                               |
| ---------------------- | ------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/transfer_chat` |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`             |
| **RTM API equivalent** | [`transfer_chat`](rtm-reference/#transfer-chat)               |
| **Webhook**            | -                                                             |

#### Request

| Parameter     | Required | Data ype | Notes                                                                                                                           |
| ------------- | -------- | -------- | ------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`     | Yes      | `string` | Resource Id                                                                                                                     |
| `target`      | No       | `object` | If missing, the chat will be transferred within the current group.                                                              |
| `target.type` | Yes      | `string` | `group` or `agent`                                                                                                              |
| `target.ids`  | Yes      | `array`  | `group` or `agent` IDs array                                                                                                    |
| `force`       | No       | `bool`   | If `true`, always transfers chats. Otherwise. fails when unable to assign any Agent from the requested groups; default `false`. |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/transfer_chat \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "chat_id": "PWF6BACIKO",
   "target": {
       "type": "group",
       "ids": [
           19
           ]
       }
   }'
```

</CodeSample>
</Code>
</Section>

## Chat users

<Section>
<Text>

### Add User to Chat

Adds a user to the chat. You can't add more than one `customer` user type to the chat.

#### Specifics

|                        |                                                                  |
| ---------------------- | ---------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/add_user_to_chat` |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`                |
| **RTM API equivalent** | [`add_user_to_chat`](rtm-reference/#add-user-to-chat)            |
| **Webhook**            | [`chat_user_added`](/management/webhooks/v3.1/#chat_user_added)  |

#### Request

| Parameter   | Required | Type     | Notes                                  |
| ----------- | -------- | -------- | -------------------------------------- |
| `chat_id`   | Yes      | `string` |                                        |
| `user_id`   | Yes      | `string` |                                        |
| `user_type` | Yes      | `string` | Possible values: `agent` or `customer` |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
  curl -X POST \
  https://api.livechatinc.com/v3.1/agent/action/add_user_to_chat \
  -H 'Authorization: Bearer <your_access_token>' \
  -H 'Content-Type: application/json' \
  -d '{
      "chat_id": "PW94SJTGW6",
      "user_id": "agent1@example.com",
      "user_type": "agent"
      }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Remove User from Chat

Removes a user from chat. Removing `customer` user type is not allowed. It's always possible to remove the requester from the chat.

#### Specifics

|                        |                                                                       |
| ---------------------- | --------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/remove_user_from_chat` |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`                     |
| **RTM API equivalent** | [`remove_user_from_chat`](rtm-reference/#remove-user-from-chat)       |
| **Webhook**            | [`chat_user_removed`](/management/webhooks/v3.1/#chat_user_removed)   |

#### Request payload

| Parameter   | Required | Type     | Notes                                     |
| ----------- | -------- | -------- | ----------------------------------------- |
| `chat_id`   | Yes      | `string` |                                           |
| `user_id`   | Yes      | `string` |                                           |
| `user_type` | Yes      | `string` | Possible values are `agent` or `customer` |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/remove_user_from_chat \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "chat_id": "PW94SJTGW6",
   "user_id": "agent1@example.com",
   "user_type": "agent"
   }'
```

</CodeSample>
</Code>
</Section>

## Events

<Section>
<Text>

### Send Event

Sends an [Event](#events) object. Use this method to send a message by specifing the [Message](#message) event type in the request.

It's possible to write to a chat without joining it. The user sending an event will be automatically added to the chat with the `present` parameter set to `false` (see [`chat_user_added`](/messaging/agent-chat-api/v3.1/rtm-reference/#chat_user_added)). **Sample use case:** a Bot Agent that sends messages visible to all chat participants without actually joining the chat.

#### Specifics

|                        |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/send_event`                               |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **RTM API equivalent** | [`send_event`](rtm-reference/#send-event)                                                |
| **Webhook**            | [`incoming_event`](/management/webhooks/v3.1/#incoming_event)                            |

#### Request

| Parameter               | Required | Data type | Notes                                                                                                                                                             |
| ----------------------- | -------- | --------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`               | Yes      | `string`  | Id of the chat you want to send a message to.                                                                                                                     |
| `event`                 | Yes      | `object`  | Event object                                                                                                                                                      |
| `attach_to_last_thread` | No       | `bool`    | The flag is ignored for active chats. For inactive chats: `true` – the event will be added to the last thread; `false` – the request will fail. Default: `false`. |

#### Response

| Field      | Data type |
| ---------- | --------- |
| `event_id` | `string`  |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/send_event \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "chat_id": "PW94SJTGW6",
   "event": {
       "type": "message",
       "text": "hello world",
       "recipients": "all"
       }
   }'
```

</CodeSample>
<CodeResponse>

```json
{
  "event_id": "K600PKZON8"
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Upload File

Uploads a file to the server as a temporary file. It returns a URL that expires after 24 hours unless the URL is used in [`send_event`](#send-event).

#### Specifics

|                        |                                                                      |
| ---------------------- | -------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/upload_file`          |
| **RTM API equivalent** | -                                                                    |
| **Webhook**            | [`incoming_event`](/management/webhooks/v3.1/#incoming_event) **\*** |

**\*)**
`incoming_event` returns a URL that never expires.

#### Request

| Parameter | Required | Data type | Notes              |
| --------- | -------- | --------- | ------------------ |
| `file`    | Yes      | `binary`  | maximum size: 10MB |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
  https://api.livechatinc.com/v3.1/agent/action/upload_file \
  -H 'Authorization: Bearer <your_access_token>' \
  -H 'Content-Type: multipart/form-data; boundary=--------------------------210197025774705439685896' \
  -H 'content-type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW' \
  -F file=@/Users/MyAccount/Desktop/image.png
```

</CodeSample>
<CodeResponse>

```json
{
  "url": "https://cdn.livechat-files.com/api/file/lc/att/8948324/45a3581b59a7295145c3825c86ec7ab3/image.png"
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Send Rich Message Postback

#### Specifics

|                        |                                                                                                     |
| ---------------------- | --------------------------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/send_rich_message_postback`                          |
| **Required scopes**    | `chats.conversation--my:rw` `chats.conversation--all:rw`                                            |
| **RTM API equivalent** | [`send_rich_message_postback`](rtm-reference/#send-rich-message-postback)                           |
| **Webhook**            | [`incoming_rich_message_postback`](/management/webhooks/v3.1/#incoming_rich_message_postback)**\*** |

**\*)** `incoming_rich_message_postback` will be sent only for active threads.

#### Request

| Parameter          | Required | Data type | Notes                       |
| ------------------ | -------- | --------- | --------------------------- |
| `chat_id`          | Yes      | `string`  |                             |
| `event_id`         | Yes      | `string`  |                             |
| `postback`         | Yes      | `object`  |                             |
| `postback.id`      | Yes      | `string`  | Postback name of the button |
| `postback.toggled` | Yes      | `bool`    | Postback toggled true/false |
| `thread_id`        | Yes      | `string`  |                             |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/send_rich_message_postback \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "chat_id": "PJ0MRSHTDG",
   "thread_id": "K600PKZON8",
   "event_id": "a0c22fdd-fb71-40b5-bfc6-a8a0bc3117f7",
   "postback": {
       "id": "Method URL_yes",
       "toggled": true
       }
   }'
```

</CodeSample>
</Code>
</Section>

## Properties

<Section>
<Text>

### Update Chat Properties

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/update_chat_properties`                   |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **RTM API equivalent** | [`update_chat_properties`](rtm-reference/#update-chat-properties)                        |
| **Webhook**            | [`chat_properties_updated`](/management/webhooks/v3.1/#chat_properties_updated)          |

#### Request

| Parameter    | Required | Data type | Notes                                                                                                                                                                             |
| ------------ | -------- | --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you to set properties for.                                                                                                                                         |
| `properties` | Yes      | `object`  | Chat properties to set. You should stick to the [general properties format](/management/configuration-api/v3.1/#properties) and include _namespace_, _property name_ and _value_. |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/update_chat_properties \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
    "chat_id": "PW94SJTGW6",
    "properties": {
        "bb9e5b2f1ab480e4a715977b7b1b4279": {
            "score": 10,
            "comment": "Thank you!"
            }
        }
    }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Delete Chat Properties

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/delete_chat_properties`                   |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **RTM API equivalent** | [`delete_chat_properties`](rtm-reference/#delete-chat-properties)                        |
| **Webhook**            | [`chat_properties_deleted`](/management/webhooks/v3.1/#chat_properties_deleted)          |

#### Request

| Parameter    | Required | Data type | Notes                                          |
| ------------ | -------- | --------- | ---------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to delete property of. |
| `properties` | Yes      | `object`  | Chat properties to delete.                     |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
  curl -X POST \
  https://api.livechatinc.com/v3.1/agent/action/delete_chat_properties \
  -H 'Authorization: Bearer <your_access_token>' \
  -H 'Content-Type: application/json' \
  -d '{
      "chat_id": "PW94SJTGW6",
      "properties": {
          "bb9e5b2f1ab480e4a715977b7b1b4279": [
              "score",
              "comment"
              ]
          }
      }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Update Chat Thread Properties

#### Specifics

|                        |                                                                                               |
| ---------------------- | --------------------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/update_chat_thread_properties`                 |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw`      |
| **RTM API equivalent** | [`update_chat_thread_properties`](rtm-reference/#update-chat-thread-properties)               |
| **Webhook**            | [`chat_thread_properties_updated`](/management/webhooks/v3.1/#chat_thread_properties_updated) |

#### Request

| Parameter    | Required | Data type | Notes                                                                                                                                                                             |
| ------------ | -------- | --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to set properties for.                                                                                                                                    |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to set properties for.                                                                                                                                  |
| `properties` | Yes      | `object`  | Chat properties to set. You should stick to the [general properties format](/management/configuration-api/v3.1/#properties) and include _namespace_, _property name_ and _value_. |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
  https://api.livechatinc.com/v3.1/agent/action/update_chat_thread_properties \
  -H 'Authorization: Bearer <your_access_token>' \
  -H 'Content-Type: application/json' \
  -d '{
        "chat_id": "PW94SJTGW6",
        "thread_id": "K600PKZON8",
        "properties": {
            "bb9e5b2f1ab480e4a715977b7b1b4279": {
                "score": 10,
                "comment": "Thank you!"
              }
          }
      }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Delete Chat Thread Properties

#### Specifics

|                        |                                                                                               |
| ---------------------- | --------------------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/delete_chat_thread_properties`                 |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw`      |
| **RTM API equivalent** | [`delete_chat_thread_properties`](rtm-reference/#delete-chat-thread-properties)               |
| **Webhook**            | [`chat_thread_properties_deleted`](/management/webhooks/v3.1/#chat_thread_properties_deleted) |

#### Request

| Parameter    | Required | Data type | Notes                                              |
| ------------ | -------- | --------- | -------------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to delete properties of.   |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to delete properties of. |
| `properties` | Yes      | `object`  | Chat thread properties to delete.                  |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/delete_chat_thread_properties \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "chat_id": "PW94SJTGW6",
   "thread_id": "K600PKZON8",
   "properties": {
       "bb9e5b2f1ab480e4a715977b7b1b4279": [
           "score",
           "comment"
           ]
       }
   }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Update Event Properties

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/update_event_properties`                  |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **RTM API equivalent** | [`update_event_properties`](rtm-reference/#update-event-properties)                      |
| **Webhook**            | [`event_properties_updated`](/management/webhooks/v3.1/#event_properties_updated)        |

#### Request

| Parameter    | Required | Data type | Notes                                                                                                                                                                             |
| ------------ | -------- | --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to set properties for.                                                                                                                                    |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to set properties for.                                                                                                                                  |
| `event_id`   | Yes      | `string`  | Id of the event you want to set properties for.                                                                                                                                   |
| `properties` | Yes      | `object`  | Chat properties to set. You should stick to the [general properties format](/management/configuration-api/v3.1/#properties) and include _namespace_, _property name_ and _value_. |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/update_event_properties \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "chat_id": "PW94SJTGW6",
   "thread_id": "K600PKZON8",
   "event_id": "2_EW2WQSA8",
   "properties": {
       "bb9e5b2f1ab480e4a715977b7b1b4279": {
           "score": 10,
           "comment": "Thank you!"
           }
       }
   }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Delete Event Properties

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/delete_event_properties`                  |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **RTM API equivalent** | [`delete_event_properties`](rtm-reference/#delete-event-properties)                      |
| **Webhook**            | [`event_properties_deleted`](/management/webhooks/v3.1/#event_properties_deleted)        |

#### Request

| Parameter    | Required | Data type | Notes                                                  |
| ------------ | -------- | --------- | ------------------------------------------------------ |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to delete the properties of.   |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to delete the properties of. |
| `event_id`   | Yes      | `string`  | Id of the event you want to delete the properties of.  |
| `properties` | Yes      | `object`  | Event properties to delete.                            |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/delete_event_properties \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "chat_id": "PW94SJTGW6",
   "thread_id": "K600PKZON8",
   "event_id": "2_EW2WQSA8",
   "properties": {
       "bb9e5b2f1ab480e4a715977b7b1b4279": {
           "rating": [
               "score",
               "comment"
               ]
           }
       }
   }'
```

</CodeSample>
</Code>
</Section>

## Thread tags

<Section>
<Text>

### Tag Chat Thread

#### Specifics

|                        |                                                                       |
| ---------------------- | --------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/tag_chat_thread`       |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`                     |
| **RTM API equivalent** | [`tag_chat_thread`](rtm-reference/#tag-chat-thread)                   |
| **Webhook**            | [`chat_thread_tagged`](/management/webhooks/v3.1/#chat_thread_tagged) |

#### Request

| Parameter   | Required | Data type | Notes                                      |
| ----------- | -------- | --------- | ------------------------------------------ |
| `chat_id`   | Yes      | `string`  | Id of the chat you want to add a tag to.   |
| `thread_id` | Yes      | `string`  | Id of the thread you want to add a tag to. |
| `tag`       | Yes      | `string`  | Tag name                                   |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/tag_chat_thread \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
 "chat_id": "PW94SJTGW6",
 "thread_id": "PWS6GIKAKH",
 "tag": "support"
   }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Untag Chat Thread

#### Specifics

|                        |                                                                           |
| ---------------------- | ------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/untag_chat_thread`         |
| **Required scopes**    | `chats--all:rw` `chats--access:rw` `chats--my:rw`                         |
| **RTM API equivalent** | [`untag_chat_thread`](rtm-reference/#untag-chat-thread)                   |
| **Webhook**            | [`chat_thread_untagged`](/management/webhooks/v3.1/#chat_thread_untagged) |

#### Request

| Parameter   | Required | Data type | Notes                                           |
| ----------- | -------- | --------- | ----------------------------------------------- |
| `chat_id`   | Yes      | `string`  | Id of the chat you want to remove a tag from.   |
| `thread_id` | Yes      | `string`  | Id of the thread you want to remove a tag from. |
| `tag`       | Yes      | `string`  | Tag name                                        |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/untag_chat_thread \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
 "chat_id": "PW94SJTGW6",
 "thread_id": "PWS6GIKAKH",
 "tag": "support"
   }'
```

</CodeSample>
</Code>
</Section>

## Customers

<Section>
<Text>

### Get Customers

It returns the list of Customers.

#### Specifics

|                        |                                                               |
| ---------------------- | ------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/get_customers` |
| **Required scopes**    | `customers:ro`                                                |
| **RTM API equivalent** | [`get_customers`](rtm-reference/#get_customers)               |
| **Webhook**            | -                                                             |

#### Request

All parameters are optional.

| Parameter                                                                      | Data type | Notes                     |
| ------------------------------------------------------------------------------ | --------- | ------------------------- |
| `page_id`                                                                      | `string`  |                           |
| `limit`                                                                        | `number`  | Default: 10, maximum: 100 |
| `order` **\***                                                                 | `string`  | Default: `desc`           |
| `filters`                                                                      | `object`  |                           |
| `filters.country.<string_filter_type>` **\*\***                                | `object`  |                           |
| `filters.email.<string_filter_type>` **\*\***                                  | `object`  |                           |
| `filters.name.<string_filter_type>` **\*\***                                   | `object`  |                           |
| `filters.customer_id.<string_filter_type>` **\*\***                            | `object`  |                           |
| `filters.chats_count.<range_filter_type>` **\*\*\***                           | `object`  |                           |
| `filters.threads_count.<range_filter_type>` **\*\*\***                         | `object`  |                           |
| `filters.visits_count.<range_filter_type>` **\*\*\***                          | `object`  |                           |
| `filters.created_at.<date_range_filter_type>`**\*\*\*\***                      | `object`  |                           |
| `filters.agent_last_event_created_at.<date_range_filter_type>` **\*\*\*\***    | `object`  |                           |
| `filters.customer_last_event_created_at.<date_range_filter_type>` **\*\*\*\*** | `object`  |                           |

**\*)**

`order` can take the following values:

- `asc` - oldest customers first
- `desc` - newest customers first

**\*\*)**

`<string_filter_type>` can take the following values :

- `values` (`string[]` - an array of strings)
- `exclude_values` (`string[]` - an array of strings)

There's only one value allowed for a single filter.

**\*\*\*)**

`<range_filter_type>` can take the following values:

- `lte` (`int` - less than or equal to given value)
- `lt` (`int` - less than given value)
- `gte` (`int` - greater than or equal to given value)
- `gt` (`int` - greater than given value)
- `eq` (`int` - equal to given value)

**\*\*\*\*)**

`<date_range_filter_type>` can take the following values:

- `lte` ( `string` - less than or equal to given value)
- `lt` (`string` - less than given value)
- `gte` (`string` - greater than or equal to given value)
- `gt` (`string` - greater than given value)
- `eq` (`string` - equal to given value)

Dates are represented in ISO 8601 format with microseconds resolution, e.g. `2017-10-12T15:19:21.010200+01:00` in specific timezone or `2017-10-12T14:19:21.010200Z` in UTC.

#### Response

| Field              | Data type | Notes                                              |
| ------------------ | --------- | -------------------------------------------------- |
| `next_page_id`     | `string`  | In relation to `page_id` specified in the request. |
| `previous_page_id` | `string`  | In relation to `page_id` specified in the request. |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/get_customers \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{}'
```

</CodeSample>
<CodeResponse>

```json
{
  "customers": [
    // array of "User > Customer" objects
  ],
  "total_customers": 2340,
  "next_page_id": "MTUxNzM5ODEzMTQ5Ng==", // optional
  "previous_page_id": "MTUxNzM5ODEzMTQ5Ng==" // optional
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Create Customer

Creates a new [Customer](#customer) user type.

#### Specifics

|                        |                                                                   |
| ---------------------- | ----------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/create_customer`   |
| **Required scopes**    | `customers:rw`                                                    |
| **RTM API equivalent** | [`create_customer`](rtm-reference/#create-customer)               |
| **Webhook**            | [`customer_created`](/management/webhooks/v3.1/#customer_created) |

#### Request

| Parameter | Required | Data type | Notes                                |
| --------- | -------- | --------- | ------------------------------------ |
| `name`    | No       | `string`  |                                      |
| `email`   | No       | `string`  |                                      |
| `avatar`  | No       | `string`  | URL of the Customer's avatar         |
| `fields`  | No       | `object`  | A map in the `"key": "value"` format |

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/create_customer \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{}'
```

</CodeSample>
<CodeResponse>

```json
{
  "customer_id": "b7eff798-f8df-4364-8059-649c35c9ed0c"
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Update Customer

Updates Customer's properties.

#### Specifics

|                        |                                                                 |
| ---------------------- | --------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/update_customer` |
| **Required scopes**    | `customers:rw`                                                  |
| **RTM API equivalent** | [`update_customer`](rtm-reference/#update-customer)             |
| **Webhook**            | -                                                               |

#### Request

| Parameter     | Required | Data type | Notes                                |
| ------------- | -------- | --------- | ------------------------------------ |
| `customer_id` | Yes      | `string`  | UUID v4 format is required           |
| `name`        | No       | `string`  |                                      |
| `email`       | No       | `string`  |                                      |
| `avatar`      | No       | `string`  | URL of the Customer's avatar         |
| `fields`      | No       | `object`  | A map in the `"key": "value"` format |

Apart from `customer_id`, which is a required parameter, you also need to include **one of the optional** parameters.

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/update_customer \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "customer_id": "646d53b8-ba76-48bf-7ef1-f6d61ec4ec44",
   "name": "John Doe"
   }'
```

</CodeSample>
<CodeResponse>

```json
{
  // "User > Customer" object
}
```

</CodeResponse>
</Code>
</Section>

<Section>
<Text>

### Ban Customer

Bans the customer for a specific period of time. It immediately disconnects all active sessions of this customer and does not accept new ones during the ban lifespan.

#### Specifics

|                        |                                                              |
| ---------------------- | ------------------------------------------------------------ |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/ban_customer` |
| **Required scopes**    | `customers.ban:rw`                                           |
| **RTM API equivalent** | [`ban_customer`](rtm-reference/#ban-customer)                |
| **Webhook**            | -                                                            |

#### Request

| Parameter     | Required | Data type |     |
| ------------- | -------- | --------- | --- |
| `customer_id` | Yes      | `string`  |     |
| `ban`         | Yes      | `object`  |     |
| `ban.days`    | Yes      | `number`  |     |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/ban_customer \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "customer_id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
   "ban": {
       "days": 3
       }
   }'
```

</CodeSample>
</Code>
</Section>

## Status

<Section>
<Text>

### Update Agent

Updates Agent's properties.

#### Specifics

|                        |                                                              |
| ---------------------- | ------------------------------------------------------------ |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/update_agent` |
| **Required scopes**    | `agents--my:rw` `agents--all:rw`                             |
| **RTM API equivalent** | [`update_agent`](rtm-reference/#update-agent)                |
| **Webhook**            | -                                                            |

#### Request

| Parameter        | Required | Data type | Notes                                                     |
| ---------------- | -------- | --------- | --------------------------------------------------------- |
| `agent_id`       | No       | `string`  | The current Agent is used by default.                     |
| `routing_status` | No       | `string`  | Possible values: `accepting_chats`, `not_accepting_chats` |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/update_agent \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "agent_id": "agent1@example.com",
   "routing_status": "accepting_chats"
   }'
```

</CodeSample>
</Code>
</Section>

## Other

<Section>
<Text>

### Mark Events as Seen

#### Specifics

|                        |                                                                             |
| ---------------------- | --------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/mark_events_as_seen`         |
| **Required scopes**    | `chats--access:ro` `chats--all:ro`                                          |
| **RTM API equivalent** | [`mark_events_as_seen`](rtm-reference/#mark-events-as-seen)                 |
| **Webhook**            | [`events_marked_as_seen`](/management/webhooks/v3.1/#events_marked_as_seen) |

#### Request

| Parameter    | Required | Data type | Notes                     |
| ------------ | -------- | --------- | ------------------------- |
| `chat_id`    | Yes      | `string`  |                           |
| `seen_up_to` | Yes      | `string`  | RFC 3339 date-time format |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/mark_events_as_seen \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "chat_id": "PJ0MRSHTDG",
   "seen_up_to": "2017-10-12T15:19:21.010200Z"
   }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Send Typing Indicator

#### Specifics

|                        |                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/send_typing_indicator`                    |
| **Required scopes**    | `chats.conversation--all:rw` `chats.conversation--access:rw` `chats.conversation--my:rw` |
| **RTM API equivalent** | [`send_typing_indicator`](rtm-reference/#send_typing_indicator)                          |
| **Webhook**            | -                                                                                        |

#### Request

| Parameter    | Required | Data type | Notes                                                |
| ------------ | -------- | --------- | ---------------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat that to send the typing indicator to. |
| `recipients` | No       | `string`  | Default: `all`; `agents`                             |
| `is_typing`  | Yes      | `bool`    |                                                      |

#### Response

No response payload (`200 OK`).

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/send_typing_indicator \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "chat_id": "PJ0MRSHTDG",
   "is_typing": true
   }'
```

</CodeSample>
</Code>
</Section>

<Section>
<Text>

### Multicast

This method serves for the **chat-unrelated communication**. Messages sent using `multicast` are not being saved.

For example, it could be used in an app that sends notifications to Agents or Customers, when a certain condition is met (e.g. an important Customer started the chat).

#### Specifics

|                        |                                                           |
| ---------------------- | --------------------------------------------------------- |
| **Method URL**         | `https://api.livechatinc.com/v3.1/agent/action/multicast` |
| **Required scopes**    | `multicast:rw`                                            |
| **RTM API equivalent** | [`multicast`](rtm-reference/#multicast)                   |
| **Webhook**            | -                                                         |

#### Request

| Parameter | Required | Data type | Notes                     |
| --------- | -------- | --------- | ------------------------- |
| `scopes`  | Yes      | `object`  | **\***                    |
| `content` | Yes      | `any`     | A JSON message to be sent |
| `type`    | No       | `string`  | Multicast message type    |

**\*)** `scopes` can take the following values:

- `agents`:

  - `all` (`bool` - includes all agents)
  - `ids` (`[]string` - an array of agents' IDs)
  - `groups` (`[]string` - an array of groups' IDs)

- `customers`:
  - `ids` (`[]string` - an array of customer's IDs)

At least one `scopes` type (`agents.all`, `agents.ids`, `agents.groups`, `customers.ids`) is required.

</Text>
<Code>
<CodeSample path={'REQUEST'}>

```shell
curl -X POST \
https://api.livechatinc.com/v3.1/agent/action/multicast \
-H 'Authorization: Bearer <your_access_token>' \
-H 'Content-Type: application/json' \
-d '{
   "scopes": {
       "agents": {
           "all": true,
           "ids": [
               "agent1@example.com",
               "agent2@example.com"
           ],
           "groups": [
               1,
               2
           ]
       },
       "customers": {
           "ids": [
               "b7eff798-f8df-4364-8059-649c35c9ed0c"
               ]
           }
       },
   "content": {
       "example": {
           "nested": "json"
           }
       }
   }'
```

</CodeSample>
</Code>
</Section>

# Webhooks

Here's what you need to know about **webhooks**:

- Webhooks notify you when specific events occur.
- They can be generated by both Web and RTM API actions.
- When using RTM API, you can be also notified about events with [pushes](/messaging/agent-chat-api/v3.1/rtm-reference/#pushes).
- Webhooks and pushes have similar payloads.
- To receive webhooks, you need to [register](/management/configuration-api/v3.1/#register-webhook) them first. You can do it via the [Configuration API](/management/configuration-api/v3.1/#webhooks).

<SectionLink to={"/management/configuration-api/v3.1/#webhooks"}>See webhook methods</SectionLink>
<SectionLink to={"/management/webhooks/v3.1/"}>See webhook payloads</SectionLink>

# Errors

<CodeResponse title={'General error format'}>

```json
{
  "error": {
    "type": "misdirected_request",
    "message": "Wrong region",
    "data": {
      // optional
      "region": "dal"
    }
  }
}
```

</CodeResponse>

## Possible errors

<Errors errors="authentication,authorization,entity_too_large,internal,license_expired,license_not_found,limit_reached,misdirected_request,request_timeout,too_many_requests,unsupported_version,validation,wrong_product_version"/>

# Contact us

If you found a bug or a typo, you can let us know directly on GitHub.
In case of any questions or feedback, don't hesitate to contact us at [developers@livechat.com](mailto:developers@livechat.com). We'll be happy to hear from you!

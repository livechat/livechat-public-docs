---
weight: 31
category: "messaging"
subcategory: "customer-chat-api"
title: "RTM API Reference"
tagline: "Interact with the chat as a Customer."
desc: "Use the Customer Chat Web API to interact as a Customer."
apiVersion: "3.1"
---

# Introduction

## Versioning

This document describes the **Customer Chat Real-Time Messaging API v3.1**. This is the **legacy** version. We encourage you to migrate to the latest stable version. [Read more about versioning...](/messaging/#api-versioning)

## What is RTM API

Real-Time Messaging API (RTM API) is based on a websocket-like connection. Client can send a **request message** that results in getting a **response message**. It's also possible to get **push messages**.

## When to use RTM API

If you're wondering which API to use - Customer Chat **RTM API** or **Web API**, keep on reading.

**Real-Time Messaging API** allows for building stateful integrations that require **logging in** and **maintaining the connection**. Since connection maintenance is required, the implementation might be more challenging than with Web API.

Customer Chat RTM API enables communication in real time. It supports pushes like `sneak peek`, `typing indicator`, and other. Web API doesn’t have equivalent webhooks, which means you won't be informed about certain events using Web API.

Also, the RTM API will be a better choice if you want to avoid time delays or presume significant traffic.

**Not what you're looking for?** Perhaps, you need to use [**Customer Chat Web API**](..) instead.

## Access

The basics on authorization and server pinging in the Customer Chat RTM API.

### Authorization

**Customer authorization** is handled with access tokens. Find out how to get an **access token** from [Customer authorization flow](/authorization/authorizing-api-calls/#customer-authorization-flow). You need to authorize within 30 seconds from establishing the connection. Otherwise, the connection will be closed. Given that the connection is continuosly maintained, you only need to authorize once.

### Server pinging

After successful authorization, the client needs to **ping the server** every 15 seconds. Otherwise, the connection will be closed after about 30 seconds of inactivity. Until authorization is completed, ping is a no-op.

Use one of these 2 ways of pinging the server:

- **Protocol message with the ping action**

For web applications and backend integrations (e.g. in Python, Go). Send the following request every 15 seconds:

``` js
{
  "action": "ping",
  "payload": {}
}
```

After pinging the server, the client will receive a response with the `ping` action. Thanks to that, the client can make sure the connection is still alive. 

- **The control frame ping in the websocket protocol**

For backend integrations; unavailable in web browsers. Read more about the [control frame ping](https://tools.ietf.org/html/rfc6455#section-5.5.2).

## Data centers

LiveChat system operates in two data centers: `dal` (USA) and `fra` (Europe). The default data center is `dal`.

For backend applications, you can specify the region in the request header. The mechanism is the same as in [Customer Chat Web API reference](../#data-centers). It doesn't work for frontend applications, though.
Instead, frontend apps connect to a region different than the default one by specifying the region suffix in the URL. 

**`fra`:** `wss://api-fra.livechatinc.com/v3.1/customer/rtm/ws`

**`dal`:** `wss://api.livechatinc.com/v3.1/customer/rtm/ws`

# Data structures

To find sample payloads of **events**, **users**, and **other common structures** such as chats or threads [visit the Data structures](/messaging/customer-chat-api/v3.1/data-structures) document.

# Methods

In the websocket transport, actions generate [pushes](/messaging/customer-chat-api/v3.1/rtm-pushes). RTM API actions can also trigger [webhooks](/management/configuration-api/v3.1/#webhooks), but they need to be registered first.

| The API endpoint                                 |
| ------------------------------------------------ |
| `wss://api.livechatinc.com/v3.1/customer/rtm/ws` |

When connecting to the Customer Chat RTM API, clients have to send over the required query string parameters.

| Required parameter | Data type |               Notes |
| ------------------ | :-------: | ------------------: |
| `license_id`       | `integer` | LiveChat account ID |

<Section>

<Text>

## Available methods

|                |                                                                                                                                                                                                                                                                                                                                                         |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Chats**      | [`get_chats_summary`](#get-chats-summary) [`get_chat_threads_summary`](#get-chat-threads-summary) [`get_chat_threads`](#get-chat-threads) [`start_chat`](#start-chat) [`activate_chat`](#activate-chat) [`close_thread`](#close-thread)                                                                                                                 |
| **Events**     | [`send_event`](#send-event) [`send_rich_message_postback`](#send-rich-message-postback) [`send_sneak_peek`](#send-sneak-peek)                                                                                                                                                                                                                           |
| **Properties** | [`update_chat_properties`](#update-chat-properties) [`delete_chat_properties`](#delete-chat-properties) [`update_chat_thread_properties`](#update-chat-thread-properties) [`delete_chat_thread_properties`](#delete-chat-thread-properties) [`update_event_properties`](#update-event-properties) [`delete_event_properties`](#delete-event-properties) |
| **Customers**  | [`update_customer`](#update-customer) [`update_customer_page`](#update-customer-page) [`set_customer_fields`](#set-customer-fields)                                                                                                                                                                                                                     |
| **Status**     | [`login`](#login) [`get_groups_status`](#get-groups-status)                                                                                                                                                                                                                                                                                             |
| **Other**      | [`get_form`](#get-form) [`get_predicted_agent`](#get-predicted-agent) [`get_url_details`](#get-url-details) [`mark_events_as_seen`](#mark-events-as-seen)                                                                                                                                                                                               |

</Text>

<Code>

<CodeSample path={'GENERAL RTM API REQUEST FORMAT'}>

```json
{
  "request_id": "<request_id>", // optional
  "action": "<action>",
  "payload": {
    // optional
  }
}
```

</CodeSample>

<CodeResponse title={'GENERAL RTM API RESPONSE FORMAT'}>

```json
{
  "request_id": "<request_id>", // optional
  "action": "<action>",
  "type": "response",
  "success": true,
  "payload": {
    // optional
  }
}
```

</CodeResponse>

</Code>

</Section>


## Chats

<Section>

<Text>

### Get Chats Summary

It returns [summaries](/messaging/customer-chat-api/v3.1/data-structures/#chat-summaries) of the chats a Customer participated in.

#### Specifics

|                        |                                              |
| ---------------------- | -------------------------------------------- |
| **Action**             | `get_chats_summary`                          |
| **Web API equivalent** | [`get_chats_summary`](../#get-chats-summary) |
| **Push message**       | -                                            |

#### Request

| Parameter | Required | Type     | Notes                    |
| --------- | -------- | -------- | ------------------------ |
| `offset`  | No       | `number` | Default: 0; maximum: 100 |
| `limit`   | No       | `number` | Default: 10; maximum: 25 |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_chats_summary",
  "payload": {}
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "get_chats_summary",
  "type": "response",
  "success": true,
  "payload": {
    "chats_summary": [
        {
            "id": "PJ0MRSHTDG",
            "order": 1575892853242000,
            "last_thread_id": "K600PKZON8",
            "last_event_per_type": {
                "message": {
                    "thread_id": "K600PKZON9",
                    "thread_order": 1,
                    "event": {
                        "id": "Q298LUVPRH_1",
                        "created_at": "2019-12-09T12:01:18.909000Z",
                        "type": "message",
                        "text": "hello world",
                        "author_id": "b7eff798-f8df-4364-8059-649c35c9ed0c"
                    }
                }
            },
            "users": [
                {
                    "id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
                    "type": "customer",
                    "present": true
                },
                {
                    "id": "d5eff798-f8df-4364-8059-649c35c9ed0c",
                    "name": "Agent Name",
                    "type": "agent",
                    "present": true,
                    "avatar": "https://example.com/avatar.png",
                    "job_title": "Support Agent"
                }
            ],
            "access": {
                "group_ids": [0]
            },
            "properties": {
                // "Properties" object
                }
            },
            "active": true
        }
    ],
    "total_chats": 1
  }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Get Chat Threads Summary

#### Specifics

|                        |                                                            |
| ---------------------- | ---------------------------------------------------------- |
| **Action**             | `get_chat_threads_summary`                                 |
| **Web API equivalent** | [`get_chat_threads_summary`](../#get-chat-threads-summary) |
| **Push message**       | -                                                          |

#### Request

| Parameter | Required | Data type | Notes                      |
| --------- | -------- | --------- | -------------------------- |
| `chat_id` | Yes      | `string`  |                            |
| `offset`  | No       | `number`  | Default: 0.                |
| `limit`   | No       | `number`  | Default: 25; maximum: 100. |

#### Response

| Field             | Notes                           |     |
| ----------------- | ------------------------------- | --- |
| `threads_summary` | Sorted descendingly by `order`. |     |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_chat_threads_summary",
  "payload": {
    "chat_id": "PJ0MRSHTDG"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "get_chat_threads_summary",
  "type": "response",
  "success": true,
  "payload": {
    "threads_summary": [
        {
            "id": "Q298LUVPRH",
            "order": 1,
            "total_events": 1,
            "active": true
        }
    ],
    "total_threads": 1
  }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Get Chat Threads

#### Specifics

|                        |                                            |
| ---------------------- | ------------------------------------------ |
| **Action**             | `get_chat_threads`                         |
| **Web API equivalent** | [`get_chat_threads`](../#get-chat-threads) |
| **Push message**       | -                                          |

#### Request

| Parameter    | Required | Data type |     |
| ------------ | -------- | --------- | --- |
| `chat_id`    | Yes      | `string`  |     |
| `thread_ids` | Yes      | `array`   |     |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_chat_threads",
  "payload": {
    "chat_id": "PJ0MRSHTDG",
    "thread_ids": ["K600PKZON8"]
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "get_chat_threads",
  "type": "response",
  "success": true,
  "payload": {
        "chat": {
        "id": "PJ0MRSHTDG",
        "order": 1576569422,
        "threads": [
            {
                "id": "K600PKZON8",
                "active": true,
                "user_ids": [
                    "b7eff798-f8df-4364-8059-649c35c9ed0c",
                    "bbb67d600796e9f277e360e842418833"
                ],
                "events": [
                    {
                        "id": "Q20N9CKRX2_1",
                        "created_at": "2019-12-17T07:57:41.512000Z",
                        "type": "message",
                        "text": "Hello",
                        "author_id": "bbb67d600796e9f277e360e842418833"
                    }
                ],
                "order": 1,
                "properties": {
                  // "Property" object
                },
                "access": {
                    "group_ids": [0]
                }
            }
        ],
        "users": [
            {
                "id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
                "type": "customer",
                "present": true
            },
            {
                "id": "bbb67d600796e9f277e360e842418833",
                "name": "Agent Name",
                "type": "agent",
                "present": true,
                "avatar": "https://example.com/avatar.jpg",
                "job_title": "Support Agent"
            }
        ],
        "access": {
            "group_ids": [0]
        },
        "properties": {
          // "Property" object
        }
    }
  }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Start Chat

Starts a chat.

#### Specifics

|                        |                                                                                              |
| ---------------------- | -------------------------------------------------------------------------------------------- |
| **Action**             | `start_chat`                                                                                 |
| **Web API equivalent** | [`start_chat`](../#start-chat)                                                               |
| **Push message**       | [`incoming_chat_thread`](/messaging/customer-chat-api/v3.1/rtm-pushes/#incoming_chat_thread) |

#### Request

| Parameter                | Required | Data type | Notes                                                                       |
| ------------------------ | -------- | --------- | --------------------------------------------------------------------------- |
| `chat`                   | No       | `object`  |                                                                             |
| `chat.properties`        | No       | `object`  | Initial chat properties                                                     |
| `chat.access`            | No       | `object`  | Chat access to set, default: all agents.                                    |
| `chat.thread`            | No       | `object`  |                                                                             |
| `chat.thread.events`     | No       | `array`   | Initial chat events array                                                   |
| `chat.thread.properties` | No       | `object`  | Initial chat thread properties                                              |
| `continuous`             | No       | `bool`    | Starts chat as continuous (online group is not required); default: `false`. |

#### Response

| Field       | Data type  | Notes                                                                                                                                                                   |
| ----------- | ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`   | `string`   |                                                                                                                                                                         |
| `thread_id` | `string`   |                                                                                                                                                                         |
| `event_ids` | `[]string` | Returned only when the chat was started with initial events. Returns only the IDs of user-generated events; server-side generated events are not included in the array. |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "start_chat",
  "payload": {}
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "start_chat",
  "type": "response",
  "success": true,
  "payload": {
    "chat_id": "PJ0MRSHTDG",
    "thread_id": "PGDGHT5G"
    }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Activate Chat

Used to restart an archived chat.

#### Specifics

|                        |                                                                                              |
| ---------------------- | -------------------------------------------------------------------------------------------- |
| **Action**             | `activate_chat`                                                                              |
| **Web API equivalent** | [`activate_chat`](../#activate-chat)                                                         |
| **Push message**       | [`incoming_chat_thread`](/messaging/customer-chat-api/v3.1/rtm-pushes/#incoming_chat_thread) |

#### Request

| Parameter                | Required | Type     | Notes                                                                      |
| ------------------------ | -------- | -------- | -------------------------------------------------------------------------- |
| `chat`                   | Yes      | `object` |                                                                            |
| `chat.id`                | Yes      | `string` | The ID of the chat that will be activated.                                 |
| `chat.access`            | No       | `object` | Chat access to set, default: all agents.                                   |
| `chat.properties`        | No       | `object` | Initial chat properties                                                    |
| `chat.thread`            | No       | `object` |                                                                            |
| `chat.thread.events`     | No       | `array`  | Initial chat events array                                                  |
| `chat.thread.properties` | No       | `object` | Initial chat thread properties                                             |
| `continuous`             | No       | `bool`   | Sets a chat to the continuous mode. When unset, leaves the mode unchanged. |

#### Response

| Field       | Data type  | Notes                                                                                                                                                                     |
| ----------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `thread_id` | `string`   |                                                                                                                                                                           |
| `event_ids` | `[]string` | Returned only when the chat was activated with initial events. Returns only the IDs of user-generated events; server-side generated events are not included in the array. |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "activate_chat",
  "payload": {
    "chat": {
      "id": "PWJ8Y4THAV"
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "activate_chat",
  "type": "response",
  "success": true,
  "payload": {
    "thread_id": "Z8AGR5OUW"
  }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Close Thread

Closes the thread. Sending messages to this thread will no longer be possible.

#### Specifics

|                        |                                                                                                                                                                     |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Action**             | `close_thread`                                                                                                                                                      |
| **Web API equivalent** | [`close_thread`](../#close-thread)                                                                                                                                  |
| **Push message**       | [`incoming_event`](/messaging/customer-chat-api/v3.1/rtm-pushes/#incoming_event) and [`thread_closed`](/messaging/customer-chat-api/v3.1/rtm-pushes/#thread_closed) |

#### Request

| Parameter | Required | Data type |     |
| --------- | -------- | --------- | --- |
| `chat_id` | Yes      | `string`  |     |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "close_thread",
  "payload": {
    "chat_id": "PJ0MRSHTDG"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "close_thread",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>

</Code>

</Section>

## Events

<Section>

<Text>

### Send Event

Sends an [Event](/messaging/customer-chat-api/v3.1/data-structures/#events) object. Use this method to send a message by specifing the [Message](/messaging/customer-chat-api/v3.1/data-structures/#message) event type in the request.

#### Specifics

|                        |
| ---------------------- | -------------------------------------------------------------------------------- |
| **Action**             | `send_event`                                                                     |
| **Web API equivalent** | [`send_event`](../#send-event)                                                   |
| **Push message**       | [`incoming_event`](/messaging/customer-chat-api/v3.1/rtm-pushes/#incoming_event) |


#### Request

| Parameter               | Required | Data type | Notes                                                                                                                                                             |
| ----------------------- | -------- | --------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`               | Yes      | `string`  | Id of the chat you want to send the message to.                                                                                                                   |
| `event`                 | Yes      | `object`  | The Event object                                                                                                                                                  |
| `attach_to_last_thread` | No       | `bool`    | The flag is ignored for active chats. For inactive chats: `true` – the event will be added to the last thread; `false` – the request will fail. Default: `false`. |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "send_event",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "event": {
      "type": "message",
      "text": "hello world",
      "recipients": "all"
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "send_event",
  "type": "response",
  "success": true,
  "payload": {
     "event_id": "K600PKZON8"
  }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Send Rich Message Postback

#### Specifics

|                        |                                                                                                                        |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| **Action**             | `send_rich_message_postback`                                                                                           |
| **Web API equivalent** | [`send_rich_message_postback`](../#send-rich-message-postback)                                                         |
| **Push message**       | [`incoming_rich_message_postback`](/messaging/customer-chat-api/v3.1/rtm-pushes/#incoming_rich_message_postback)**\*** |

**\*)** `incoming_rich_message_postback` will be sent only for active threads.

#### Request

| Parameter          | Required | Data type | Notes                               |
| ------------------ | -------- | --------- | ----------------------------------- |
| `chat_id`          | Yes      | `string`  |                                     |
| `event_id`         | Yes      | `string`  |                                     |
| `postback`         | Yes      | `object`  |                                     |
| `postback.id`      | Yes      | `string`  | Postback name of the button         |
| `postback.toggled` | Yes      | `bool`    | Postback toggled, `true` or `false` |
| `thread_id`        | Yes      | `string`  |                                     |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "send_rich_message_postback",
  "payload": {
    "chat_id": "PJ0MRSHTDG",
    "thread_id": "K600PKZON8",
    "event_id": "a0c22fdd-fb71-40b5-bfc6-a8a0bc3117f7",
    "postback": {
      "id": "Method URL_yes",
      "toggled": true
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "send_rich_message_postback",
  "type": "response",
  "success": true,
  "payload": {
    //no response payload
  }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Send Sneak Peek

Sends a sneak peek to a chat.

#### Specifics

|                        |                                          |
| ---------------------- | ---------------------------------------- |
| **Action**             | `send_sneak_peek`                        |
| **Web API equivalent** | [`send_sneak_peek`](../#send-sneak-peek) |
| **Push message**       | -                                        |

#### Request

| Parameter         | Required | Data type | Notes                                   |
| ----------------- | -------- | --------- | --------------------------------------- |
| `chat_id`         | Yes      | `string`  | Id of the chat to send a sneak peek to. |
| `sneak_peek_text` | Yes      | `string`  | Sneak peek text                         |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "send_sneak_peek",
  "payload": {
    "chat_id": "PJ0MRSHTDG",
    "sneak_peek_text": "hello world"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "send_sneak_peek",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>

</Code>

</Section>

## Properties

<Section>

<Text>

### Update Chat Properties

#### Specifics

|                        |                                                                                                    |
| ---------------------- | -------------------------------------------------------------------------------------------------- |
| **Action**             | `update_chat_properties`                                                                           |
| **Web API equivalent** | [`update_chat_properties`](../#update-chat-properties)                                             |
| **Push message**       | [`chat_properties_updated`](/messaging/customer-chat-api/v3.1/rtm-pushes/#chat_properties_updated) |

#### Request

| Parameter    | Required | Data type | Notes                                                                                                                                                                             |
| ------------ | -------- | --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you to set a property for.                                                                                                                                         |
| `properties` | Yes      | `object`  | Chat properties to set. You should stick to the [general properties format](/management/configuration-api/v3.1/#properties) and include _namespace_, _property name_ and _value_. |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "update_chat_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": {
        "score": 10,
        "comment": "Thank you!"
      }
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "update_chat_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Delete Chat Properties

#### Specifics

|                        |                                                                                                    |
| ---------------------- | -------------------------------------------------------------------------------------------------- |
| **Action**             | `delete_chat_properties`                                                                           |
| **Web API equivalent** | [`delete_chat_properties`](../#delete-chat-properties)                                             |
| **Push message**       | [`chat_properties_deleted`](/messaging/customer-chat-api/v3.1/rtm-pushes/#chat_properties_deleted) |

#### Request

| Parameter    | Required | Data type | Notes                                            |
| ------------ | -------- | --------- | ------------------------------------------------ |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to delete properties of. |
| `properties` | Yes      | `object`  | Chat properties to delete.                       |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "delete_chat_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": ["score", "comment"]
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "delete_chat_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Update Chat Thread Properties

#### Specifics

|                        |                                                                                                                  |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------- |
| **Action**             | `update_chat_thread_properties`                                                                                  |
| **Web API equivalent** | [`update_chat_thread_properties`](../#update-chat-thread-properties)                                             |
| **Push message**       | [`chat_thread_properties_updated`](/messaging/customer-chat-api/v3.1/rtm-pushes/#chat_thread_properties_updated) |

#### Request

| Parameter    | Required | Data type | Notes                                                                                                                                                                             |
| ------------ | -------- | --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to set properties for.                                                                                                                                    |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to set properties for.                                                                                                                                  |
| `properties` | Yes      | `object`  | Chat properties to set. You should stick to the [general properties format](/management/configuration-api/v3.1/#properties) and include _namespace_, _property name_ and _value_. |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "update_chat_thread_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "thread_id": "K600PKZON8",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": {
        "score": 10,
        "comment": "Thank you!"
      }
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "update_chat_thread_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Delete Chat Thread Properties

#### Specifics

|                        |                                                                                                                  |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------- |
| **Action**             | `delete_chat_thread_properties`                                                                                  |
| **Web API equivalent** | [`delete_chat_thread_properties`](../#delete-chat-thread-properties)                                             |
| **Push message**       | [`chat_thread_properties_deleted`](/messaging/customer-chat-api/v3.1/rtm-pushes/#chat_thread_properties_deleted) |

#### Request

| Parameter    | Required | Data type | Notes                                                  |
| ------------ | -------- | --------- | ------------------------------------------------------ |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to delete the properties of.   |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to delete the properties of. |
| `properties` | Yes      | `object`  | Chat thread properties to delete.                      |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "delete_chat_thread_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "thread_id": "K600PKZON8",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": ["score", "comment"]
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "delete_chat_thread_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Update Event Properties

#### Specifics

|                        |                                                                                                      |
| ---------------------- | ---------------------------------------------------------------------------------------------------- |
| **Action**             | `update_event_properties`                                                                            |
| **Web API equivalent** | [`update_event_properties`](../#update-event-properties)                                             |
| **Push message**       | [`event_properties_updated`](/messaging/customer-chat-api/v3.1/rtm-pushes/#event_properties_updated) |

#### Request

| Parameter    | Required | Data type | Notes                                                                                                                                                                             |
| ------------ | -------- | --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to set properties for.                                                                                                                                    |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to set properties for.                                                                                                                                  |
| `event_id`   | Yes      | `string`  | Id of the event you want to set properties for.                                                                                                                                   |
| `properties` | Yes      | `object`  | Chat properties to set. You should stick to the [general properties format](/management/configuration-api/v3.1/#properties) and include _namespace_, _property name_ and _value_. |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "update_event_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "thread_id": "K600PKZON8",
    "event_id": "2_EW2WQSA8",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": {
        "score": 10,
        "comment": "Thank you!"
      }
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "update_event_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Delete Event Properties

#### Specifics

|                        |                                                                                                      |
| ---------------------- | ---------------------------------------------------------------------------------------------------- |
| **Action**             | `delete_event_properties`                                                                            |
| **Web API equivalent** | [`delete_event_properties`](../#delete-event-properties)                                             |
| **Push message**       | [`event_properties_deleted`](/messaging/customer-chat-api/v3.1/rtm-pushes/#event_properties_deleted) |

#### Request

| Parameter    | Required | Data type | Notes                                                  |
| ------------ | -------- | --------- | ------------------------------------------------------ |
| `chat_id`    | Yes      | `string`  | Id of the chat you want to delete the properties of.   |
| `thread_id`  | Yes      | `string`  | Id of the thread you want to delete the properties of. |
| `event_id`   | Yes      | `string`  | Id of the event you want to delete the properties of.  |
| `properties` | Yes      | `object`  | Event properties to delete.                            |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "delete_event_properties",
  "payload": {
    "chat_id": "PW94SJTGW6",
    "thread_id": "K600PKZON8",
    "event_id": "2_EW2WQSA8",
    "properties": {
      "bb9e5b2f1ab480e4a715977b7b1b4279": {
        "rating": ["score", "comment"]
      }
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "delete_event_properties",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>

</Code>

</Section>

<!-- > **`delete_event_properties`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "delete_event_properties",
	"payload": {
		"chat_id": "PW94SJTGW6",
        "thread_id": "K600PKZON8",
        "event_id": "2_EW2WQSA8",
        "properties": {
            "bb9e5b2f1ab480e4a715977b7b1b4279": {
                "rating": [
                    "score",
                    "comment"
                ]
            }
        }
	}
}
``` -->

## Customers

<Section>

<Text>

### Update Customer

#### Specifics

|                        |                                                                                      |
| ---------------------- | ------------------------------------------------------------------------------------ |
| **Action**             | `update_customer`                                                                    |
| **Web API equivalent** | [`update_customer`](../#update-customer)                                             |
| **Push message**       | [`customer_updated`](/messaging/customer-chat-api/v3.1/rtm-pushes/#customer_updated) |

#### Request

| Parameter | Required | Data type | Notes                         |
| --------- | -------- | --------- | ----------------------------- |
| `name`    | No       | `string`  |                               |
| `email`   | No       | `string`  |                               |
| `avatar`  | No       | `string`  | URL of the Customer's avatar. |
| `fields`  | No       | `object`  | `key: value` format           |

At least one optional parameter needs to be included in the request payload.

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "update_customer",
  "payload": {
    "name": "John Doe"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "update_customer",
  "type": "response",
  "success": true,
  "payload": {
    // "User > Customer" object
  }
}
```

</CodeResponse>

</Code>

</Section>

<!-- > **`update_customer`** sample **request** with optional params

```json
{
	"request_id": "13425", // optional
	"action": "update_customer",
	"payload": {
		"name": "John Doe",
		"avatar": "https://example.com/avatars/1.jpg",
		"fields": {
			"score": "low"
		}
	}
}
``` -->

<Section>

<Text>

### Update Customer Page

#### Specifics

|                        |                                                                                                |
| ---------------------- | ---------------------------------------------------------------------------------------------- |
| **Action**             | `update_customer_page`                                                                         |
| **Web API equivalent** | -                                                                                              |
| **Push message**       | [`customer_page_updated`](/messaging/customer-chat-api/v3.1/rtm-pushes/#customer_page_updated) |

Agent and referrer are updated by default using the browser’s headers.

#### Request

| Parameter | Required | Data type |     |
| --------- | -------- | --------- | --- |
| `url`     | Yes      | `string`  |     |
| `title`   | No       | `string`  |     |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "update_customer_page",
  "payload": {
    "url": "https://livechatinc.com/pricing"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "update_customer_page",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>

</Code>

</Section>

<!-- > **`update_customer_page`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "update_customer_page",
	"payload": {
			"url": "https://livechatinc.com/pricing",
			"title": "Livechat - Pricing"
	}
}
``` -->

<Section>

<Text>

### Set Customer Fields

#### Specifics

|                        |                                                                                      |
| ---------------------- | ------------------------------------------------------------------------------------ |
| **Action**             | `set_customer_fields`                                                                |
| **Web API equivalent** | [`set_customer_fields`](../#set-customer-fields)                                     |
| **Push message**       | [`customer_updated`](/messaging/customer-chat-api/v3.1/rtm-pushes/#customer_updated) |

#### Request

| Parameter | Required | Data type | Notes              |
| --------- | -------- | --------- | ------------------ |
| `fields`  | Yes      | `object`  | `key:value` format |

Agent and referrer are updated by default using the browser’s headers.

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "set_customer_fields",
  "payload": {
    "fields": {
      "company_size": "10-100"
    }
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "set_customer_fields",
  "type": "response",
  "success": true,
  "payload": {
    // no response payload
  }
}
```

</CodeResponse>

</Code>

</Section>

## Status

<Section>

<Text>

### Login

It returns the initial state of the current Customer.

#### Specifics

|                        |         |
| ---------------------- | ------- |
| **Action**             | `login` |
| **Web API equivalent** | -       |
| **Push message**       | -       |

#### Request

| Parameter                     | Required | Data type | Notes                                                    |
| ----------------------------- | -------- | --------- | -------------------------------------------------------- |
| `token`                       | Yes      | `string`  | OAuth token from the Customer's account                  |
| `customer`                    | No       | `object`  |                                                          |
| `customer.avatar`             | No       | `string`  | The URL of the Customer's avatar                         |
| `customer.email`              | No       | `string`  |                                                          |
| `customer.name`               | No       | `string`  |                                                          |
| `customer.fields`             | No       | `object`  | A map in the `"key": "value"` format                     |
| `customer_page.title`         | No       | `string`  |                                                          |
| `customer_page.url`           | No       | `string`  |                                                          |
| `customer_side_storage`**\*** | No       | `object`  | A map in the `"key": "value"` format                     |
| `is_mobile`                   | No       | `bool`    | Informs if logging in is performed from a mobile device. |
| `group_id`                    | No       | `number`  |                                                          |
| `referrer`                    | No       | `string`  |                                                          |

**\*)** We use `customer_side_storage` to keep some data on the client side. You should pass a map from the `customer_side_storage_updated` push payload to this field.

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
	"action": "login",
	"payload": {
		"token": "<customer_access_token>"
		}
	}
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "login",
  "type": "response",
  "success": true,
  "payload": {
    "customer_id": "a0c22fdd-fb71-40b5-bfc6-a8a0bc3117f5",
    "has_active_thread": true,
    "chats": [{
      "chat_id": "PJ0MRSHTDG",
      "has_unread_events": true
        }],
    "__priv_dynamic_config": {
      "customer_data": {
        "name": "John Doe",
        "last_visit_timestamp": 1473433500,
        "page_views_count": 40,
        "visits_count": 15,
        "chats_count": 2,
        "invitations_shown_count": 20,
        "invitations_accepted_count": 1,
        "client_version": "432423423",
        "fields": "some fields",
        "group_id": 2
      },
      "online_groups_ids": [1, 3],
      "global_properties": {
        "key1": "value1",
        "key2": "value2"
      },
      "customer_groups": {
        "monitoring": {
          "id": 1,
          "static_config_url": "/licence/1520/get_static_config.121.1808829.94.95.39446.4011.2385.398.160.552.58.337.44320.js",
          "language_config_url": "/licence/1520/v2/localization.en.121.004b8e014f50ea0c6ad6227162f7d18f_40d391a9adcdbf190e62fcd21c865bf2.js"
        },
        "chats": {
          "2": {
            "chat_ids": ["PJ0MRSHTDG"],
            "static_config_url": "/licence/1520/get_static_config.121.1808829.94.95.39446.4011.2385.398.160.552.58.337.44320.js",
            "language_config_url": "/licence/1520/v2/localization.en.121.004b8e014f50ea0c6ad6227162f7d18f_40d391a9adcdbf190e62fcd21c865bf2.js"
          }
        }
      },
      "static_config_version": "3435.4545",
      "predicted_agent": {
        "id": "agent1@example.com",
        "name": "Bart",
        "type": "agent",
        "avatar": "cdn.livechatinc.com/avatars/1.png",
        "job_title": "Support Agent"
      },
      "greeting": {
        "id": 342543723,
        "unique_id": "e35a4fb4106d87e550fe1af480639058",
        "text": "some message",
        "agent": {
          "id": "agent1@example.com",
          "name": "Bart",
          "type": "agent",
          "avatar": "cdn.livechatinc.com/avatars/1.png",
          "job_title": "Support Agent",
          "is_bot": false
        },
        "displayed_first_time": true
        }
      }
    }
}
```

</CodeResponse>

</Code>

</Section>

<Section>

<Text>

### Get Groups Status

#### Specifics

|                        |                                              |
| ---------------------- | -------------------------------------------- |
| **Action**             | `get_groups_status`                          |
| **Web API equivalent** | [`get_groups_status`](../#get-groups-status) |
| **Push message**       | -                                            |

#### Request

| Parameter | Required | Data type | Notes                                                      |
| --------- | -------- | --------- | ---------------------------------------------------------- |
| `all`     | No       | `bool`    | If set to `true`, you will get statuses of all the groups. |
| `groups`  | No       | `array`   | A table of a groups' IDs                                   |

One of the optional parameters needs to be included in the request payload.

#### Response

|                   |                                                                                                          |     |
| ----------------- | -------------------------------------------------------------------------------------------------------- | --- |
| `Group Not Found` | If you send `group_id` of a group that doesn't exists, the id won't be included in the resposne payload. |     |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_groups_status",
  "payload": {
    "all": true
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "get_groups_status",
  "type": "response",
  "success": true,
  "payload": {
    "groups_status": {
      //1,2,3 are group ids, online/offline/online_for_queue are statuses of the groups

      1: "online",
      2: "offline",
      3: "online_for_queue"
    }
  }
}
```

</CodeResponse>

</Code>

</Section>

## Other

<Section>

<Text>

### Get Form

Returns an empty ticket form of a <a href="https://www.livechat.com/help/chat-surveys/" target="_blank">prechat or postchat survey</a>.

#### Specifics

|                        |                            |
| ---------------------- | -------------------------- |
| **Action**             | `get_form`                 |
| **Web API equivalent** | [`get_form`](../#get-form) |
| **Push message**       | -                          |

#### Request

| Parameter  | Required | Data type | Notes                                                |
| ---------- | -------- | --------- | ---------------------------------------------------- |
| `group_id` | Yes      | `number`  | Id of the group from which you want the form.        |
| `type`     | Yes      | `string`  | Form type. Possible values: `prechat` or `postchat`. |

#### Response

| Field     | Notes                                                                                                                  |
| --------- | ---------------------------------------------------------------------------------------------------------------------- |
| `enabled` | If `enabled: false`, the `form` object is not returned. Prechat/postchat survey disabled in the LiveChat Agent App UI. |
| `form`    | The `form` object                                                                                                      |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_form",
  "payload": {
    "group_id": 0,
    "type": "prechat"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "payload": {
    "form": {
      "id": "156630109416307809",
      "fields": [
        {
          "id": "15663010941630615",
          "type": "header",
          "label": "Welcome to our LiveChat! Please fill in the form below before starting the chat."
        },
        {
          "id": "156630109416307759",
          "type": "name",
          "label": "Name:",
          "required": false
        },
        {
          "id": "15663010941630515",
          "type": "email",
          "label": "E-mail:",
          "required": false
        }
      ]
    },
    "enabled": true
  }
}
```

</CodeResponse>

</Code>

</Section>

<!-- > **`get_form`** sample **request** with optional params

```json
{
	"request_id": "125", // optional
	"action": "get_form",
	"payload": {
		"group_id": 0,
		"type": "prechat"
	}
}
``` -->

<Section>

<Text>

### Get Predicted Agent

Gets the predicted Agent - the one the Customer will chat with when the chat starts.

#### Specifics

|                        |                                                  |
| ---------------------- | ------------------------------------------------ |
| **Action**             | `get_predicted_agent`                            |
| **Web API equivalent** | [`get_predicted_agent`](../#get-predicted-agent) |
| **Push message**       | -                                                |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_predicted_agent",
  "payload": {}
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "get_predicted_agent",
  "type": "response",
  "success": true,
  "payload": {
      "id": "b7eff798-f8df-4364-8059-649c35c9ed0c",
      "name": "Name",
      "avatar": "https://example.avatar/example.com",
      "is_bot": false,
      "job_title": "support hero",
      "type": "agent"
  }
}
```

</CodeResponse>

</Code>

</Section>

<!-- > **`get_predicted_agent`** sample **request** with optional params

```json
{
	"action": "get_predicted_agent",
	"payload": {}
}
``` -->

<Section>

<Text>

### Get URL Details

It returns the info on a given URL.

#### Specifics

|                        |                                          |
| ---------------------- | ---------------------------------------- |
| **Action**             | `get_url_details`                        |
| **Web API equivalent** | [`get_url_details`](../#get-url-details) |
| **Push message**       | -                                        |

#### Request

| Parameter | Required | Data type | Notes             |
| --------- | -------- | --------- | ----------------- |
| `url`     | Yes      | `string`  | Valid website URL |

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "get_url_details",
  "payload": {
    "url": "https://livechatinc.com"
  }
}
```

</CodeSample>

<CodeResponse>

```json
{
  "request_id": "<request_id>", // optional
  "action": "get_url_details",
  "type": "response",
  "success": true,
  "payload": {
    "title": "LiveChat | Live Chat Software and Help Desk Software",
    "description": "LiveChat - premium live chat software and help desk software for business. Over 24 000 companies from 150 countries use LiveChat. Try now, chat for free!",
    "image_url": "s3.eu-central-1.amazonaws.com/labs-fraa-livechat-thumbnails/96979c3552cf3fa4ae326086a3048d9354c27324.png",
    "image_width": 200,
    "image_height": 200,
    "url": "https://livechatinc.com"
  }
}
```

</CodeResponse>

</Code>

</Section>

<!-- > **`get_url_details`** sample **request** with optional params

```json
{
	"action": "get_url_details",
	"payload": {
		"url": "https://livechatinc.com"
	}
}
``` -->

<Section>

<Text>

### Mark Events As Seen

#### Specifics

|                        |                                                                                                |
| ---------------------- | ---------------------------------------------------------------------------------------------- |
| **Action**             | `mark_events_as_seen`                                                                          |
| **Web API equivalent** | [`mark_events_as_seen`](../#mark-events-as-seen)                                               |
| **Push message**       | [`events_marked_as_seen`](/messaging/customer-chat-api/v3.1/rtm-pushes/#events_marked_as_seen) |

#### Request

| Parameter    | Required | Data type | Notes                     |
| ------------ | -------- | --------- | ------------------------- |
| `chat_id`    | Yes      | `string`  |                           |
| `seen_up_to` | Yes      | `string`  | RFC 3339 date-time format |

#### Response

No response payload (`200 OK`).

</Text>

<Code>

<CodeSample path={'REQUEST'}>

```json
{
  "action": "mark_events_as_seen",
  "payload": {
    "chat_id": "PJ0MRSHTDG",
    "seen_up_to": "2017-10-12T15:19:21.010200Z"
  }
}
```

</CodeSample>

</Code>

</Section>

<Section>

<Text>

# Pushes

Here's what you need to know about **pushes**:

- They are generated primarily by RTM API actions, but also by Web API actions.
- They notify you when specific events occur.
- Can be **delivered** only in the websocket transport.
- You don't need to register pushes to receive them.
- Their equivalents in Web API are [webhooks](/management/configuration-api/v3.1/#webhooks). Pushes and webhooks have similar payloads.
- There are no retries for pushes. To determine if a customer has seen an event, compare the [event's](/messaging/customer-chat-api/v3.1/data-structures/#response) `created_at` parameter with the [customer's](/messaging/customer-chat-api/v3.1/data-structures/#customer) `events_seen_up_to` field.

<SectionLink to={"/messaging/customer-chat-api/v3.1/rtm-pushes"}>See available pushes</SectionLink>

</Text>

<Code>

<CodeResponse title={'The general push format'}>

```json
{
  "request_id": "<request_id>", // optional, applies only to the requester
  "action": "<action>",
  "type": "push",
  "payload": {
    // optional payload
  }
}
```

</CodeResponse>

</Code>

</Section>

# Errors

<CodeResponse title={'General error format'}>

```json
{
  "error": {
    "type": "misdirected_request",
    "message": "Wrong region",
    "data": {
      // optional
      "region": "dal"
    }
  }
}
```

</CodeResponse>

## Possible errors

<Errors errors="authentication,authorization,customer_banned,greeting_not_found,group_not_found,group_offline,group_unavailable,groups_offline,internal,license_expired,pending_requests_limit_reached,request_timeout,too_many_requests,unsupported_version,users_limit_reached,validation,wrong_product_version"/>

# Contact us

If you found a bug or a typo, you can let us know directly on GitHub.
In case of any questions or feedback, don't hesitate to contact us at [developers@livechat.com](mailto:developers@livechat.com). We'll be happy to hear from you!
